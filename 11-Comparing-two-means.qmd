# 比較單一與兩組平均值 {#sec-Comparing-two-means}

```{r}
#| include: FALSE
source("header.R")
```

> **譯者註** 部分實作示範單元尚未完成校稿，請留意標題下方或段落前提示。


@sec-Categorical-data-analysis 討論的檢定方法適用於依變項是名義尺度，獨變項也是名義尺度的資料。現實世界的許多研究問題都是要處理這種資料，所以卡方檢定的用途非常廣泛。然而，現實統計問題更有可能遇到的資料是，依變項為等距尺度或者更高階的連續尺度，研究目標是比較兩個獨立組之間的依變項平均值。例如，某位心理學家想知道有小孩的夫婦焦慮程度會不會比沒小孩的夫婦更高，或者相對於不聽音樂的人們，聽音樂會不會降低人們的工作記憶容量。閱讀一篇醫學論文，我們會想知道一種新藥物會不會增加或降低血壓。某位農業研究人員也許想知道磷肥會不會造成澳大利亞原生植物枯萎死亡。[^11-comparing-two-means-1]就這些問題來說，依變項都是一種連續的、等距尺度或比例尺度變項，獨變項則是一種二元的「分組」變項。也就是說，處理資料的研究人員想比較兩組平均值的差異。

<!---
[^11-translation-01]: 原書先介紹類別資料的統計方法，繁體中文版這一章往後挪動。--->

[^11-comparing-two-means-1]: 根據原作者在私家花園做的非正式實驗發現，相對於地球上其他地區，澳大利亞的原生植物只能適應低度磷肥，如果你在當地買了一間種植大量外來種植物的房子，還想種本土植物的話，請先把兩種植物分開；對歐洲植物有營養的肥料對澳大利亞原生植物來說是毒藥。

比較平均值的標準推論統計方法是 t 檢定，至於要使用那種t檢定則取決於問題內容。因此，本章重點是介紹各種類型的 t 檢定：單一樣本 t 檢定、獨立樣本 t 檢定和相依樣本 t 檢定。每種檢定方法都會討論單側與雙側檢定，還有 t 檢定的標準效果量 Cohen's d。每個t檢定最後還有討論適用條件，以及可能違反這些條件時的補救方法。但是，在介紹t檢定之前，我們先介紹一下 z 檢定。

<!--- In @sec-Categorical-data-analysis we covered the situation when your outcome variable is nominal scale and your predictor variable is also nominal scale. Lots of real world situations have that character, and so you'll find that chi-square tests in particular are quite widely used. However, you're much more likely to find yourself in a situation where your outcome variable is interval scale or higher, and what you're interested in is whether the average value of the outcome variable is higher in one group or another. For instance, a psychologist might want to know if anxiety levels are higher among parents than non-parents, or if working memory capacity is reduced by listening to music (relative to not listening to music). In a medical context we might want to know if a new drug increases or decreases blood pressure. An agricultural scientist might want to know whether adding phosphorus to Australian native plants will kill them.[^11-comparing-two-means-1] In all these situations our outcome variable is a fairly continuous, interval or ratio scale variable, and our predictor is a binary "grouping" variable. In other words, we want to compare the means of the two groups.

[^11-comparing-two-means-1]: Informal experimentation in my garden suggests that yes, it does. Australian natives are adapted to low phosphorus levels relative to everywhere else on Earth, so if you've bought a house with a bunch of exotics and you want to plant natives, keep them separate; nutrients to European plants are poison to Australian ones.

The standard answer to the problem of comparing means is to use a t檢定, of which there are several varieties depending on exactly what question you want to solve. As a consequence, the majority of this chapter focuses on different types of t檢定: one sample t檢定s, independent samples t檢定s and paired samples t檢定s. We'll then talk about one sided tests and, after that, we'll talk a bit about Cohen's d, which is the standard measure of effect size for a t檢定. The later sections of the chapter focus on the assumptions of the t檢定s, and possible remedies if they are violated. However, before discussing any of these useful things, we'll start with a discussion of the z-test. --->

## 單一樣本z檢定

<!---
[^11-translatino-02]: 譯註~這是傳統統計教科書必放的部分。因為本書中文版整合**線性模型的學習取向**，學生與教師可選擇跳過這一節。--->

這一節要介紹統計學裡最無用的一種統計檢定方法：z 檢定。嚴格來說，這種檢定方法幾乎沒什麼研究人員會使用。學習z檢定的真正用途是，這個方法是學習 t 檢定前相當方便的墊腳石，但是 t 檢定可能是最被過度使用的統計學工具。

<!---In this section I'll describe one of the most useless tests in all of statistics: the z-test. Seriously -- this test is almost never used in real life. Its only real purpose is that, when teaching statistics, it's a very convenient stepping stone along the way towards the t檢定, which is probably the most (over)used tool in all statistics. --->

### 使用z檢定前的注意事項

我們先用一個簡單的例子介紹 z 檢定如何運作的概念：我有一位朋友 Zeppo 老師準備按照常態分佈曲線為他的基礎統計學課程修課學生打分數。假如這門課程的平均分數是 $67.5$，標準差是 $9.5$，修課學生有數百人，其中有 20 位還修了心理學課程。出於好奇心，我想知道這些學生的成績是否與其他學生的成績一致，也就是這20位學生的平均分數也是 $67.5$，還是他們的成績比全體平均分數更高或更低？這些學生的成績存於Zeppo老師分享給我的 *zeppo.csv* 資料檔(lsj資料集`Zeppo`)，開啟 jamovi 的 'Exploration' - 'Descriptives'的設定視窗，按照 @sec-Descriptive-statistics 學過的方法，就能得到平均值為 $72.3$。[^11-comparing-two-means-2]

[^11-comparing-two-means-2]: 一開始匯入資料後， $X$ 的測量尺度要更改為「連續」(Continuous)，因為jamovi 預設功能會將這些成績數值自動定義為名義尺度，這樣子做的分析會不正確。

50 60 60 64 66 66 67 69 70 74 76 76 77 79 79 79 81 82 82 89

看起來有修心理學課程的學生成績比全部同學的好一些。樣本平均值 $\bar{X}=72.3$ 比假設的母群平均值 $\mu=67.5$ 要高了不少分，但是，樣本量 $N=20$ 其實並不是很大，也許這只是純粹的巧合。

為了能做出合理的評估，寫出我所知道的細節能幫助讀者了解。首先知道的是樣本平均值為 $\bar{X}=72.3$，如果我相信這20位學生的標準差與班上其他學生的標準差相同，那麼母群標準差就是 $\sigma=9.5$。同時我還相信 Zeppo 老師是按常態分佈曲線給分，這20位學生的成績分佈也應該符合常態分佈。

接著我要具體呈現如何從資料取得能做判斷的資訊。我對此問題的假設可用這20位學生來源母群平均值 $\mu$ 表示，而這個值是未知的。在有資料的當下，我想知道是不是 $\mu=67.5$ ？因為這是我目前所知道的，需要設定一個假設檢定程序來解答這個問題。樣本資料以及可能的來源母群分佈顯示在 @fig-fig11-1 。畫出統計圖還不能解答我的問題嗎？ 現在需要學習更進一步的統計知識了。


<!---To introduce the idea behind the z-test, let's use a simple example. A friend of mine, Dr Zeppo, grades his introductory statistics class on a curve. Let's suppose that the average grade in his class is $67.5$, and the standard deviation is $9.5$. Of his many hundreds of students, it turns out that 20 of them also take psychology classes. Out of curiosity, I find myself wondering if the psychology students tend to get the same grades as everyone else (i.e., mean $67.5$) or do they tend to score higher or lower? He emails me the *zeppo.csv* file, which I use to look at the grades of those students, in the jamovi spreadsheet view,and then calculate the mean in 'Exploration' - 'Descriptives' [^11-comparing-two-means-2]. The mean value is $72.3$.

[^11-comparing-two-means-2]: In order to do this I had to change the measurement level for $X$ to 'Continuous', as during the opening / import of the csv file jamovi made this a nominal level variable, which isn't right for my analysis

50 60 60 64 66 66 67 69 70 74 76 76 77 79 79 79 81 82 82 89

Hmm. It might be that the psychology students are scoring a bit higher than normal. That sample mean of $\bar{X} = 72.3$ is a fair bit higher than the hypothesised population mean of $\mu = 67.5$ but, on the other hand, a sample size of $N = 20$ isn't all that big. Maybe it's pure chance.

To answer the question, it helps to be able to write down what it is that I think I know. Firstly, I know that the sample mean is $\bar{X} = 72.3$. If I'm willing to assume that the psychology students have the same standard deviation as the rest of the class then I can say that the population standard deviation is $\sigma = 9.5$. I'll also assume that since Dr Zeppo is grading to a curve, the psychology student grades are normally distributed.

Next, it helps to be clear about what I want to learn from the data. In this case my research hypothesis relates to the population mean $\mu$ for the psychology student grades, which is unknown. Specifically, I want to know if $\mu = 67.5$ or not. Given that this is what I know, can we devise a hypothesis test to solve our problem? The data, along with the hypothesised distribution from which they are thought to arise, are shown in @fig-fig11-1 . Not entirely obvious what the right answer is, is it? For this, we are going to need some statistics. --->

```{r}
#| label: fig-fig11-1
#| out.width: 60%
#| fig-cap: 20位學生的統計課成績（直方圖）與理論的來源母群分佈（實線）。
#The theoretical distribution (solid line) from which the psychology student grades (bars) are supposed to have been generated

load("data_and_tables/zeppo.Rdata") #grades
ggplot(as.data.frame(grades), aes(x=grades)) +
  geom_histogram(aes(y =after_stat(density)), binwidth=5, col=blueshade, fill=blueshade, alpha=0.4) +
  stat_function(fun = dnorm, args = list(mean = 67.7, sd = sd(grades)), col="black", linewidth=1) +
  xlab("\n成績") +
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.title.y = element_blank())

```

### z檢定的統計假設

假設檢定的第一步是確定虛無假設和對立假設分表是代表什麼結果，以這個問題來說不難了解。這裡的虛無假設 $H_0$ 是，心理系學生的成績母群平均值 $\mu$ 等於 $67.5\%$，對立假設是母群平均值不等於 $67.5\%$。若是用數學符號表示，這些假設的白話說明就變成了：

$$ H_0:\mu= 67.5 $$ $$ H_1:\mu \neq 67.5 $$

不過，使用數學記號表示，其實不大能讓大家更好理解統計假設，這只是呈現完成資料分析後會得到什麼簡記方法。要被檢定的虛無假設 $H_0$ 和對立假設 $H_1$ 的視覺圖像都呈現在 @fig-fig11-2 。配合上一段的背景說明，視覺圖像除了能我們了解統計假設的重點在於結果是符合那個平均值(或者說期望值)，還有提供一些有用的資訊，特別是以下兩點：：

1. 20位學生成績分佈符合常態分佈。
2. 20位學生成績分佈的真實標準差 $\sigma$ 等於 9.5。

我們暫時先將這些條件當成是絕對沒錯的事實，許多現實世界的研究問題，這類絕對可信的背景條件通常是不可能成立的。若是要靠這些條件執行假設檢定，只能當做所有條件都是成立的。要確認這些條件是否成立，其實需要做些檢查程序，只是為了方便解說z檢定程序，目前先暫時跳過。

<!--- The first step in constructing a hypothesis test is to be clear about what the null and alternative hypotheses are. This isn't too hard to do. Our null hypothesis, $H_0$, is that the true population mean $\mu$ for psychology student grades is $67.5\%$, and our alternative hypothesis is that the population mean isn't $67.5\%$. If we write this in mathematical notation, these hypotheses become:

$$ H_0:\mu= 67.5 $$ $$ H_1:\mu \neq 67.5 $$

though to be honest this notation doesn't add much to our understanding of the problem, it's just a compact way of writing down what we're trying to learn from the data. The null hypotheses $H_0$ and the alternative hypothesis $H_1$ for our test are both illustrated in @fig-fig11-2. In addition to providing us with these hypotheses, the scenario outlined above provides us with a fair amount of background knowledge that might be useful. Specifically, there are two special pieces of information that we can add:

1.  The psychology grades are normally distributed.
2.  The true standard deviation of these scores $\sigma$ is known to be 9.5.

For the moment, we'll act as if these are absolutely trustworthy facts. In real life, this kind of absolutely trustworthy background knowledge doesn't exist, and so if we want to rely on these facts we'll just have make the *assumption* that these things are true. However, since these assumptions may or may not be warranted, we might need to check them. For now though, we'll keep things simple. --->

```{r}
#| label: fig-fig11-2
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 以單一樣本 $z$ 檢定檢測的虛無假設和對立假設的視覺圖解，此例進行雙側檢定。虛無假設和對立假設都根據母群分佈是常態分佈，以及母群標準差（ $\sigma_0$）為已知數值等條件成立。虛無假設（左）的 期望值 （$\mu$） 等於母群平均值 （$\mu_0$）。對立假設（右）的期望值不等於母群平均值( $\mu \neq \mu_0$)。
#Graphical illustration of the null and alternate hypotheses assumed by the one sample $z$-test (the two sided version, that is). The null and alternate hypotheses both assume that the population distribution is normal, and additionally assumes that the population standard deviation is known (fixed at some value $\$sigma_0$). The null hypothesis (left) is that the population mean $\mu$ is equal to some specified value $\mu_0$. The alternative hypothesis (right) is that the population mean differs from this value, $\mu \neq \mu_0$

p1 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="black", linewidth=1) +
  geom_segment(x = 0, y = 0.25, xend = -1, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-2.2, y=.25, label=expression(~sigma~" = "~sigma[0]), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" = "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("虛無假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = -.75, sd = 1), col="black", linewidth=1) +
  geom_segment(x = -.75, y = 0.25, xend = -1.75, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-3, y=.25, label=expression(~sigma~" = " ~sigma[0]), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" \U2260 "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("對立假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

接下來是設定一個可靠的檢定統計量，用來診斷成績分佈是符合$H_0$ 還是 $H_1$。因為兩種假設都與母群平均值 $\mu$有關，樣本平均值 $\bar{X}$是我們能用來檢定的絕佳參考點，也就是計算樣本平均值 $\bar{X}$ 與虛無假設預測的母群平均值之間的差異，在這個例子是 $\bar{X} - 67.5$。若要類推到同樣的分析問題，以$\mu_0$ 代指虛無假設主張的母群平均值，這樣一來要計算的就是

$$\bar{X}-\mu_0$$

如果這個差異值等於或非常接近於0，虛無假設似乎是可接受的結論。如果這個差異值完全不等於0，那麼虛無假設似乎不太可能是有意義的結論。不過，這個差異離0多遠才有可能拒絕 $H_0$ 呢？

為了搞清楚，我們需要耍一點小手段，就是之前提到的樣本資料服從常態分佈，以及母群標準差 $\sigma$ 的值是已知的。若是成績分佈確實符合虛無假設，真正的平均值確實是 $\mu_0$，這些事實支持母群分佈是平均值為 $\mu_0$，標準差為 $\sigma$ 的常態分佈。[^11-comparing-two-means-3]

[^11-comparing-two-means-3]: 採用 @sec-The-normal-distribution 的符號表示法，統計學家通成寫成：$$X \sim Normal(\mu_0,\sigma^2)$$

好啦，若真的那麼順利， $\bar{X}$ 的分佈能告訴我們什麼事情呢？根據 @sec-The-central-limit-theorem 討論過的中央極限定理，平均數 $\bar{X}$ 的取樣分佈也是常態分佈，並且等於母群平均值 $\mu$。只是這個取樣分佈的標準差 $se(\bar{X})$–也被稱為平均值的標準誤差–真面目是[^11-comparing-two-means-4]

[^11-comparing-two-means-4]: 換句話說，如果虛無假設成立，平均值的取樣分佈可以寫成：$$\bar{X} \sim Normal(\mu_0,se(\bar{X})) $$


$$se(\bar{X})=\frac{\sigma}{\sqrt{N}}$$

讓我們進一步了解這個技巧。運用 @sec-Standard-scores 學過的標準分數，樣本平均數 $\bar{X}$可以轉換成標準分數，因為通常被寫成z，這裡可以改寫為 $z_{\bar{X}}$。改寫符號是為了方便記住，這裡正在計算的是樣本平均值的標準分數，不是單一觀察值的標準分數。如此一來，樣本平均值的 z 分數


$$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{SE(\bar{X})}$$ 

也可以寫成

$$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{\frac{\sigma}{\sqrt{N}}}$$

這個 z 分數就是這裡要用的檢定統計值，使用這個檢定統計值的好處是，像所有 z 分數一樣，它符合標準常態分佈：[^11-comparing-two-means-5]

[^11-comparing-two-means-5]: 如果讀者忘記了其中的原理，可以再參考 @sec-Standard-scores。

$$z_{\bar{X}} \sim Normal(0,1) $$


換句話說，無論原始資料的測量尺度是什麼，解讀z統計值的方法都是一樣的：z值代表觀察到的樣本平均值 $\bar{X}$ 與虛無假設預測的母群平均值 $\mu_0$相差了多少標準誤。更棒的是，無論原始分數的母群參數是多少，z 檢定的 5% 棄絕域始終不變，如同 @fig-fig11-3 的圖解。所以在以前大多數研究者和學生都要用手算統計的時代，可以從 @tbl-tab11-1 找出要報告的p值。也可以反過來使用手算得出的z統計值，從教科書的附表找出臨界值。

<!--- The next step is to figure out what we would be a good choice for a diagnostic test statistic, something that would help us discriminate between $H_0$ and $H_1$. Given that the hypotheses all refer to the population mean $\mu$, you'd feel pretty confident that the sample mean $\bar{X}$ would be a pretty useful place to start. What we could do is look at the difference between the sample mean $\bar{X}$ and the value that the null hypothesis predicts for the population mean. In our example that would mean we calculate $\bar{X} - 67.5$. More generally, if we let $\mu_0$ refer to the value that the null hypothesis claims is our population mean, then we'd want to calculate

$$\bar{X}-\mu_0$$

If this quantity equals or is very close to 0, things are looking good for the null hypothesis. If this quantity is a long way away from 0, then it's looking less likely that the null hypothesis is worth retaining. But how far away from zero should it be for us to reject H0?

To figure that out we need to be a bit more sneaky, and we'll need to rely on those two pieces of background knowledge that I wrote down previously; namely that the raw data are normally distributed and that we know the value of the population standard deviation $\sigma$. If the null hypothesis is actually true, and the true mean is $\mu_0$, then these facts together mean that we know the complete population distribution of the data: a normal distribution with mean $\mu_0$ and standard deviation $\sigma$.[^11-comparing-two-means-3]

[^11-comparing-two-means-3]: Adopting the notation from @sec-The-normal-distribution, a statistician might write this as: $$X \sim Normal(\mu_0,\sigma^2)$$

Okay, if that's true, then what can we say about the distribution of $\bar{X}$? Well, as we discussed earlier (see @sec-The-central-limit-theorem), the sampling distribution of the mean $\bar{X}$ is also normal, and has mean $\mu$. But the standard deviation of this sampling distribution $\\{se(\bar{X})\\}$, which is called the standard error of the mean, is [^11-comparing-two-means-4]

[^11-comparing-two-means-4]: In other words, if the null hypothesis is true then the sampling distribution of the mean can be written as follows: $$\bar{X} \sim Normal(\mu_0,SE(\bar{X})) $$

$$se(\bar{X}=\frac{\sigma}{\sqrt{N}})$$

Now comes the trick. What we can do is convert the sample mean $\bar{X}$ into a standard score (see @sec-Standard-scores). This is conventionally written as z, but for now I'm going to refer to it as $z_{\bar{X}}$. The reason for using this expanded notation is to help you remember that we're calculating a standardised version of a sample mean, not a standardised version of a single observation, which is what a z-score usually refers to). When we do so the z-score for our sample mean is

$$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{SE(\bar{X})}$$ or, equivalently $$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{\frac{\sigma}{\sqrt{N}}}$$

This z-score is our test statistic. The nice thing about using this as our test statistic is that like all z-scores, it has a standard normal distribution:[^11-comparing-two-means-5]

[^11-comparing-two-means-5]: Again, see @sec-Standard-scores if you've forgotten why this is true.

In other words, regardless of what scale the original data are on, the z-statistic itself always has the same interpretation: it's equal to the number of standard errors that separate the observed sample mean $\bar{X}$ from the population mean $\mu_0$ predicted by the null hypothesis. Better yet, regardless of what the population parameters for the raw scores actually are, the 5% critical regions for the z-test are always the same, as illustrated in @fig-fig11-3. And what this meant, way back in the days where people did all their statistics by hand, is that someone could publish a table like @tbl-tab11-1. This, in turn, meant that researchers could calculate their z-statistic by hand and then look up the critical value in a text book.

$$z_{\bar{X}} \sim Normal(0,1) $$ --->

```{r}
#| label: tbl-tab11-1
#| tbl-cap: 各種顯著水準的臨界值
#Critical values for different alpha levels
huxtabs[[11]][[1]] |>
  merge_cells(1, 2:3)
```

### 手作z檢定

現在，正如我之前提到的，z-test在實際應用中幾乎從不使用。這個測試在實際生活中如此罕見，以至於jamovi的基本安裝不包含內置功能。然而，這個測試是如此地簡單，以至於手動進行這個測試非常容易。讓我們回到Dr Zeppo課程的資料。在載入成績資料後，我需要做的第一件事是計算樣本均值，我已經做到了($72.3$)。我們已經有了已知的母群標準差($\sigma = 9.5$)，虛無假設所指定的母群平均值($\mu_0 = 67.5$)的值，以及樣本大小($N=20$)。

<!--- Now, as I mentioned earlier, the z-test is almost never used in practice. It's so rarely used in real life that the basic installation of jamovi doesn't have a built in function for it. However, the test is so incredibly simple that it's really easy to do one manually. Let's go back to the data from Dr Zeppo's class. Having loaded the grades data, the first thing I need to do is calculate the sample mean, which I've already done ($72.3$). We already have the known population standard deviation ($\sigma = 9.5$), and the value of the population mean that the null hypothesis specifies ($\mu_0 = 67.5$), and we know the sample size ($N=20$). --->

```{r}
#| label: fig-fig11-3
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 雙尾 z-檢定 (面板(a)) 和單尾 z-檢定 (面板(b)) 的拒絕區域
#Rejection regions for the two-sided z-test (panel (a)) and the one-sided z-test (panel (b))

p1 <- ggplot(data = data.frame(x = seq(-3, 3, 0.1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), geom = "area",
                fill = blueshade, alpha=0.4, xlim = c(-3, -1.96))  +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), geom = "area",
                fill = blueshade, alpha=0.4, xlim = c(1.96, 3))  +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), col="black", linewidth=1) +
  xlab("\nValue of z Statistic") +
  ggtitle("(a) Two Sided Test") +
  scale_x_continuous(breaks=c(-1.96, 0, 1.96), labels=c("-1.96", "0", "1.96")) +
  theme_classic() +
  theme(
    axis.text.x = element_text(size=12),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(-3, 3, 0.1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), geom = "area",
                fill = blueshade, alpha=0.4, xlim = c(1.64, 3))  +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), col="black", linewidth=1) +
  xlab("\nValue of z Statistic") +
  ggtitle("(b) One Sided Test") +
  scale_x_continuous(breaks=c(0, 1.64), labels=c("0", "1.64")) +
  theme_classic() +
  theme(
    axis.text.x = element_text(size=12),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,ncol=2)

```

接下來，讓我們計算（真實）標準誤（可輕鬆用計算機完成）：

<!---Next, let's calculate the (true) standard error of the mean (easily done with a calculator): --->

$$
\begin{split}
sem.true & = \frac{sd.true}{\sqrt{N}} \\\\
& = \frac{9.5}{\sqrt{20}} \\\\
& = 2.124265
\end{split}
$$

最後，我們計算我們的z分數：

<!---And finally, we calculate our z-score: --->

$$
\begin{split}
z.score & = \frac{sample.mean - mu.null}{sem.true} \\\\
& = \frac{ (72.3 - 67.5)}{ 2.124265} \\\\
& = 2.259606
\end{split}
$$

此時，我們會傳統地在臨界值表中查詢 $2.26$ 的值。我們原來的假設是雙邊的（我們對心理學生在統計學上表現得比其他學生好或差沒有任何理論基礎），因此我們的假設檢驗也是雙邊的（或者是兩尾的）。從我先前顯示的小表中，我們可以看到 $2.26$ 大於需要在 $\alpha = .05$ 的顯著性水平下具有顯著性的臨界值 $1.96$，但小於需要在 $\alpha = .01$ 的水平下具有顯著性的值 $2.58$。因此，我們可以得出結論，我們可以這樣寫：

> *在心理學學生的樣本中，平均成績為* $73.2$，假定真正的人口標準差為 $9.5$，我們可以得出結論，心理學學生在統計學上的得分與課程平均分有顯著差異（$z = 2.26, N = 20, p<.05$）。

<!---At this point, we would traditionally look up the value $2.26$ in our table of critical values. Our original hypothesis was two-sided (we didn't really have any theory about whether psych students would be better or worse at statistics than other students) so our hypothesis test is two-sided (or two-tailed) also. Looking at the little table that I showed earlier, we can see that $2.26$ is bigger than the critical value of $1.96$ that would be required to be significant at $\alpha = .05$, but smaller than the value of $2.58$ that would be required to be significant at a level of $\alpha = .01$. Therefore, we can conclude that we have a significant effect, which we might write up by saying something like this:

> *With a mean grade of* $73.2$ in the sample of psychology students, and assuming a true population standard deviation of $9.5$, we can conclude that the psychology students have significantly different statistics scores to the class average ($z = 2.26, N = 20, p<.05$). --->

### z檢定的適用條件

正如之前的單元，所有統計檢定皆建立於特定的適用條件之上，這些條件有的是基於合理的考量，有的則可能不太合適。這裡介紹的「單樣本z檢定」也有三條適用條件：

- *常態性*。一般來說，z檢定必須假定母群分佈符合常態分佈。[^11-comparing-two-means-6]這是一個相對合理的條件，若有疑慮，我們有方法可以進行驗證（請參考 @sec-Checking-the-normality-of-a-sample ）。

- *獨立性*。第二條要求構成資料集的觀察值互不相關，或者說，觀察值之間的相關性看不出符合特定模式。這一點不容易直接用統計方法檢驗，而是要依賴嚴謹的實驗設計確保此條件成立。一個明顯違反此條件的不合理例子是，在資料集多次「複製貼上」同一個觀察值，導致得到的資料是基於單一測量結果的巨大“樣本”。實際上，每一個觀察值應該是從目標群體裡完全隨機選出，各別測量而得到的。這項條件在有些研究實務難以完全滿足，但是我們能透過精心安排的研究設計儘可能減少觀察資料之間的相關影響分析結果。

- *母群標準差已知*。z檢定的第三個條件是，研究者必須知道母群的真實標準差。這個條件實在是難以滿足。在現實世界的資料分析中，極少遇到可知母群標準差$\sigma$，卻對母群平均值$\mu$一無所知的情況。也就是說這個條件基本上難以成立。

[^11-comparing-two-means-6]: 實際上，這種說法可能太過武斷。嚴格來說，z檢定僅要求樣本平均值的分佈符合常態分佈。如果母群分佈是常態的，那麼樣本平均值的分佈自然也會是常態的。然而，正如中心極限定理這一節( @sec-The-central-limit-theorem )學到的，即便母群分佈本身不是常態的，樣本平均數的分佈還是能符合常態分佈（這種情況還相當常見）。不過，考慮到假定已知母群標準差是不合理的條件，詳細探討這個條件並無太大必要！


有鑒於母群標準差已知實在太天方夜譯，我們需要知道除了z檢定的其他統計方法。接著我們要離開z檢定這個看不到生機的沙漠，進入有獨角獸、仙女和小矮人的神奇國度，那就是t檢定！


<!--- As I've said before, all statistical tests make assumptions. Some tests make reasonable assumptions, while other tests do not. The test I've just described, the one sample z-test, makes three basic assumptions. These are:

-   *Normality*. As usually described, the z-test assumes that the true population distribution is normal.[^11-comparing-two-means-6] This is often a pretty reasonable assumption, and it's also an assumption that we can check if we feel worried about it (see Section on [Checking the normality of a sample]).
-   *Independence*. The second assumption of the test is that the observations in your data set are not correlated with each other, or related to each other in some funny way. This isn't as easy to check statistically, it relies a bit on good experimental design. An obvious (and stupid) example of something that violates this assumption is a data set where you "copy" the same observation over and over again in your data file so that you end up with a massive "sample size", which consists of only one genuine observation. More realistically, you have to ask yourself if it's really plausible to imagine that each observation is a completely random sample from the population that you're interested in. In practice this assumption is never met, but we try our best to design studies that minimise the problems of correlated data.
-   *Known standard deviation*. The third assumption of the z-test is that the true standard deviation of the population is known to the researcher. This is just stupid. In no real world data analysis problem do you know the standard deviation σ of some population but are completely ignorant about the mean $\mu$. In other words, this assumption is always wrong.

[^11-comparing-two-means-6]: Actually this is too strong. Strictly speaking the z test only requires that the sampling distribution of the mean be normally distributed. If the population is normal then it necessarily follows that the sampling distribution of the mean is also normal. However, as we saw when talking about the central limit theorem, it's quite possible (even commonplace) for the sampling distribution to be normal even if the population distribution itself is nonnormal. However, in light of the sheer ridiculousness of the assumption that the true standard deviation is known, there really isn't much point in going into details on this front!

In view of the stupidity of assuming that $\alpha$ is known, let's see if we can live without it. This takes us out of the dreary domain of the z-test, and into the magical kingdom of the t檢定, with unicorns and fairies and leprechauns! --->


> [導讀簡報](slides11.html){target="_blank"}


## 單一樣本t檢定 {#sec-The-one-sample-t檢定}

深思熟慮一番後，我們還是無法輕易假定修Zeppo教授課程的心理學系學生成績標準差與其他科系學生的標準差相等。如果我們已經認為不同科系學生的平均成績有差異，為何還要假定他們的標準差相等呢？基於這個理由，我認為不應該預先假定已經知道真正的$\sigma$是多少，這麼一來就違反z檢定的適用條件。如此一來，我們的分析工作似乎回到了原點。然而，我們還是有其他方法可用。最重要的是，我們能用一樣的原始資料估計母群標準差，也就是9.52。換言之，雖然我不能假定$\sigma = 9.5$，但我可以提出$\hat{\sigma} = 9.52$。

這是個不錯的開始。你也許會想到，使用樣本估計的標準差9.52來進行z檢定也可以吧，而不用假定$\sigma = 9.5$，這樣一來依然可以得到顯著的結果。這樣的檢定結果雖然接近正確，但非完全無懈可擊。由於現在是用母群標準差的估計值計算統計值，因此需要調整一下我們對真實母群標準差不確定的想法：或許現在這筆資料僅是一次偶發事件…或許真實的母群標準差其實是$11$。如果這是真的，就要假定$\sigma=11$來進行z檢定，分析結果就不會顯著了。到底真實的母群標準差是多少，是需要解決的問題。

<!---

 After some thought, I decided that it might not be safe to assume that the psychology student grades necessarily have the same standard deviation as the other students in Dr Zeppo's class. After all, if I'm entertaining the hypothesis that they don't have the same mean, then why should I believe that they absolutely have the same standard deviation? In view of this, I should really stop assuming that I know the true value of $\sigma$. This violates the assumptions of my z-test, so in one sense I'm back to square one. However, it's not like I'm completely bereft of options. After all, I've still got my raw data, and those raw data give me an estimate of the population standard deviation, which is 9.52. In other words, while I can't say that I know that $\sigma = 9.5$, I can say that $\hat{\sigma}$ = 9.52.

Okay, cool. The obvious thing that you might think to do is run a z-test, but using the estimated standard deviation of $9.52$ instead of relying on my assumption that the true standard deviation is $9.5$. And you probably wouldn't be surprised to hear that this would still give us a significant result. This approach is close, but it's not quite correct. Because we are now relying on an estimate of the population standard deviation we need to make some adjustment for the fact that we have some uncertainty about what the true population standard deviation actually is. Maybe our data are just a fluke...maybe the true population standard deviation is $11$, for instance. But if that were actually true, and we ran the z-test assuming $\sigma=11$, then the result would end up being non-significant. That's a problem, and it's one we're going to have to address. --->

```{r}
#| label: fig-fig11-4
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 單一樣本雙側t檢定的虛無假設和對立假設分佈視覺化。留意t檢定和z檢定的相似之處（請見 @fig-fig11-2 ），虛無假設的母群平均值$\mu$等於某個特定值$\mu_0$，對立假設不等於$\mu_0$。和z檢定相同，t檢定也有常態性的適用條件，但是不需要母群標準差$\sigma$已知。
#Graphical illustration of the null and alternative hypotheses assumed by the (two sided) one sample t檢定. Note the similarity to the z-test (@fig-fig11-2). The null hypothesis is that the population mean $\mu$ is equal to some specified value $\mu_0$, and the alternative hypothesis is that it is not. Like the z-test, we assume that the data are normally distributed, but we do not assume that the population standard deviation $\sigma$ is known in advance


p1 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="black", linewidth=1) +
  geom_segment(x = 0, y = 0.25, xend = -1, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-2.2, y=.25, label=expression(~sigma~" = ?"), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" = "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("虛無假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = -.75, sd = 1), col="black", linewidth=1) +
  geom_segment(x = -.75, y = 0.25, xend = -1.75, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-3, y=.25, label=expression(~sigma~" = ?"), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" \U2260 "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("對立假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

### 深入認識單一樣本t檢定

這道史詩級難題在 1908 年被 William Sealy Gosset 解決了。當時他是任職於吉尼斯啤酒公司的化學分析師（參考 @Box1987），當時的吉尼斯公司禁止員工以個人名義公開發表任何有統計分析的報告，因為公司認為這類報告會透露商業機密，因此Gosset 用了化名“學生”發表他的研究成果。這是為什麼今天t檢定的正式名稱是「學生t檢定」(Student's t檢定)。Gosset 的關鍵貢獻是，他發現即使我們不完全確定母群標準差的確切數值，如何確保取樣分佈充分匹配真實資料，他提出的解決方法是適當調整取樣分佈[^11-comparing-two-means-7]。t檢定的檢定統計值是t統計值(t statistic)，如同z檢定的計算方法，我們假定虛無假設的真實平均值是$\mu$，然而樣本平均值是$\bar{X}$，根據母群標準差的估計值$\hat{\sigma}$，t統計值的計算公式是：

[^11-comparing-two-means-7]: 其實這道難題的解法不完全是一個人的功勞。就原作者所知，最早由數學家高斯提出一部分解法，最終版本的解法是由羅納德·費雪爵士完成。


<!--- 這種模稜兩可的情況非常煩人，這個難題在 1908 年被 William Sealy Gosset 解決 [@Student1908]。當時他是吉尼斯啤酒廠聘雇的專職化學分析員（參見 @Box1987）。由於吉尼斯公司約束員工自行發表統計分析（顯然公司高層認為這是商業機密），所以他用化名“學生”發表了這項發現。直到今天，t 檢定的真正全名是 **Student's t檢定**。Gosset 所發現的關鍵是，我們要如何讓不完全確定真實標準差的取樣分佈與真實資料相容。解法是只要稍微改變取樣分佈。[^11-comparing-two-means-7]在 t 檢定中，我們的檢定統計量，現在稱為 t 統計值，以我上面提到的方式計算。如果我們的虛無假設是真實均值為 $\mu$，但我們的樣本平均值是 $\bar{X}$，而我們對人口標準差的估計是 $\hat{\sigma}$，那麼我們的 t 統計值是：

[^11-comparing-two-means-7]: 嗯，其實這個問題不完全由一個人解決。據我所知，最早高斯有提出部分解決方法；最終解決方法由羅納德·費雪爵士提出。

This ambiguity is annoying, and it was resolved in 1908 by a guy called William Sealy Gosset [@Student1908], who was working as a chemist for the Guinness brewery at the time (see @Box1987). Because Guinness took a dim view of its employees publishing statistical analysis (apparently they felt it was a trade secret), he published the work under the pseudonym "A Student" and, to this day, the full name of the t檢定 is actually **Student's t檢定**. The key thing that Gosset figured out is how we should accommodate the fact that we aren't completely sure what the true standard deviation is.[^11-comparing-two-means-7] The answer is that it subtly changes the sampling distribution. In the t檢定 our test statistic, now called a t-statistic, is calculated in exactly the same way I mentioned above. If our null hypothesis is that the true mean is $\mu$, but our sample has mean $\bar{X}$ and our estimate of the population standard deviation is $\hat{\sigma}$, then our t statistic is:

[^11-comparing-two-means-7]: Well, sort of. As I understand the history, Gosset only provided a partial solution; the general solution to the problem was provided by Sir Ronald Fisher. --->

$$
t=\frac{\bar{X}-\mu}{\frac{\hat{\sigma}}{\sqrt{N}}}
$$

```{r}
#| label: fig-fig11-5
#| fig-width:  10
#| fig-height: 5
#| fig-cap: 左圖實線是有2個自由度的t分佈，右圖實線是有10個自由度的t分佈，以虛線表示標準常態分佈（平均值為0，標準差為1）和兩個t分佈疊合，讓讀者比較。請注意，t分佈的尾部比常態分佈重（高峰度），當自由度非常小時，t分佈的尾部會越重，但是自由度越大就越接近標準常態分佈。也就是說，自由度越大的t分佈，越逼近常態分佈。
#The t distribution with 2 degrees of freedom (left) and 10 degrees of freedom (right), with a standard normal distribution (i.e., mean 0 and std dev 1) plotted as dotted lines for comparison purposes. Notice that the t distribution has heavier tails (leptokurtic, higher kurtosis) than the normal distribution; this effect is quite exaggerated when the degrees of freedom are very small, but negligible for larger values. In other words, for large $df$ the t distribution is essentially identical to a normal distribution

p1 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="grey", linetype=2, linewidth=1) +
  stat_function(fun = dt, n = 1000, args = list(df = 2), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ggtitle("df = 2") +
  xlab("\n t檢定統計值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))


p2 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="grey", linetype=2, linewidth=1) +
  stat_function(fun = dt, n = 1000, args = list(df = 20), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ggtitle("df = 10") +
  xlab("\n t檢定統計值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

從公式組成來看，t統計值與z統計值的唯一不同是前者 用母群標準差的估計值 $\hat{\sigma}$ ，代替真實的母群標準差$\sigma$。如果這個估計值總和$n$個觀察值，這樣的樣本分佈就會符合一個自由度是$n-1$的 t 分佈。 t 分佈的長相和常態分佈非常相近，但是兩側尾部的密度稍微高一點。這個特性在 @sec-Other-useful-distributions 曾經提過，也在 @fig-fig11-5 給讀者視覺化解釋。不過，各位讀者應該注意到自由度越大，t 分佈會越來越逼近標準常態分佈，而這就是許多研究者期盼的適用工具，若是樣本量達到$N = 70,000,000$，母群標準差的「估計值」就幾乎等於真實的母群標準差了？所以如果有大樣本資料可以分析，t 檢定的分析結果幾乎完全等於z檢定，用數學推導來看也是如此！


<!---The only thing that has changed in the equation is that instead of using the known true value $\sigma$, we use the estimate $\hat{\sigma}$. And if this estimate has been constructed from N observations, then the sampling distribution turns into a t-distribution with $N-1$ **degrees of freedom** (df). The t distribution is very similar to the normal distribution, but has "heavier" tails, as discussed earlier in @sec-Other-useful-distributions and illustrated in @fig-fig11-5. Notice, though, that as df gets larger, the t-distribution starts to look identical to the standard normal distribution. This is as it should be: if you have a sample size of $N = 70,000,000$ then your "estimate" of the standard deviation would be pretty much perfect, right? So, you should expect that for large $N$, the t檢定 would behave exactly the same way as a z-test. And that's exactly what happens! --->

### 實作單一樣本t檢定

> **譯者註** 本單元內容為AI初翻，請謹慎使用。

正如你所預期的，t檢定的機制幾乎與z檢定的機制完全相同。因此，沒有必要繁瑣地展示如何使用低級命令進行計算。它與我們之前所做的計算幾乎相同，只是使用了估計的標準差，然後使用t分佈而不是常態分佈來測試假設。因此，我將直接跳到顯示如何實際進行t檢定。jamovi配備了一個專門用於t檢定的分析，非常靈活（它可以運行許多不同類型的t檢定）。它非常簡單易用；您需要做的只是指定“分析”-“T檢定”-“單樣本T檢定”，將您感興趣的變項（X）移動到“變項”框中，並在“假設”-“測試值”框中輸入虛無假設的平均值（'67.5'）。很容易。見 @fig-fig11-6 ，除了我們稍後會提到的其他事項之外，它還提供了t檢定統計量=2.25，自由度為19，相關的p值為$0.036$。

<!---As you might expect, the mechanics of the t檢定 are almost identical to the mechanics of the z-test. So there's not much point in going through the tedious exercise of showing you how to do the calculations using low level commands. It's pretty much identical to the calculations that we did earlier, except that we use the estimated standard deviation and then we test our hypothesis using the t distribution rather than the normal distribution. And so instead of going through the calculations in tedious detail for a second time, I'll jump straight to showing you how t檢定s are actually done. jamovi comes with a dedicated analysis for t檢定s that is very flexible (it can run lots of different kinds of t檢定s). It's pretty straightforward to use; all you need to do is specify 'Analyses' - 't檢定s' - 'One Sample t檢定', move the variable you are interested in (X) across into the 'Variables' box, and type in the mean value for the null hypothesis ('67.5') in the 'Hypothesis' - 'Test value' box. Easy enough. See @fig-fig11-6, which, amongst other things that we will get to in a moment, gives you a t檢定 statistic = 2.25, with 19 degrees of freedom and an associated p-value of $0.036$. --->

```{r}
#| label: fig-fig11-6
#| classes: .enlarge-image
#| fig-cap: jamovi執行單一樣本t檢定示範
#jamovi does the one-sample t檢定
knitr::include_graphics("images/fig11-6.png")
```

此外，報告了其他兩個可能會引起關注的指標：95％信賴區間和效應大小的測量值（我們稍後會談論效應大小）。看起來相當簡單。現在我們該如何處理這個輸出呢？既然我們假裝真的在乎我們的例子，我們很高興地發現結果在統計上是顯著的（即p值低於0.05）。我們可以通過這樣的報告方式來表達結果：

> *心理學生的平均成績為* $72.3$，略高於平均成績$67.5$ ($t(19) = 2.25$，$p = .036$)。平均分差為$4.80$，$95\%$信賴區間為$0.34$至$9.26$。

...其中 $t(19)$ 是一個簡寫符號，代表具有 $19$ 自由度的 t 統計值。話雖如此，人們通常不會報告信賴區間，或者使用比我在此展示的更簡短的形式進行報告。例如，看到信賴區間被包含在報告均值差之後的統計資訊中也不是很少見，就像這樣：

$$t(19)=2.25, p = .036, CI_{95} = [0.34, 9.26]$$

在這半行內塞這麼多專業術語，你就知道這必定是非常聰明的。[^11-comparing-two-means-8]

[^11-comparing-two-means-8]: 我覺得更嚴重的是，報告中只有數字而沒有任何解釋和詮釋。我對這樣的技術報告感到非常懷疑。這可能只是因為我自視甚高，但我經常覺得，如果一個作者沒有努力向讀者解釋和詮釋他們的分析，那麼他們自己可能不理解，或者有些懶惰。你的讀者是聰明的，但不是無限耐心的。如果你能幫助他們，就不要讓他們感到煩惱。



<!--- Also reported are two other things you might care about: the 95% confidence interval and a measure of effect size (we'll talk more about effect sizes later). So that seems straightforward enough. Now what do we do with this output? Well, since we're pretending that we actually care about my toy example, we're overjoyed to discover that the result is statistically significant (i.e. p value below .05). We could report the result by saying something like this:

> *With a mean grade of* $72.3$, the psychology students scored slightly higher than the average grade of $67.5$ ($t(19) = 2.25$, $p = .036$); the mean difference was $4.80$ and the $95\%$ confidence interval was from $0.34$ to $9.26$. 

...where $t(19)$ is shorthand notation for a t-statistic that has $19$ degrees of freedom. That said, it's often the case that people don't report the confidence interval, or do so using a much more compressed form than I've done here. For instance, it's not uncommon to see the confidence interval included as part of the stat block after reporting the mean difference, like this:

$$t(19)=2.25, p = .036, CI_{95} = [0.34, 9.26]$$ With that much jargon crammed into half a line, you know it must be really smart.[^11-comparing-two-means-8]

[^11-comparing-two-means-8]: More seriously, I tend to think the reverse is true. I get very suspicious of technical reports that fill their results sections with nothing except the numbers. It might just be that I'm an arrogant jerk, but I often feel like an author that makes no attempt to explain and interpret their analysis to the reader either doesn't understand it themselves, or is being a bit lazy. Your readers are smart, but not infinitely patient. Don't annoy them if you can help it.--->

### 單一樣本t檢定的適用條件 {#sec-one-sample-t-assumptions}

那麼單一樣本 t 檢定有什麼適用條件呢？因為 t 檢定基本上就是一個移除了已知標準差假設的 z 檢定，你應該不會意外t檢定具有和z檢定一樣的適用條件，只是少了已知母群標準差這一條：

- *常態性*。我們仍然要假定母群分佈是常態的 [^11-comparing-two-means-9]，如同[z檢定的適用條件]的描述，我們有標準方法可以檢查這種假設是否符合，如果這種假設被違反，還有其他的測試方法可以替代（[檢驗非常態資料]）。

- *獨立性*。同樣地，樣本的觀察值必須是來自彼此獨立的測量條件。詳細說明請參考[z檢定的適用條件]。

[^11-comparing-two-means-9]: 技術性的註解：與 z 檢定的適用條件一樣的方式，我們可以削弱 t 檢定的適用條件，只專注取樣分佈。但是，對於 t 檢定，這樣做比較困難。如同z檢定，我們可以將母群常態性的條件替換為樣本平均數的取樣分佈符合常態分佈。然而，我們還要靠樣本標準差做為母群標準差的估計值，因此我們還需要 $\hat{\sigma}$ 的取樣分佈符合卡方分佈的條件 。這使得判斷是否適用變得更麻煩，因此這個方案很少用在分析實務。幸運的是，如果母群分佈是常態的，這兩個條件都可以滿足。


總而言之，這兩個條件並非難以達成，因此單一樣本 t 檢定在實務中常被用於比較樣本平均數與假定的母群平均數有沒有差異。

<!--- Okay, so what assumptions does the one-sample t檢定 make? Well, since the t檢定 is basically a z-test with the assumption of known standard deviation removed, you shouldn't be surprised to see that it makes the same assumptions as the z-test, minus the one about the known standard deviation. That is

- Normality. We're still assuming that the population distribution is normal[^11-comparing-two-means-9], and as noted earlier, there are standard tools that you can use to check to see if this assumption is met ([Checking the normality of a sample]), and other tests you can do in it's place if this assumption is violated ([Testing non-normal data]).
- Independence. Once again, we have to assume that the observations in our sample are generated independently of one another. See the earlier discussion about the z-test for specifics ([Assumptions of the z-test]).

[^11-comparing-two-means-9]: A technical comment. In the same way that we can weaken the assumptions of the z-test so that we're only talking about the sampling distribution, we can weaken the t檢定 assumptions so that we don't have to assume normality of the population. However, for the t檢定 it's trickier to do this. As before, we can replace the assumption of population normality with an assumption that the sampling distribution of $\bar{X}$ is normal. However, remember that we're also relying on a sample estimate of the standard deviation, and so we also require the sampling distribution of $\hat{\sigma}$ to be chi-square. That makes things nastier, and this version is rarely used in practice. Fortunately, if the population distribution is normal, then both of these two assumptions are met.

Overall, these two assumptions aren't terribly unreasonable, and as a consequence the one sample t檢定 is pretty widely used in practice as a way of comparing a sample mean against a hypothesised population mean. --->

<!--- 校對進度標記 --->

## 獨立樣本t檢定 {#sec-the-independent-samples-t-test-student-test}

儘管不乏能用單一樣本 t 檢定解決的統計問題，但這並不是最常用的 t 檢定方法。[^11-comparing-two-means-10]通常要處理的統計問題是比較兩組各自測得的資料，許多心理學研究會設計兩個不同測量條件，各自對應一種參與者分組。研究者會以探討的結果變項，請研究參與者做出指定的反應，研究問題就是這兩組參與者反應總計的平均值，是不是來自相同的母群。這種問題就需要使用獨立樣本 t 檢定要解決。

[^11-comparing-two-means-10]: 正是因為單一樣本t檢定很容易學，原作者才會用這套方法帶各位入門。

<!--- Although the one sample t檢定 has its uses, it's not the most typical example of a t檢定[^11-comparing-two-means-10]. A much more common situation arises when you've got two different groups of observations. In psychology, this tends to correspond to two different groups of participants, where each group corresponds to a different condition in your study. For each person in the study you measure some outcome variable of interest, and the research question that you're asking is whether or not the two groups have the same population mean. This is the situation that the independent samples t檢定 is designed for.

[^11-comparing-two-means-10]: Although it is the simplest, which is why I started with it. --->

### 使用獨立樣本t檢定的狀況

現在想像有一班Harpo老師的統計課程，總共有33 名學生，而Harpo老師給的分數不符合常態分佈曲線。其實，Harpo老師沒透露他的評分方式，他的班上學生平均成績也不得而知。這門課有兩位助教，Anastasia 和 Bernadette，都有開課外加強班。Anastasia 的班 $N_1=15$ 名學生，Bernadette 則有 $N_2=18$ 名學生。我想知道的是那位助教的加強班成效較好，還是沒什麼差異。Harpo老師給我的*harpo.csv*檔案，有所有生的成績。讀者同樣可以由jamovi的資料集裡開啟，這個檔案有三個變項，`ID`、`grade` 和 `tutor`。`grade` 變項是每個學生的成績，但是剛開始由jamovi預設的測量尺度並不正確，我們要手動更改為連續變項（參考 @sec-Changing-data-from-one-level-to-another）。tutor 變項是一個因子，表示每個學生的助教是 Anastasia 還是 Bernadette。

使用 'Exploration' - 'descriptives'，可以 分析計算每位助教的學生成績平均值和標準差，得到一個算清楚的摘要表格（@tbl-tab11-2）。

<!---Suppose we have 33 students taking Dr Harpo's statistics lectures, and Dr Harpo doesn't grade to a curve. Actually, Dr Harpo's grading is a bit of a mystery, so we don't really know anything about what the average grade is for the class as a whole. There are two tutors for the class, Anastasia and Bernadette. There are $N_1 = 15$ students in Anastasia's tutorials, and $N_2 = 18$ in Bernadette's tutorials. The research question I'm interested in is whether Anastasia or Bernadette is a better tutor, or if it doesn't make much of a difference. Dr Harpo emails me the course grades, in the *harpo.csv* file. As usual, I'll load the file into jamovi and have a look at what variables it contains - there are three variables, ID, grade and tutor. The grade variable contains each student's grade, but it is not imported into jamovi with the correct measurement level attribute, so I need to change this so it is regarded as a continuous variable (see @sec-Changing-data-from-one-level-to-another). The tutor variable is a factor that indicates who each student's tutor was - either Anastasia or Bernadette.

We can calculate means and standard deviations, using the 'Exploration' - 'descriptives' analysis, and here's a nice little summary table (@tbl-tab11-2). --->

```{r}
#| label: tbl-tab11-2
#| tbl-cap: 兩位統計助教帶的學生成績描述統計
huxtabs[[11]][[2]]
```

為了讓讀者更清楚知道接下來要做的事， jamovi範例檔案還有箱形圖與小提琴圖，圖中還有代表平均分數的小實心方塊。讓我們更能了解兩位助教的學生成績分佈 (@fig-fig11-7)。

<!--- To give you a more detailed sense of what's going on here, I've plotted box and violin plots in jamovi, with mean scores added to the plot with a small solid square. These plots show the distribution of grades for both tutors (@fig-fig11-7), --->

### 深入認識獨立樣本t檢定

獨立樣本 t 檢定有兩種不同的公式，學生 t 檢定(Student's t)和Welch's t 檢定(Welch's t)。最早出現的學生 t 檢定是比較簡單的一種，而Welch's t 檢定有更為嚴格的適用條件。像是要進行雙側檢定，要先確定兩個「獨立樣本」是否來自具有相同平均值（虛無假設）或不同平均值（對立假設）的母群。提到「獨立樣本」，真正意思是兩組樣本之間**沒有任何關聯性**。也許讀者現在可能還不太明白這是什麼意思，到了[相依樣本t檢定]這一節，就會更清楚。現在想像有一個分成兩組的實驗設計，每位參與者被隨機分派到其中一組，我們想比較這兩組參與者的反應以某種測量尺度紀錄的平均表現，這時我們就需要用獨立樣本 t 檢定，而不是相依樣本 t 檢定。

<!--- The **independent samples t檢定** comes in two different forms, Student's and Welch's. The original Student t檢定, which is the one I'll describe in this section, is the simpler of the two but relies on much more restrictive assumptions than the Welch t檢定. Assuming for the moment that you want to run a two-sided test, the goal is to determine whether two "independent samples" of data are drawn from populations with the same mean (the null hypothesis) or different means (the alternative hypothesis). When we say "independent" samples, what we really mean here is that there's no special relationship between observations in the two samples. This probably doesn't make a lot of sense right now, but it will be clearer when we come to talk about the paired samples t檢定 later on. For now, let's just point out that if we have an experimental design where participants are randomly allocated to one of two groups, and we want to compare the two groups' mean performance on some outcome measure, then an independent samples t檢定 (rather than a paired samples t檢定) is what we're after. --->

```{r}
#| label: fig-fig11-7
#| fig-cap: 箱形圖和小提琴圖顯示Anastasia和Bernadette的課程學生成績分佈。就視覺感受來說，Anastasia帶的學生平均成績可能比較好，但是學生之間的成績差異也許更大。
#Box and violin plots showing the distribution of grades for students in Anastasia's and Bernadette's classes. Visually, these suggest that students in Anastasia's class may be getting slightly better grades on average, though they also seem a bit more variable
knitr::include_graphics("images/fig11-7.png")
```

接著用 $\mu_1$ 代表 Anastasia 班學生的真實母群平均值， $\mu_2$ 代表Bernadette 班學生的真實母群平均值[^11-comparing-two-means-11]，通常用 $\bar{X_1}$ 和 $\bar{X_2}$ 代表兩組的樣本平均值。虛無假設所指的是兩組母群平均值是相同的（$\mu_1 = \mu_2$），而對立假設指的是兩組平均值不相同（$\mu_1 \neq \mu_2$）以數學模型展示的話，就像是 @fig-fig11-8 。

<!--- Okay, so let's let $\mu_1$ denote the true population mean for group 1 (e.g., Anastasia's students), and $\mu_2$ will be the true population mean for group 2 (e.g., Bernadette's students),[^11-comparing-two-means-11] and as usual we'll let $\bar{X_1}$ and $\bar{X_2}$ denote the observed sample means for both of these groups. Our null hypothesis states that the two population means are identical ($\mu_1 = \mu_2$) and the alternative to this is that they are not ($\mu_1 \neq \mu_2$) (@fig-fig11-8). Written in mathematical-ese, this is: --->

```{r}
#| label: fig-fig11-8
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 學生t檢定所設定的虛無假設和對立假設的視覺化模型。虛無假設設定兩組的平均值 $\mu$ 相同，而對立假設設定兩組的平均值 $\mu_1$ 和 $\mu_2$ 不同。請注意這裡的母群分佈設定是常態分佈，而且對立假設的兩組平均值雖然不同，依然設定標準差相等。
#Graphical illustration of the null and alternative hypotheses assumed by the Student t檢定. The null hypothesis assumes that both groups have the same mean $\mu$, whereas the alternative assumes that they have different means $\mu_1$ and $\mu_2$. Notice that it is assumed that the population distributions are normal, and that, although the alternative hypothesis allows the group to have different means, it assumes they have the same standard deviation

p1 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 70, sd = 9), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=70, y=.047, label=expression(~mu), size=5) +
  ylim(0,0.05) +
  ggtitle("虛無假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 60, sd = 9), col="black", linewidth=1) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 75, sd = 9), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=60, y=.047, label=expression(~mu[1]), size=5) +
  geom_text(x=75, y=.047, label=expression(~mu[2]), size=5) +
  ylim(0,0.05) +
  ggtitle("對立假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

[^11-comparing-two-means-11]: 這種研究問題總是會出現一個有趣的問題：在這種情況下，究竟是指哪個母群？是真正修 Harpo 老師課程的所有33位學生？所有可能會修這門課的潛在學生？還是有其他考慮？我們所選擇對象，會影響分析條件嗎？在許多行為統計學的課堂，這個問題幾乎總是被含混帶過，因為每年我的學生都會問我這個問題，所以我會給一個簡單的回覆。就技術來說，母群條件會有影響的。只要“真實世界”母群的定義改變了，就會改變樣本平均值 $\bar{X}$ 的取樣分佈。能使用t 檢定的必要條件之一觀察值是從一個無限大的母群隨機取樣，然而真實的研究很少符合這個條件，造成t 檢定的結果可能導致錯誤的結論。不過在實際運用時，這個問題並不嚴重。即使無法完全滿足這個條件，多數檢定結果也不至於錯得離譜，所以通常不會太在意這個問題。

設定能夠處理這項研究問題的假設檢定程虧後，首先可以注意到，如果虛無假設為真，那麼兩個母群平均數之間的差異就是 *剛好* 為零，$\mu_1-\mu_2 = 0$。因此，判斷結果的檢定統計量就是指向兩個樣本平均數之間的差異。若是虛無假設為直，就可以預期 $\bar{X}_1 - \bar{X}_2$ 非常接近零。然而，就像[單一樣本z檢定]和[單一樣本t檢定]的程序，我們必須精確定義兩組平均值差異應該接近零，解決問題的方法和前面兩種檢定幾乎相同。先計算一個標準誤差的估計值（SE），然後將平均值之間的差異除以標準誤差。因此 **t 檢定統計量** 的公式長成以下的樣子：

$$t=\frac{\bar{X_1}-\bar{X_2}}{SE}$$

接下來的課題是，這個標準誤差估計值是什麼東西。這部分比前面介紹的兩個檢定複雜得多，因此需要一個小節仔細地討論。

<!--- A funny question almost always pops up at this point: what the heck is the population being referred to in this case? Is it the set of students actually taking Dr Harpo's class (all 33 of them)? The set of people who might take the class (an unknown number of them)? Or something else? Does it matter which of these we pick? It's traditional in an introductory behavioural stats class to mumble a lot at this point, but since I get asked this question every year by my students, I'll give a brief answer. Technically yes, it does matter. If you change your definition of what the "real world" population actually is, then the sampling distribution of your observed mean $\bar{X}$ changes too. The t檢定 relies on an assumption that the observations are sampled at random from an infinitely large population and, to the extent that real life isn't like that, then the t檢定 can be wrong. In practice, however, this isn't usually a big deal. Even though the assumption is almost always wrong, it doesn't lead to a lot of pathological behaviour from the test, so we tend to just ignore it. 

$$H_0: \mu_1=\mu_2 $$ $$H_0: \mu_1 \neq \mu_2 $$ To construct a hypothesis test that handles this scenario we start by noting that if the null hypothesis is true, then the difference between the population means is *exactly* zero, $\mu_1-\mu_2 = 0$. As a consequence, a diagnostic test statistic will be based on the difference between the two sample means. Because if the null hypothesis is true, then we'd expect $\bar{X}_1 - \bar{X}_2$ to be pretty close to zero. However, just like we saw with our one-sample tests (i.e., the one-sample z-test and the one-sample t檢定) we have to be precise about exactly how close to zero this difference should be. And the solution to the problem is more or less the same one. We calculate a standard error estimate (SE), just like last time, and then divide the difference between means by this estimate. So our **t-statistic** will be of the form:

$$t=\frac{\bar{X_1}-\bar{X_2}}{SE}$$


We just need to figure out what this standard error estimate actually is. This is a bit trickier than was the case for either of the two tests we've looked at so far, so we need to go through it a lot more carefully to understand how it works.--->

### 標準差的合併估計值

介紹最原始版本的學生 t 檢定時，曾指出適用條件之一是兩組資料有相同的母群標準差。換句話說，無論母群平均數是否相同，母群標準差都要是相同的，$\sigma_1 = \sigma_2$。因為設定兩組母群標準差相同，在此省略符號的下標，統一用 $\sigma$ 代表。那麼我們該如何估計這個值？當我們有兩組樣本時，該如何計算的單一標準差估計值？答案有點簡單，只要將它們加起來平均。實際上，我們會取一個*加權平均*的*變異數*估計值，做為**合併變異數的估計值**。分配給每個樣本的權重等於該樣本的觀察值個數減去 1。

[其他技術細節[^11-comparing-two-means-12]]

[^11-comparing-two-means-12]: 加權值的數學公式通常是：$$w_1=N_1-1$$ $$w_2=N_2-1$$ 對每個樣本分配加權值之後，就能用兩個變異數估計值的加權，$\hat{sigma}_{1}^{2}$ 和 $\hat{sigma}_{2}^{2}$，計算變異數的加權估計值。$$\hat{\sigma}_p^2=\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}$$ 最後再取估計值的平方根，將加權變異數估計值轉換為加權標準差估計。$$\hat{\sigma}_p=\sqrt{\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}}$$ 在這個方程式中代入 $(w_1 = N_1 - 1)$ 和 $w_2 = N_2 - 1$，會得到一個非常醜陋的公式。這個公式似乎是描述加權標準差估計值的“標準”公式，但這不是我偏好思考加權標準差的方法。<br>我喜歡的思考方式是，這份資料集來自 N 個觀測值，再被分成兩組。所以，可以用 $X_{ik}$ 代表第 k 位助教帶的第 i 位學生的成績。也就是說，$(X_{11}$ 是 Anastasia 帶的第一位學生成績，$X_{21}$ 是她帶的第二位學生，以此類推。如此會有兩個不同的組平均值 $\bar{X}_1$ 和 $\bar{X}_2$，使用 $\bar{X}_k$ 就能指稱這兩組，也就是第 k 輔導班的平均成績。<br>還能跟上的話，我們繼續談離均差：由於每位學生必參加其中一班，就可以將每位學生成績與平均的差異寫成$$X_{ik}-\bar{X}_k$$ 那為什麼不使用這套符號代表每位學生的成績與所在輔導班的平均成績之差異？請記住，離均差平方只是一群離均差平方後的平均值，所以可以用這個數學式子表達：$$\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N}$$<br>其中符號$\sum_{ik}$是一種偷懶的記號方式，意思是“加總每個班的所有學生成績”，因為每個"$_{ik}$"對應一位學生。$^a$ 但是，正如 @sec-Estimating-unknown-quantities-from-a-sample 學到的，除以 $n$ 算出的變異數是一個有偏誤的樣本變異數估計值。因此，我們需要除以 $n - 1$ 以修正偏誤。同時也提到，這種偏誤的來源是變異數估計依賴於樣本平均值，並且如果樣本平均值不等於母群平均值，極可能造成變異數估計值的系統性偏誤。但是在獨立組設計，一共有兩個樣本平均值！這是否表示會有更大的偏誤？是的，沒錯。所以這裡需要除以 $(n-2)$ 而不是 $(n-1)$，才是計算變異數估計值的正確方法。所以公式要改成：$$\hat{\sigma}_p^2=\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N-2}$$ 最後再取平方根，就會得到加權標準差的估計值  $\hat{\sigma}_p$。所以說，加權標準差的計算方法並不特別，與計算單一樣本標準差的方式沒有太大不同。 <br /> --- <br/>$^b$ 更正式的符號將在 @sec-Comparing-several-means-one-way-ANOVA 介紹。


<!--- In the original "Student t檢定", we make the assumption that the two groups have the same population standard deviation. That is, regardless of whether the population means are the same, we assume that the population standard deviations are identical, $\sigma_1 = \sigma_2$. Since we're assuming that the two standard deviations are the same, we drop the subscripts and refer to both of them as $\sigma$. How should we estimate this? How should we construct a single estimate of a standard deviation when we have two samples? The answer is, basically, we average them. Well, sort of. Actually, what we do is take a *weighted* average of the *variance* estimates, which we use as our **pooled estimate of the variance**. The weight assigned to each sample is equal to the number of observations in that sample, minus 1.

[Additional technical detail [^11-comparing-two-means-12]]

[^11-comparing-two-means-12]: Mathematically, we can write this as $$w_1=N_1-1$$ $$w_2=N_2-1$$ Now that we've assigned weights to each sample we calculate the pooled estimate of the variance by taking the weighted average of the two variance estimates, $\hat{sigma}_{1}^{2}$ and $\hat{sigma}_{2}^{2}$ $$\hat{\sigma}_p^2=\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}$$ Finally, we convert the pooled variance estimate to a pooled standard deviation estimate, by taking the square root. $$\hat{\sigma}_p=\sqrt{\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}}$$ And if you mentally substitute $(w_1 = N_1 - 1)$ and $w_2 = N_2 - 1$ into this equation you get a very ugly looking formula. A very ugly formula that actually seems to be the "standard" way of describing the pooled standard deviation estimate. It's not my favourite way of thinking about pooled standard deviations, however. I prefer to think about it like this. Our data set actually corresponds to a set of N observations which are sorted into two groups. So let's use the notation $X_{ik}$ to referto the grade received by the i-th student in the k-th tutorial group. That is, $(X_{11}$ is the grade received by the first student in Anastasia's class, $X_{21}$ is her second student, and so on. And we have two separate group means $\bar{X}_1$ and $\bar{X}_2$, which we could "generically" refer to using the notation $\bar{X}_k$, i.e., the mean grade for the k-th tutorial group. So far, so good. Now, since every single student falls into one of the two tutorials, we can describe their deviation from the group mean as the difference $$X_{ik}-\bar{X}_k$$ So why not just use these deviations (i.e., the extent to which each student's grade differs from the mean grade in their tutorial)? Remember, a variance is just the average of a bunch of squared deviations, so let's do that. Mathematically, we could write it like this $$\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N}$$ where the notation "$\sum_{ik}$" is a lazy way of saying "calculate a sum by looking at all students in all tutorials", since each "$_{ik}$" corresponds to one student.$^a$ But, as we saw in @sec-Estimating-unknown-quantities-from-a-sample, calculating the variance by dividing by N produces a biased estimate of the population variance. And previously we needed to divide by $(N - 1)$ to fix this. However, as I mentioned at the time, the reason why this bias exists is because the variance estimate relies on the sample mean, and to the extent that the sample mean isn't equal to the population mean it can systematically bias our estimate of the variance. But this time we're relying on two sample means! Does this mean that we've got more bias? Yes, yes it does. And does this mean we now need to divide by $(N - 2)$ instead of $(N - 1)$, in order to calculate our pooled variance estimate? Why, yes $$\hat {\sigma}_p^2=\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N-2}$$  Oh, and if you take the square root of this then you get $\hat{\sigma}_p$, the pooled standard deviation estimate. In other words, the pooled standard deviation calculation is nothing special. It's not terribly different to the regular standard deviation calculation. <br /> --- <br />$^a$ A more correct notation will be introduced in @sec-Comparing-several-means-one-way-ANOVA. --->

## 獨立樣本t檢定的更多細節

無論讀者想以那種方式理解，我們現在有了樣本標準差的合併估計值。現在開始使用的符號，不會再加上那個奇怪的下標$_p$，只寫成$\hat{\sigma}$。好極了，現在回來繼續說明這個該死的假設檢定程序吧？我們計算標準誤的合併估計值的主要原因是因為這種方法非常有用，但是標準誤究竟是什麼？
[單一樣本t檢定]的樣本平均值標準誤是$se(\bar{X})$，因為$se(\bar{X}) = \frac{\sigma}{\sqrt{N}}$，也就是t統計值的分母。然而，在獨立樣本的設計，我們有兩個樣本平均值。而研究者真正有興趣的是兩組之間的差異$\bar{X}_1-\bar{X}_2$，因此，放在分母的標準誤，真面目是平均值差異的**標準誤**。

[其他技術細節[^11-comparing-two-means-13]]

[^11-comparing-two-means-13]: 只要這兩組樣本的標準差確實相等，標準誤的估計值公式就是 $$SE(\bar{X}_1-\bar{X}_2)=\hat{\sigma}\sqrt{\frac{1}{N_1}+\frac{1}{N_2}}$$ 所以 t 統計值的公式是 $$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

如同[單一樣本t檢定]所學到的，只要虛無假設為真，而且都符合所有適要條件，t 統計值的取樣分佈就是 t 分佈。然而，這裡的自由度計算方法略有不同。通常，我們可以把自由度視為資料點個數減去要估計的變項個數。有關獨立組設計，我們有 $n$ 個觀察值（樣本 1有$n_1$ 個，樣本 2 有$n_2$個），和 2 個變項（樣本平均值）。因此，獨立樣本t檢定的自由度是 $n_1 + n_2 -2$。

<!---Regardless of which way you want to think about it, we now have our pooled estimate of the standard deviation. From now on, I'll drop the silly p subscript, and just refer to this estimate as $\hat{\sigma}$. Great. Let's now go back to thinking about the bloody hypothesis test, shall we? Our whole reason for calculating this pooled estimate was that we knew it would be helpful when calculating our standard error estimate. But standard error of what? In the one-sample t檢定 it was the standard error of the sample mean, $se(\bar{X})$, and since $se(\bar{X}) = \frac{\sigma}{\sqrt{N}}$ that's what the denominator of our t-statistic looked like. This time around, however, we have two sample means. And what we're interested in, specifically, is the the difference between the two $\bar{X}_1-\bar{X}_2$ As a consequence, the standard error that we need to divide by is in fact the **standard error of the difference** between means.

[Additional technical detail [^11-comparing-two-means-13]]

[^11-comparing-two-means-13]: As long as the two variables really do have the same standard deviation, then our estimate for the standard error is $$SE(\bar{X}_1-\bar{X}_2)=\hat{\sigma}\sqrt{\frac{1}{N_1}+\frac{1}{N_2}}$$ and our t-statistic is therefore $$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

Just as we saw with our one-sample test, the sampling distribution of this t-statistic is a t-distribution (shocking, isn't it?) as long as the null hypothesis is true and all of the assumptions of the test are met. The degrees of freedom, however, is slightly different. As usual, we can think of the degrees of freedom to be equal to the number of data points minus the number of constraints. In this case, we have N observations ($N_1$ in sample 1, and $N_2$ in sample 2), and 2 constraints (the sample means). So the total degrees of freedom for this test are $N - 2$. --->

### jamovi實作

> **譯者註** 本單元內容為AI初翻，請謹慎使用。

不出所料，您可以很容易地在 jamovi 中進行獨立樣本 t 檢定。我們測試的結果變項是學生成績，而組是根據每個課程的導師定義的。因此，您可能不會對 jamovi 中的相應分析（“分析”-“T 檢定”-“獨立樣本 T 檢定”）感到意外，只需將成績變項移動到“依變變項”框中，將導師變項移動到“分組變項”框中，如 @fig-fig11-9 所示。

<!---Not surprisingly, you can run an independent samples t檢定 easily in jamovi. The outcome variable for our test is the student grade, and the groups are defined in terms of the tutor for each class. So you probably won't be too surprised that all you have to do in jamovi is go to the relevant analysis ('Analyses' - 't檢定s' - 'Independent Samples t檢定') and move the grade variable across to the 'Dependent Variables' box, and the tutor variable across into the 'Grouping Variable' box, as shown in @fig-fig11-9. --->

```{r}
#| label: fig-fig11-9
#| classes: .enlarge-image
#| fig-cap: jamovi執行獨立樣本t檢定示範，請留意圖中勾選的項目。
#Independent t檢定 in jamovi, with options checked for useful results
knitr::include_graphics("images/fig11-9.png")
```

這裡的輸出形式非常熟悉。首先，它告訴您運行的是什麼測試，以及使用的依變項的名稱。然後報告測試結果。與上次一樣，測試結果包括 t 統計值、自由度和 p 值。最後一部分報告了兩件事：它給出了信賴區間和效應大小。我會稍後談論效應大小。然而，現在我應該談論信賴區間。

很重要要清楚這個信賴區間到底是什麼意思，它是兩組平均數之間的差異的信賴區間。在這個例子中，Anastasia的學生平均分為74.53，而Bernadette的學生平均分為69.06，因此兩組平均數之間的差異是5.48。但是，兩個母群的平均數差異可能比這個還大或者還小。在@fig-fig11-10中報告的信賴區間告訴你，如果我們重複進行這個研究，那麼在95％的時間裡，真正的平均數差異會在0.20到10.76之間。回顧一下@sec-Estimating-a-confidence-interval了解信賴區間的意思。

在任何情況下，兩組之間的差異是顯著的（僅僅）。因此，我們可以使用以下文本編寫結果:

> Anastasia 課程的平均成績為 $74.5\%$（標準差為 $9.0$），而 Bernadette 課程的平均成績為 $69.1\%$（標準差為 $5.8$）。 學生的獨立樣本 t 檢定顯示此 $5.4\%$ 差異是顯著的 $(t(31) = 2.1, p<.05, CI_{95} = [0.2, 10.8], d = .74)$，表明學習成果存在真正的差異。

注意到我在統計區塊中包含了信心區間和效應大小。人們並不總是這樣做。至少，您應該期望看到t統計值、自由度和p值。所以您應該至少包含像這樣的內容：$t(31) = 2.1, p< .05$。如果統計學家得到了他們想要的結果，那麼每個人都會報告信心區間，可能還有效應大小測量，因為它們是有用的知識。但現實並不總是按照統計學家的期望運作，所以您應該根據您認為會幫助讀者的情況進行判斷，如果您正在撰寫科學論文，那麼應根據期刊的編輯標準進行決策。有些期刊希望您報告效應大小，而有些則不是。在某些科學社區中，報告信心區間是標準做法，在其他社區中則不是。您需要找出您的觀眾期望什麼。但是，僅僅為了清晰起見，如果您正在上我的課，我的默認立場是通常值得包括效應大小和信心區間。

<!---The output has a very familiar form. First, it tells you what test was run, and it tells you the name of the dependent variable that you used. It then reports the test results. Just like last time the test results consist of a t-statistic, the degrees of freedom, and the *p-value*. The final section reports two things: it gives you a confidence interval and an effect size. I'll talk about effect sizes later. The confidence interval, however, I should talk about now.

It's pretty important to be clear on what this confidence interval actually refers to. It is a confidence interval for the *difference* between the group means. In our example, Anastasia's students had an average grade of $74.53$, and Bernadette's students had an average grade of $69.06$, so the difference between the two sample means is $5.48$. But of course the difference between population means might be bigger or smaller than this. The confidence interval reported in @fig-fig11-10 tells you that there's a if we replicated this study again and again, then $95\%$ of the time the true difference in means would lie between $0.20$ and $10.76$. Look back at @sec-Estimating-a-confidence-interval for a reminder about what confidence intervals mean.

In any case, the difference between the two groups is significant (just barely), so we might write up the result using text like this:

> The mean grade in Anastasia's class was $74.5\%$ (std dev = $9.0$), whereas the mean in Bernadette's class was $69.1\%$ (std dev = $5.8$). A Student's independent samples t檢定 showed that this $5.4\%$ difference was significant $(t(31) = 2.1, p<.05, CI_{95} = [0.2, 10.8], d = .74)$, suggesting that a genuine difference in learning outcomes has occurred.

Notice that I've included the confidence interval and the effect size in the stat block. People don't always do this. At a bare minimum, you'd expect to see the t-statistic, the degrees of freedom and the p value. So you should include something like this at a minimum: $t(31) = 2.1, p< .05$. If statisticians had their way, everyone would also report the confidence interval and probably the effect size measure too, because they are useful things to know. But real life doesn't always work the way statisticians want it to so you should make a judgement based on whether you think it will help your readers and, if you're writing a scientific paper, the editorial standard for the journal in question. Some journals expect you to report effect sizes, others don't. Within some scientific communities it is standard practice to report confidence intervals, in others it is not. You'll need to figure out what your audience expects. But, just for the sake of clarity, if you're taking my class, my default position is that it's usually worth including both the effect size and the confidence interval. --->

### t統計值正負的意義

繼續談t檢定的適用條件之前，我們先來討論t檢定的實務還有一個重要觀點。首先是關於t統計值的前面，究竟要不要加上負號( - )。許多學生第一次演練t檢定時，常常會擔心算出負值，就不知道怎麼解釋。其實現實的研究案例經常會看到，一項實驗由兩位不同的人各自獨立進行，獲得的結果幾乎相同，但是其中一位算出的t值是負的，另一位的t值是正的。若進行的是雙側檢定，那麼p值會是相同的。再仔細檢查一次後，學生們通常會發現信賴區間也是相反的，這是完全正常的。每當這類情況發生時，你會發現兩種不同的結果是由稍微不同的t檢定方法引起的。這裡發生的事情非常簡單，這個單元學到的t統計值都是具備以下的形式

$$t=\frac{\text{平均值1-平均值2}}{SE}$$

如果 "平均值 1" 大於 "平均值 2"，則 t 統計值就會是正數，而如果 "平均值 2" 大於 "平均值 1"，則 t 統計值就會是負數。同樣地，jamovi 報告的信賴區間是 "(平均值 1) 減去 (平均值 2)" 差異的信賴區間，與 "(平均值 2) 減去 (平均值 1)" 差異信賴區間剛好相反。

好啦，想通這一點後，會覺得很簡單，但現在要來算一算比較Anastasia和Bernadette兩位助教輔導成效的 t 檢定了。我們應該把哪一個命名為 "平均值 1"，哪一個命名為 "平均值 2"，其實你可以任意決定。然而，實作中真的需要將其中之一指定為 "平均值1"，另一個為 "平均值 2"。毫不意外，jamovi 介面的處理提示也相當任意。在本書早期的版本，原作者曾試著花些功夫解釋，但經過幾次改版後，現在已經放棄了，因為如何命名並不是真正重要的事情，老實說原作者自己也記不清楚為何一開始要試著解釋。有經驗的研究者看到一個顯著的 t 檢定結果，想知道那一組的平均值較大，其實不會去看t 統計值是多少，而是直接看分組平均值。為什麼不必看t統計值，因為 jamovi 輸出的表格就一目了解地印出分組平均值！

這是重要的一點。因為 jamovi 輸出的報表其實不是完全符合報告規範的，通常報告中出現的報告 t 統計值要重新編輯。如果我想在報告中寫道：「阿納斯塔西亞輔導的學生成績高於Bernadette的學生。」這種措辭意味著阿納斯塔西亞的班排在前面，因此把阿納斯塔西亞設定為第一組是有道理的。若是如此，我會寫成 *阿納斯塔西亞輔導的學生成續比Bernadette輔導的學生更*<u>高</u>$(t(31) = 2.1，p = .04)$。

真正的報告寫作不會真的用底線來強調 ，這樣寫只是為了強調 <u>高</u> 對應 t 統計值的正數。另一方面，若是想要強調 Bernadette 的輔導成效，把她的班級指定為第一組更有意義，這樣的話報告應該寫成：Bernadette 輔導的學生成績比 Anastasia 的學生低 $(t(31) = -2.1, p = .04)$。

最後要注意的是，這種報告的寫作格式只適用t檢定，對於卡方檢定、F檢定、或本書提到的大多數檢定方法並無意義。因此不要將這個建議過度類比使用！在這裡真的只有談論t檢定，而不是其他統計方法！

<!--- Before moving on to talk about the assumptions of the t檢定, there's one additional point I want to make about the use of t檢定s in practice. The first one relates to the sign of the t-statistic (that is, whether it is a positive number or a negative one). One very common worry that students have when they start running their first t檢定 is that they often end up with negative values for the t-statistic and don't know how to interpret it. In fact, it's not at all uncommon for two people working independently to end up with results that are almost identical, except that one person has a negative t values and the other one has a positive t value. Assuming that you're running a two-sided test then the p-values will be identical. On closer inspection, the students will notice that the confidence intervals also have the opposite signs. This is perfectly okay. Whenever this happens, what you'll find is that the two versions of the results arise from slightly different ways of running the t檢定. What's happening here is very simple. The t-statistic that we calculate here is always of the form

$$t=\frac{\text{mean 1-mean 2}}{SE}$$

If "mean 1" is larger than "mean 2" the t statistic will be positive, whereas if "mean 2" is larger then the t statistic will be negative. Similarly, the confidence interval that jamovi reports is the confidence interval for the difference "(mean 1) minus (mean 2)", which will be the reverse of what you'd get if you were calculating the confidence interval for the difference "(mean 2) minus (mean 1)".

Okay, that's pretty straightforward when you think about it, but now consider our t檢定 comparing Anastasia's class to Bernadette's class. Which one should we call "mean 1" and which one should we call "mean 2". It's arbitrary. However, you really do need to designate one of them as "mean 1" and the other one as "mean 2". Not surprisingly, the way that jamovi handles this is also pretty arbitrary. In earlier versions of the book I used to try to explain it, but after a while I gave up, because it's not really all that important and to be honest I can never remember myself. Whenever I get a significant t檢定 result, and I want to figure out which mean is the larger one, I don't try to figure it out by looking at the t-statistic. Why would I bother doing that? It's foolish. It's easier just to look at the actual group means since the jamovi output actually shows them!

Here's the important thing. Because it really doesn't matter what jamovi shows you, I usually try to report the t-statistic in such a way that the numbers match up with the text. Suppose that what I want to write in my report is: *Anastasia's class had higher grades than Bernadette's class*. The phrasing here implies that Anastasia's group comes first, so it makes sense to report the t-statistic as if Anastasia's class corresponded to group 1. If so, I would write *Anastasia's class had* <u>higher</u> grades than Bernadette's class $(t(31) = 2.1, p = .04)$.

(I wouldn't actually underline the word "higher" in real life, I'm just doing it to emphasise the point that "higher" corresponds to positive t values). On the other hand, suppose the phrasing I wanted to use has Bernadette's class listed first. If so, it makes more sense to treat her class as group 1, and if so, the write up looks like this: *Bernadette's class had* <u>lower</u> grades than Anastasia's class $(t(31) = -2.1, p = .04)$.

Because I'm talking about one group having "lower" scores this time around, it is more sensible to use the negative form of the t-statistic. It just makes it read more cleanly.

One last thing: please note that you can't do this for other types of test statistics. It works for t檢定s, but it wouldn't be meaningful for chi-square tests, F-tests or indeed for most of the tests I talk about in this book. So don't over-generalise this advice! I'm really just talking about t檢定s here and nothing else! --->

### 獨立樣本t檢定的適用條件 {#sec-independent-t-assumptions}

和[單一樣本t檢定]一樣，學生t檢定也有三項適用條件 ，其中一些在[單一樣本t檢定的適用條件]已經提到：

- *常態性*。和單一樣本t檢定一樣，樣本資料的取樣分佈必須是符合常態分佈。具體來說，兩組樣本資料都需要符合常態分佈。[^11-comparing-two-means-14a]在[檢查樣本常態性]一節，我們將討論如何檢查常態性；在[檢驗非常態資料]一節，我們將討論可能的解決方案。
- *獨立性*。其次是要確保每個資料觀測值的取樣是獨立的。以能運算學生t檢定的條件來說，有兩個性質需要考慮。首先，和單一樣本t檢定一樣，需要設定每個樣本包含的觀測值是相互獨立的。此外，我們還需要設定兩個樣本之間沒有相互依賴關係。例如，如果實驗中同一個人被不小心分派參與兩種條件組，像是同一個人不小心被允許報名參加不同條件的兩項獨立實驗，這麼一來就會造成一些跨樣本的依賴關係。
- *變異數的同質性*（又稱“等變異性”）。第三個條件 是指兩組的母群標準差必須是相等的，我們可以使用Levene檢定來測試這個假設，稍後在[檢查同質變異性的假設]示範。然而，如果您擔心違反這個條件，有一個非常簡單的解決方法，我們將在下一節中討論。

[^11-comparing-two-means-14a]: 嚴格來說，應該是指「平均數的差異樣本」呈現常態分佈，但是如果兩個組別的資料都呈現常態分佈，那麼平均值的差異也會呈現常態分佈。實際上，**中央極限定理**告訴我們，兩個樣本平均值的分佈，會隨著樣本量的增加，將會趨近常態分佈，而不論底層資料的實際分佈是什麼。

<!--- As always, our hypothesis test relies on some assumptions. So what are they? For the Student t檢定 there are three assumptions, some of which we saw previously in the context of the one sample t檢定 (see [Assumptions of the one sample t檢定]):

- *Normality.* Like the one-sample t檢定, it is assumed that the data are normally distributed. Specifically, we assume that both groups are normally distributed[^11-comparing-two-means-14a]. In the section on [Checking the normality of a sample] we'll discuss how to test for normality, and in [Testing non-normal data] we'll discuss possible solutions.
- *Independence.* Once again, it is assumed that the observations are independently sampled. In the context of the Student test this has two aspects to it. Firstly, we assume that the observations within each sample are independent of one another (exactly the same as for the one-sample test). However, we also assume that there are no cross-sample dependencies. If, for instance, it turns out that you included some participants in both experimental conditions of your study (e.g., by accidentally allowing the same person to sign up to different conditions), then there are some cross sample dependencies that you'd need to take into account.
- *Homogeneity of variance* (also called "homoscedasticity"). The third assumption is that the population standard deviation is the same in both groups. You can test this assumption using the Levene test, which I'll talk about later on in the book (in @sec-Checking-the-homogeneity-of-variance-assumption). However, there's a very simple remedy for this assumption if you are worried, which I'll talk about in the next section.

[^11-comparing-two-means-14a]: Strictly speaking, it is the **difference** in the means that should be normally distributed, but if both groups have normally distributed data then the difference in means will also be normally distributed. In practice, the Central Limit Theorem assures us that, generally, the distributions of the two sample means being tested will themselves approach normal distributions as the sample sizes get large, regardless of the distributions of the underlying data. --->

## 獨立樣本t檢定(Welch's t檢定) {#sec-the-independent-samples-t檢定-welch-test}

使用學生 t 檢定處理真正的統計問題，最大挑戰是變異數同 性的條件很難符合。現實的研究問題，很少存在變異數相等的兩組樣本資料。如果兩組樣本的平均值並不相等，有什麼理由期待兩組樣本的標準差相等呢？實際上許多研究者也不會計較資料有沒有符合變異數同質性。稍後會介紹如何檢查變異數同質性，因為許多統計方法都要依賴這個條件。此節先帶讀者們認識不需要依賴變異數同質性的 t 檢定~ Welch's t檢定 [@Welch1947]。 @fig-fig11-10 展示變異數不相等的統計假設，讀者可對比 @fig-fig11-8 ，適用學生t檢定的統計假設。在說明如何診斷是否適用之前，介紹如何實作修正方法是有點奇怪，但是 Welch's t 檢定可以在 jamovi 的「獨立樣本 t 檢定」模組選單中直接勾選，所以以下先介紹如何實作。

<!--- The biggest problem with using the Student test in practice is the third assumption listed in the previous section. It assumes that both groups have the same standard deviation. This is rarely true in real life. If two samples don't have the same means, why should we expect them to have the same standard deviation? There's really no reason to expect this assumption to be true. We'll talk a little bit about how you can check this assumption later on because it does crop up in a few different places, not just the t檢定. But right now I'll talk about a different form of the t檢定 [@Welch1947] that does not rely on this assumption. A graphical illustration of what the Welch t test assumes about the data is shown in @fig-fig11-10, to provide a contrast with the Student test version in @fig-fig11-8. I'll admit it's a bit odd to talk about the cure before talking about the diagnosis, but as it happens the Welch test can be specified as one of the 'Independent Samples t檢定' options in jamovi, so this is probably the best place to discuss it. --->

```{r}
#| label: fig-fig11-10
#| fig-width: 10
#| fig-height: 5
#| fig-cap: Welch's t 檢定的虛無假設和對立假設視覺化。與設定 Student t檢定程序相同（參考 @fig-fig11-9 ），設定兩組樣本都是來自同一個符合常態性的取樣分佈; 不過這裡的對立假設不必依賴兩組分佈的變異數相等。
#Graphical illustration of the null and alternative hypotheses assumed by the Welch t檢定. Like the Student test (@fig-fig11-9) we assume that both samples are drawn from a normal population; but the alternative hypothesis no longer requires the two populations to have equal variance

p1 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 70, sd = 6.5), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=70, y=.066, label=expression(~mu), size=5) +
  ylim(0,0.07) +
  ggtitle("虛無假設") +
  xlab("\n變項X數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 60, sd = 6.5), col="black", linewidth=1) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 75, sd = 7.95), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=60, y=.066, label=expression(~mu[1]), size=5) +
  geom_text(x=75, y=.055, label=expression(~mu[2]), size=5) +
  ylim(0,0.07) +
  ggtitle("對立假設") +
  xlab("\n變項X數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

Welch's t 檢定與 Student t 檢定的公式非常相似。計算 t 統計值的大同小異，都是取樣本平均數之間的差異，然後除以其標準誤的估計：

$$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

兩者的差異是標準誤的計算方式。若是兩組取樣的標準差並不相等，計算合併的標準差估計值是沒有意義的，這麼做就像是要把蘋果和橘子攪在一起。[^11-comparing-two-means-14]

[^11-comparing-two-means-14]: 嗯，我猜有讀者有辦法將蘋果和橙子攪在一起，做出一杯美味的綜合果汁。但是，沒有人真正會認為能從綜合果汁能嚐出攪拌前的原味，對吧？


[其他技術細節 [^11-comparing-two-means-15]]

[^11-comparing-two-means-15]: 使用者依然有可以樣本平均值差異，計算估計標準誤的公式，只是和Student t檢定的版本很不一樣： $$SE(\bar{X}_1-\bar{X}_2)=\sqrt{\frac{\hat{\sigma}_1^2}{N_1}+\frac{\hat{\sigma}_2^2}{N_2}}$$ 解釋為什麼要這樣算就超出了本書的範圍。對以本書學習統計的讀者來說，必須要知道的是 Welch's t檢定的 t 統計值與 Student t檢定的 t 統計值略有不同。

Welch's t 與 Student t 的第二個差異是自由度的計算方式。 Welch's t的自由度不必是一個整數，並且不太符合「資料點數量減去約束數量」的解釋方式，雖然這是原作者(還有世界上多數教統計的老師)到目前為止一直採納的解釋。

<!--- The Welch test is very similar to the Student test. For example, the t-statistic that we use in the Welch test is calculated in much the same way as it is for the Student test. That is, we take the difference between the sample means and then divide it by some estimate of the standard error of that difference

$$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

The main difference is that the standard error calculations are different. If the two populations have different standard deviations, then it's a complete nonsense to try to calculate a pooled standard deviation estimate, because you're averaging apples and oranges.[^11-comparing-two-means-14]

[^11-comparing-two-means-14]: Well, I guess you can average apples and oranges, and what you end up with is a delicious fruit smoothie. But no one really thinks that a fruit smoothie is a very good way to describe the original fruits, do they?

[Additional technical detail [^11-comparing-two-means-15]]

[^11-comparing-two-means-15]: But you can still estimate the standard error of the difference between sample means, it just ends up looking different $$SE(\bar{X}_1-\bar{X}_2)=\sqrt{\frac{\hat{\sigma}_1^2}{N_1}+\frac{\hat{\sigma}_2^2}{N_2}}$$ The reason why it's calculated this way is beyond the scope of this book. What matters for our purposes is that the t-statistic  that comes out of the Welch t檢定 is actually somewhat different to the one that comes from the Student t檢定.

The second difference between Welch and Student is that the degrees of freedom are calculated in a very different way. In the Welch test, the "degrees of freedom" doesn't have to be a whole number any more, and it doesn't correspond all that closely to the "number of data points minus the number of constraints" heuristic that I've been using up to this point. --->

### jamovi實作

> **譯者註** 本單元內容為AI初翻，請謹慎使用。

如果你在上面的分析中勾選了 Welch test 的核取方塊，則會得到以下結果（見@fig-fig11-11）。

<!--- If you tick the check box for the Welch test in the analysis we did above, then this is what it gives you (@fig-fig11-11). --->

```{r}
#| label: fig-fig11-11
#| classes: .enlarge-image
#| fig-cap: jamovi並列學生t檢定與Welch t檢定結果。
#Results showing the Welch test alongside the default Student's t檢定 in jamovi
knitr::include_graphics("images/fig11-11.png")
```

這個輸出結果的解釋應該很明顯。您可以像讀取學生t檢定的結果一樣讀取Welch檢驗的輸出。你有你的描述統計資料，測試結果和其他信息。所以這一切都相當容易。

除了，除了... 我們的結果不再顯著。 當我們執行Student t檢定時，我們得到了一個顯著的效應，但在相同的資料集上進行的Welch測試並不顯著 $(t(23.02) = 2.03, p = .054)$。 這是什麼意思？ 我們應該恐慌嗎？ 天空是否燃燒？ 可能不是。 一個測試顯著，而另一個測試不顯著本身並沒有什麼意義，特別是因為我有點編造了這些資料。 通常，不要試圖解釋或解釋$.049$和$.051$之間的p值差異。 如果這種情況在現實生活中發生，這些p值之間的差異幾乎肯定是由於偶然性引起的。 重要的是，您在選擇使用哪種測試時要仔細思考。 Student測試和Welch測試各有優勢和劣勢。 如果兩個母群確實具有相等的變異數，則Student測試比Welch測試略具備更高的功效（較低的II型錯誤率）。 但是，如果它們的變異數不同，則Student測試的假設就會被違反，您可能無法信任它。 您可能會得到更高的I型錯誤率。 因此，這是一個權衡。 但是，在現實生活中，我通常更喜歡使用Welch測試，因為幾乎沒有人認為母群變異數是相同的。


<!--- The interpretation of this output should be fairly obvious. You read the output for the Welch's test in the same way that you would for the Student's test. You've got your descriptive statistics, the test results and some other information. So that's all pretty easy.

Except, except...our result isn't significant anymore. When we ran the Student test we did get a significant effect, but the Welch test on the same data set is not $(t(23.02) = 2.03, p = .054)$. What does this mean? Should we panic? Is the sky burning? Probably not. The fact that one test is significant and the other isn't doesn't itself mean very much, especially since I kind of rigged the data so that this would happen. As a general rule, it's not a good idea to go out of your way to try to interpret or explain the difference between a p-value of $.049$ and a p-value of $.051$. If this sort of thing happens in real life, the *difference* in these p-values is almost certainly due to chance. What does matter is that you take a little bit of care in thinking about what test you use. The Student test and the Welch test have different strengths and weaknesses. If the two populations really do have equal variances, then the Student test is slightly more powerful (lower Type II error rate) than the Welch test. However, if they *don't* have the same variances, then the assumptions of the Student test are violated and you may not be able to trust it; you might end up with a higher Type I error rate. So it's a trade off. However, in real life I tend to prefer the Welch test, because almost no-one actually believes that the population variances are identical. --->

### Welch's t檢定的適用條件

Welch's t檢定的假設與學生t檢定的假設幾乎一樣，只有Welch's t檢定不需要符合變異數同質性。只要符合常態性和獨立性，這些條件的細節請參閱[單一樣本t檢定的適用條件]。

<!--- The assumptions of the Welch test are very similar to those made by the Student t檢定 (see [Assumptions of the test], except that the Welch test does not assume homogeneity of variance. This leaves only the assumption of normality and the assumption of independence. The specifics of these assumptions are the same for the Welch test as for the Student test. --->

## 相依樣本t檢定 {#sec-the-paired-t檢定}

不論是學生 t 檢定或Welch's t 檢定，獨立樣本 t 檢定只能處理兩組獨立樣本的研究資料。當參與者被隨機分派到其中一個實驗條件時，自然會符合獨立樣本的條件，但是很難處理其他類型的研究設計。特別是重覆測量的研究設計，並不適合使用獨立樣本 t 檢定進行分析。例如，有研究者想探討聽音樂是否降低人們的工作記憶容量，讓每位參與者分別在有音樂和無音樂的情況，測量他們的工作記憶容量。這樣的設計讓每位參與者接受*兩種*實驗條件[^11-comparing-two-means-16]，因此我們需要認識**相依樣本t檢定**。

[^11-comparing-two-means-16]: 重覆測量非常類似 @sec-The-McNemar-test 介紹的麥內瑪檢定所適用的研究問題。這並不奇怪，兩者都是標準的重覆測量設計，每個樣本都有兩次測量。唯一的區別是這裡的結果變項是等距尺度(工作記憶容量)，而不是名義尺度(是非題)。

<!--- Regardless of whether we're talking about the Student test or the Welch test, an independent samples t檢定 is intended to be used in a situation where you have two samples that are, well, independent of one another. This situation arises naturally when participants are assigned randomly to one of two experimental conditions, but it provides a very poor approximation to other sorts of research designs. In particular, a repeated measures design, in which each participant is measured (with respect to the same outcome variable) in both experimental conditions, is not suited for analysis using independent samples t檢定s. For example, we might be interested in whether listening to music reduces people's working memory capacity. To that end, we could measure each person's working memory capacity in two conditions: with music, and without music. In an experimental design such as this one, [^11-comparing-two-means-16] each participant appears in *both* groups. This requires us to approach the problem in a different way, by using the **paired samples t檢定**.

[^11-comparing-two-means-16]: This design is very similar to the one that motivated the McNemar test (@sec-The-McNemar-test). This should be no surprise. Both are standard repeated measures designs involving two measurements. The only difference is that this time our outcome variable is interval scale (working memory capacity) rather than a binary, nominal scale variable (a yes-or-no question). --->

### 示範資料

這次要分析的是修Chico老師課程的學生成績。[^11-comparing-two-means-17]她的學生都要參加學期初和學期末兩次大考，而且考試內容很難，大多數學生都覺得很有挑戰性。Chico老師的想法是，增加考試難度能激勵學生的學習動機。她的理論是，第一次考試對學生來說是一個“提醒”，當他們意識到課程的難度，會為了第二次考試取得更好的成績，而更加努力。Chico老師的觀點正確嗎？請讀者開啟jamovi資料集裡的範例檔*chico*。這次資料匯入jamovi後，每個變項的測量尺度都是正確的。*chico*資料集有三個變項：`id` \~ 每位學生的識別代號，`grade_test1` \~ 第一次考試的學生成績，`grade_test2` \~ 第二次考試的成績。

[^11-comparing-two-means-17]: 至此已經登場的老師有 Harpo、Chico和 Zeppo。雖然沒有贈品，讀者可以猜猜看 Groucho 會在那裡登場。

瞄一下展示在 @fig-fig11-12 的 jamovi 資料試算表，這門課程似乎滿有難度，多數學生的成績都在50分到60分之間，不過第一次測驗到第二次測驗看起來有進步的趨勢。

再來瞄一下描述統計表，前一段提到的印象似乎有些道理。全班20位學生的第一次測驗平均成績是57分，第二次測驗的平均成績是58分。因為兩次測驗的標準差分別為6.6和6.4，這種進步感覺起來只是表面的，可能只是隨機出現的結果。繼續看到 @fig-fig11-13a 展示的平均值和信賴區間後，很多讀者會更相信這班學生沒有步。因為只看信賴區間的寬度，我們會認為學生學習成果的改善只是偶然的。


<!--- The data set that we'll use this time comes from Dr Chico's class.[^11-comparing-two-means-17] In her class students take two major tests, one early in the semester and one later in the semester. To hear her tell it, she runs a very hard class, one that most students find very challenging. But she argues that by setting hard assessments students are encouraged to work harder. Her theory is that the first test is a bit of a "wake up call" for students. When they realise how hard her class really is, they'll work harder for the second test and get a better mark. Is she right? To test this, let's import the *chico.csv* file into jamovi. This time jamovi does a good job during the import of attributing measurement levels correctly. The *chico* data set contains three variables: an id variable that identifies each student in the class, the grade_test1 variable that records the student grade for the first test, and the grade_test2 variable that has the grades for the second test.

[^11-comparing-two-means-17]: At this point we have Drs Harpo, Chico and Zeppo. No prizes for guessing who Dr Groucho is.

If we look at the jamovi spreadsheet it does seem like the class is a hard one (most grades are between 50% and 60%), but it does look like there's an improvement from the first test to the second one.

If we take a quick look at the descriptive statistics, in @fig-fig11-12, we see that this impression seems to be supported. Across all 20 students the mean grade for the first test is 57%, but this rises to 58% for the second test. Although, given that the standard deviations are 6.6% and 6.4% respectively, it's starting to feel like maybe the improvement is just illusory; maybe just random variation. This impression is reinforced when you see the means and confidence intervals plotted in @fig-fig11-13a. If we were to rely on this plot alone, looking at how wide those confidence intervals are, we'd be tempted to think that the apparent improvement in student performance is pure chance. --->

```{r}
#| label: fig-fig11-12
#| classes: .enlarge-image
#| fig-cap: Chico資料集的兩次測驗成績資料及描述統計報表
#Descriptives for the two grade test variables in the *chico* data set
knitr::include_graphics("images/fig11-12.png")
```

不過，直覺的印象其實是錯的。要知道為什麼，請看 @fig-fig11-13b 展示的第一次和第二次成績的散佈圖。圖中的每個點對應一位學生的兩次成績。如果他們的第一次成績（x軸）等於第二次成績（y軸），每個點應該都會落在直線上，落在線上方的點是第二次測試成績有進步的學生。重要的是，幾乎所有資料點都在對角線以上，表示幾乎所有學生成績都有提高一些，即使只有一點點。這顯示原始資料應該是每個學生的第一次測驗到第二次測驗的進步幅度，因此我們需要在*chico* 資料集裡建立一個新變項，表示每位學生的進步分數。最簡單的方法是建立一個計算變項，函式欄位裡就置入 `grade test2` - `grade test1`。

<!--- Nevertheless, this impression is wrong. To see why, take a look at the scatterplot of the grades for test 1 against the grades for test 2, shown in @fig-fig11-13b. In this plot each dot corresponds to the two grades for a given student. If their grade for test 1 (x co-ordinate) equals their grade for test 2 (y co-ordinate), then the dot falls on the line. Points falling above the line are the students that performed better on the second test. Critically, almost all of the data points fall above the diagonal line: almost all of the students do seem to have improved their grade, if only by a small amount. This suggests that we should be looking at the improvement made by each student from one test to the next and treating that as our raw data. To do this, we'll need to create a new variable for the improvement that each student makes, and add it to the *chico* data set. The easiest way to do this is to compute a new variable, with the expression grade test2 - grade test1. --->

::: {#fig-fig11-13 layout-ncol=2 layout-valign="bottom" width=80%}

![](images/fig11-13a.png){#fig-fig11-13a fig-align="left" width=40%}

![](images/fig11-13b.png){#fig-fig11-13b fig-align="left" width=40%}

第一次測驗和第二次測驗的平均分數，以及對應的95％信賴區間(a)；展示每位學生第一次測驗和第二次測驗分數的散佈圖(b)。
<!---Mean grade for test 1 and test 2, with associated 95\% confidence intervals (a). Scatterplot showing the individual grades for test 1 and test 2 (b).--->
:::

用新建立的變項畫出直方圖，就能顯示全班學生進步分數的分佈，如同 @fig-fig11-14 的輸出結果。仔細看一下這個直方圖，能明顯看到每位學生真的有進步。因為整張圖的大部分數值條分佈在大於零的區域，反映絕大多數學生的第二次測驗得分比第一次高。

<!---Once we have computed this new improvement variable we can draw a histogram showing the distribution of these improvement scores, shown in @fig-fig11-14. When we look at the histogram, it's very clear that there is a real improvement here. The vast majority of the students scored higher on test 2 than on test 1, reflected in the fact that almost the entire histogram is above zero.

Histogram showing the improvement made by each student in Dr Chico's class. Notice that almost the entire distribution is above zero - the vast majority of students did improve their performance from the first test to the second one
--->

![直方圖顯示 Chico 老師的每位學生的成績進步幅度。請注意到幾乎每個數值條都在 0 的右方——大多數學生在第二次考試中的表現確實有所提升。](images/fig11-14.png){#fig-fig11-14 fig-align="left" width=60%}



### 深入認識相依樣本t檢定

延續前面的討論，接著來思考如何建立一個合適的 t 檢定程序。目前所知的可行方法是採用獨立樣本 t 檢定，比較`grade_test1`和`grade_test2`在結果變項的差異。不過，使用獨立樣本 t 檢定顯然是錯誤的，因為必須設定兩組樣本之間沒有特定關聯性。由於樣本資料是重複測量形成的，很顯然有存在關聯性。以 @sec-A-brief-introduction-to-research-design 提過的影響研究效度的各種設計條件來說，使用獨立樣本 t 檢定的話，會混淆這裡要檢定的 **樣本內** 差異及非檢定目標的**樣本間** 變異。

因為在 @sec-the-independent-samples-t-test-student-test ，讀者應該已經搞清楚最難懂的部分，要解決這個問題的方法很明確。這裡不是將`grade_test1`和`grade_test2`分組進行獨立樣本t檢定，而是對集合進步分數的差異變項improvement進行相依樣本t檢定。改用數學符號描述的話，$X_{i1}$是第i個參與者在`grade_test1`的分數，$X_{i2}$是同一個人在`grade_test2`的分數，所以差異分數是：


$$D_i=X_{i1}-X_{i2}$$

請注意，差異分數是變項1減變項2的數值，而不是反過來。若是要有採用多數為正數的差異分數，實務要將`grade_test2`當做「變項1」。同樣地，我們會定義 $\mu_D = \mu_1 - \mu_2$ 是差異分數的母群平均值。運用這套符號設定統計假設，虛無假設會表示此差異值是零，對立假設則表示不是零：


$$H_0:\mu_D=0$$ 
$$H_1:\mu_D \neq 0$$

這裡設定鎮進行雙側檢定，進行與前面介紹的t檢定程序一樣的假設檢定。唯一不同之處是虛無假設所設定的期望值為0。所以，t 統計值可以用類似的定義方式。如果用 $\bar{D}$ 代表差異分數的平均值，t統計值就是

$$t=\frac{\bar{D}}{SE(\bar{D})}$$

分母的 $\hat{\sigma}_D$ 是差異得分的標準差。因為這與單一樣本 t 檢定的內容沒有什麼不同之處，所以自由度仍然是 $n - 1$，至此我們該知道的都說完了。其實相依樣本 t 檢定並不是另一種的新方法，這種方法的本質就是檢測兩個變項之間差異分數的單一樣本 t 檢定，執行程序設定其實非常簡單。我們需要花這麼多篇幅討論的唯一原因是，使用本書學習的讀者要有能力辨認何時適用相依樣本t檢定，還有為什麼這個情況比獨立樣本 t 檢定更適合。

<!---In light of the previous exploration, let's think about how to construct an appropriate t test. One possibility would be to try to run an independent samples t檢定 using grade_test1 and grade_test2 as the variables of interest. However, this is clearly the wrong thing to do as the independent samples t檢定 assumes that there is no particular relationship between the two samples. Yet clearly that's not true in this case because of the repeated measures structure in the data. To use the language that I introduced in the last section, if we were to try to do an independent samples t檢定, we would be conflating the **within subject** differences (which is what we're interested in testing) with the **between subject** variability (which we are not).

The solution to the problem is obvious, I hope, since we already did all the hard work in the previous section. Instead of running an independent samples t檢定 on grade_test1 and grade_test2, we run a one-sample t檢定 on the within-subject difference variable, improvement. To formalise this slightly, if $X_{i1}$ is the score that the i-th participant obtained on the first variable, and $X_{i2}$ is the score that the same person obtained on the second one, then the difference score is:

$$D_i=X_{i1}-X_{i2}$$

Notice that the difference scores is variable 1 minus variable 2 and not the other way around, so if we want improvement to correspond to a positive valued difference, we actually want "test 2" to be our "variable 1". Equally, we would say that $\mu_D = \mu_1 - \mu_2$ is the population mean for this difference variable. So, to convert this to a hypothesis test, our null hypothesis is that this mean difference is zero and the alternative hypothesis is that it is not

$$H_0:\mu_D=0$$ $$H_1:\mu_D \neq 0$$

This is assuming we're talking about a two-sided test here. This is more or less identical to the way we described the hypotheses for the one-sample t檢定. The only difference is that the specific value that the null hypothesis predicts is 0. And so our t-statistic is defined in more or less the same way too. If we let $\bar{D}$ denote the mean of the difference scores, then

$$t=\frac{\bar{D}}{SE(\bar{D})}$$ which is $$t=\frac{\bar{D}}{\frac{\hat{\sigma}_D}{\sqrt{N}}}$$

where $\hat{\sigma}_D$ is the standard deviation of the difference scores. Since this is just an ordinary, one-sample t檢定, with nothing special about it, the degrees of freedom are still $N - 1$. And that's it. The paired samples t檢定 really isn't a new test at all. It's a one-sample t檢定, but applied to the difference between two variables. It's actually very simple. The only reason it merits a discussion as long as the one we've just gone through is that you need to be able to recognise *when* a paired samples test is appropriate, and to understand *why* it's better than an independent samples t test.--->

### jamovi實作

> **譯者註** 本單元內容為AI初翻，請謹慎使用。

如何在jamovi中執行相依樣本t檢定？一種可能的方法是按照我上面概述的過程進行。即，創建一個“差異”變項，然後對其進行單樣本t檢定。因為我們已經創建了一個名為improvement的變項，讓我們這麼做並看看我們得到什麼，如@fig-fig11-15所示。

<!--- How do you do a paired samples t檢定 in jamovi? One possibility is to follow the process I outlined above. That is, create a "difference" variable and then run a one sample t檢定 on that. Since we've already created a variable called improvement, let's do that and see what we get, @fig-fig11-15. --->

```{r}
#| label: fig-fig11-15
#| classes: .enlarge-image
#| fig-cap: 配對差異分數的單一樣本t檢定結果表。
#Results showing a one sample t檢定 on paired difference scores
knitr::include_graphics("images/fig11-15.png")
```

在 @fig-fig11-15 中顯示的輸出與上一次使用單樣本t檢定分析時（@sec-The-one-sample-t檢定）完全相同的格式，並確認了我們的直覺。從第一次測試到第二次測試，平均改善了1.4％，並且這與0顯著不同$(t(19)=6.48,p<.001)$。

然而，假設您很懶，不想花費大量精力創建新變項。或者也許您只想保持單樣本和相依樣本測試之間的差異清晰。如果是這樣，您可以使用jamovi的“相依樣本t檢定”分析，獲得 @fig-fig11-16 中顯示的結果。

<!--- The output shown in @fig-fig11-15 is (obviously) formatted exactly the same was as it was the last time we used the one-sample t檢定 analysis (@sec-The-one-sample-t檢定), and it confirms our intuition. There's an average improvement of $1.4\%$ from test 1 to test 2, and this is significantly different from $0$ $(t(19) = 6.48, p< .001)$.

However, suppose you're lazy and you don't want to go to all the effort of creating a new variable. Or perhaps you just want to keep the difference between one-sample and paired samples tests clear in your head. If so, you can use the jamovi 'Paired Samples t檢定' analysis, getting the results shown in @fig-fig11-16. --->

```{r}
#| label: fig-fig11-16
#| classes: .enlarge-image
#| fig-cap: 相依樣本t檢定結果表。請與 @fig-fig11-15 比較看看。
#Results showing a paired sample t檢定. Compare with @fig-fig11-15
knitr::include_graphics("images/fig11-16.png")
```

結果跟進行單樣本t檢定時的結果相同，這當然是因為成對樣本t檢定在實質上就是對差異變項執行單樣本t檢定。

<!--- The numbers are identical to those that come from the one sample test, which of course they have to be given that the paired samples t檢定 is just a one sample test under the hood. --->

## 單側檢定 {#sec-the-one-tail-t檢定}

> **譯者註** 本單元內容為AI初翻，請謹慎使用。

當介紹虛無假設檢定理論時，我提到有一些情況適合指定單邊檢定（請參閱 @sec-The-difference-between-one-sided-and-two-sided-tests ）。到目前為止，所有的t檢定都是雙邊檢定。例如，當我們為Zeppo博士課堂上的成績指定單一樣本t檢定時，虛無假設是真實均值為$67.5\%$。對立假設是真實均值高於或低於$67.5\%$。假設我們只想知道真實均值是否高於$67.5\%$，並且完全沒有興趣測試真實均值是否低於$67.5\%$。如果是這樣，我們的虛無假設將是真實均值為$67.5\%$或更低，對立假設將是真實均值高於$67.5\%$。在jamovi中，對於“單一樣本t檢定”分析，您可以在“假設”下點擊“> Test Value”選項進行指定。這樣做後，您將得到 @fig-fig11-17 顯示的結果。

<!--- When introducing the theory of null hypothesis tests, I mentioned that there are some situations when it's appropriate to specify a one-sided test (see @sec-The-difference-between-one-sided-and-two-sided-tests). So far all of the t檢定s have been two-sided tests. For instance, when we specified a one sample t檢定 for the grades in Dr Zeppo's class the null hypothesis was that the true mean was $67.5\%$. The alternative hypothesis was that the true mean was greater than or less than $67.5\%$. Suppose we were only interested in finding out if the true mean is greater than $67.5\%$, and have no interest whatsoever in testing to find out if the true mean is lower than $67.5\%$. If so, our null hypothesis would be that the true mean is $67.5\%$ or less, and the alternative hypothesis would be that the true mean is greater than $67.5\%$. In jamovi, for the 'One Sample t檢定' analysis, you can specify this by clicking on the '$>$ Test Value' option, under 'Hypothesis'. When you have done this, you will get the results as shown in @fig-fig11-17.--->

```{r}
#| label: fig-fig11-17
#| classes: .enlarge-image
#| fig-cap: jamovi生成的「單一樣本t檢定」結果，其中實際假設是單側的，即真實平均數大於 $67.5%$
#jamovi results showing a 'One Sample t檢定' where the actual hypothesis is one sided, i.e. that the true mean is greater than $67.5\%$
knitr::include_graphics("images/fig11-17.png")
```

注意到輸出與上次看到的輸出有一些變化。最重要的是實際假設已更改，以反映不同的測試。第二件要注意的事情是儘管t統計值和自由度沒有改變，但p值已經改變。這是因為單側測試具有與雙側測試不同的拒絕區域。如果您忘記了這是為什麼以及它意味著什麼，您可以回顧一下 @sec-Hypothesis-testing ，特別是 @sec-The-difference-between-one-sided-and-two-sided-tests 。第三件要注意的是信賴區間也不同：現在報告了一個“單側”的信賴區間，而不是一個雙側的信賴區間。在雙側信賴區間中，我們試圖找到數字a和b，使得如果我們重複進行該研究多次，那麼有$95\%$的機會均值會落在a和b之間。在單側信賴區間中，我們試圖找到一個數字a，使得我們有信心有$95\%$的機會真實均值會大於a（如果您在“假設”部分中選擇了測量1 < 測量2則為小於a）。

所有版本的t檢定都可以是單側的。對於獨立樣本t檢定，如果您只想測試A組的得分是否比B組高，但對於是否要找出B組的得分是否高於A組沒有興趣，那麼您可以進行單側檢定。假設對於Harpo博士的課程，您想知道Anastasia的學生是否比Bernadette的學生成績更好。對於此分析，在“假設”選項中指定“Group 1 \> Group2”。您應該可以得到如 @fig-fig11-18 所示的結果。

<!--- Notice that there are a few changes from the output that we saw last time. Most important is the fact that the actual hypothesis has changed, to reflect the different test. The second thing to note is that although the t-statistic and degrees of freedom have not changed, the p-value has. This is because the one-sided test has a different rejection region from the two-sided test. If you've forgotten why this is and what it means, you may find it helpful to read back over @sec-Hypothesis-testing, and @sec-The-difference-between-one-sided-and-two-sided-tests in particular. The third thing to note is that the confidence interval is different too: it now reports a "one-sided" confidence interval rather than a two-sided one. In a two-sided confidence interval we're trying to find numbers a and b such that we're confident that, if we were to repeat the study many times, then $95\%$ of the time the mean would lie between a and b. In a one-sided confidence interval, we're trying to find a single number a such that we're confident that $95\%$ of the time the true mean would be greater than a (or less than a if you selected Measure 1 < Measure 2 in the 'Hypothesis' section).

So that's how to do a one-sided one sample t檢定. However, all versions of the t檢定 can be one-sided. For an independent samples t test, you could have a one-sided test if you're only interested in testing to see if group A has higher scores than group B, but have no interest in finding out if group B has higher scores than group A. Let's suppose that, for Dr Harpo's class, you wanted to see if Anastasia's students had higher grades than Bernadette's. For this analysis, in the 'Hypothesis' options, specify that 'Group 1 \> Group2'. You should get the results shown in @fig-fig11-18. --->

```{r}
#| label: fig-fig11-18
#| classes: .enlarge-image
#| fig-cap: jamovi生成的'獨立樣本t檢定'分析，實際假設為單尾檢定，即 Anastasia 的學生的成績高於 Bernadette 的學生
#jamovi results showing an 'Independent Samples t檢定' where the actual hypothesis is one sided, i.e. that Anastasia's students had higher grades than Bernadette's
knitr::include_graphics("images/fig11-18.png")
```

再次強調，輸出結果有可預測的變化。對立假設的定義已改變，p值已變化，現在報告的是單邊信賴區間，而不是雙邊信賴區間。

那麼，相依樣本t檢定呢？假設我們想要測試 Dr Zeppo 課堂上考試成績是否從第一次測試到第二次測試有所提高，並且不考慮成績下降的可能性。在 jamovi 中，您可以通過在「假設」選項下指定 grade_test2 （在 jamovi 中為「測量1」，因為我們首先將其複製到了配對變項框中）\> grade_test1 （在 jamovi 中為「測量2」）來實現這一點。您應該可以看到 @fig-fig11-19 中的結果。

<!--- Again, the output changes in a predictable way. The definition of the alternative hypothesis has changed, the p-value has changed, and it now reports a one-sided confidence interval rather than a two-sided one.

What about the paired samples t檢定? Suppose we wanted to test the hypothesis that grades go up from test 1 to test 2 in Dr Zeppo's class, and are not prepared to consider the idea that the grades go down. In jamovi you would do this by specifying, under the 'Hypotheses' option, that grade_test2 ('Measure 1' in jamovi, because we copied this first into the paired variables box) \> grade test1 ('Measure 2' in jamovi). You should get the results shown in @fig-fig11-19.--->

```{r}
#| label: fig-fig11-19
#| classes: .enlarge-image
#| fig-cap: jamovi生成的'相依樣本t檢定'分析，實際假設為單尾檢定，即測驗1成績 \> 測驗2成績。
#jamovi results showing a 'Paired Samples t檢定' where the actual hypothesis is one sided, i.e. that grade test2 ('Measure 1') $>$ grade test1 ('Measure 2')
knitr::include_graphics("images/fig11-19.png")
```

這次的輸出和之前一樣，以可預測的方式改變。假設已經改變，p值也改變，並且信賴區間現在是單邊的。

<!--- Yet again, the output changes in a predictable way. The hypothesis has changed, the p-value has changed, and the confidence interval is now one-sided. --->



## t檢定的效果量 {#sec-t檢定-effect-size}

搭配t檢定最常使用的效果量度量是**Cohen's d** [@Cohen1988]。Cohen's d的原理看似簡單，不過仔細研究的話，會找到相當多樣的版本。發明者科恩提出的版本是為了定義符合完整適用條件的獨立樣本t檢定的效果量，也就是學生t。這個版本定義的效果量測量方法，自然是估計兩組平均值差異除以標準差。正如以下公式表明的內涵：

$$d=\frac{(\text{平均值1})-(\text{平均值2})}{\text{標準差}}$$

@tbl-tab11-3 列出科恩建議的Cohen's d簡易使用指南。

<!--- The most commonly used measure of effect size for a t檢定 is **Cohen's d** [@Cohen1988]. It's a very simple measure in principle, with quite a few wrinkles when you start digging into the details. Cohen himself defined it primarily in the context of an independent samples t檢定, specifically the Student test. In that context, a natural way of defining the effect size is to divide the difference between the means by an estimate of the standard deviation. In other words, we're looking to calculate something along the lines of this:

$$d=\frac{(\text{mean 1})-(\text{mean 2})}{\text{std dev}}$$

and he suggested a rough guide for interpreting $d$ in @tbl-tab11-3. --->

```{r}
#| label: tbl-tab11-3
#| tbl-cap: Cohen's d 超簡易參考指南，誠心建議不要盲目地使用這份指南，d統計值的公式已經是直白的解釋，公式就是以標準差為單位，計算平均值之間的差異是幾個標準差。最實用的建議是，想一下在實際的測量條件，平均值和標準差代表什麼。某些情境的「小」效應可能表示重要的實用效益，有些情況的「大」效應反而可能並沒有什麼意義。
#A (very) rough guide to interpreting Cohen's d. My personal recommendation is to not use these blindly. The d statistic has a natural interpretation in and of itself. It re-describes the difference in means as the number of standard deviations that separates those means. So it's generally a good idea to think about what that means in practical terms. In some contexts a 'small' effect could be of big practical importance. In other situations a 'large' effect may not be all that interesting
huxtabs[[11]][[3]] |>
  set_width(0.8) |>
  set_caption_width(1.2) |>
  set_caption_pos(value = "bottomleft")
```


也許有讀者覺得指南是很明確的參考，實際上並非如此。因為科恩並未提供太多以標準差做為測量單位的實用建議，他的著作是更想要是闡述一個更廣泛的觀點。就像 @McGrath2006 提到的幾種版本，不同學者有偏好的參考指南。本書採用不大精確的簡化參考，這裡開始所提到的$d$代表由樣本資料計算出的任何效果量統計值，$\delta$表示理論的效果量。因此讀者要學習如何區辨d的使用脈絡。

在本書提到的所有統計方法都有要運算的效果量，至於要計算Cohen's d只有t檢定，jamovi的每個t檢定模組都有一個選項，讓使用者決定要不要在報表輸出Cohen's d。

<!--- You'd think that this would be pretty unambiguous, but it's not. This is largely because Cohen wasn't too specific on what he thought should be used as the measure of the standard deviation (in his defence he was trying to make a broader point in his book, not nitpick about tiny details). As discussed by @McGrath2006, there are several different versions in common usage, and each author tends to adopt slightly different notation. For the sake of simplicity (as opposed to accuracy), I'll use d to refer to any statistic that you calculate from the sample, and use $\delta$ to refer to a theoretical population effect. Obviously, that does mean that there are several different things all called d.

My suspicion is that the only time that you would want Cohen's d is when you're running a t檢定, and jamovi has an option to calculate the effect size for all the different flavours of t檢定 it provides. --->



### 單一樣本的Cohen's d

單一樣本t檢定的Cohen's d是最單純的，效果量表示樣本平均值$\bar{X}$和母群平均值$\mu_0$的差異，並且有估計群體標準差$\hat{\sigma}$的合理方法，因此計算$d$的公式只有

$$d=\frac{\bar{X}-\mu_0}{\hat{\sigma}}$$

回顧 @fig-fig11-6 的分析報表，效果量是Cohen's d = 0.50。所以說，如果Zeppo老師的大部分學生成績接近預期水準（67.5），班上心理系學生成績（mean = 72.3）比預期水準高約0.5個標準差。根據 @tbl-tab11-3 ，這是一個中等效果量。


<!-- The simplest situation to consider is the one corresponding to a one-sample t檢定. In this case, this is the one sample mean $\bar{X}$ and one (hypothesised) population mean $\mu_0$ to compare it to. Not only that, there's really only one sensible way to estimate the population standard deviation. We just use our usual estimate $\hat{\sigma}$. Therefore, we end up with the following as the only way to calculate $d$

$$d=\frac{\bar{X}-\mu_0}{\hat{\sigma}}$$

When we look back at the results in @fig-fig11-6, the effect size value is Cohen's $d = 0.50$. Overall, then, the psychology students in Dr Zeppo's class are achieving grades ($mean = 72.3\%$) that are about .5 standard deviations higher than the level that you'd expect ($67.5\%$) if they were performing at the same level as other students. Judged against Cohen's rough guide, this is a moderate effect size. --->

### 獨立樣本的Cohen's d

許多介紹Cohen's d的教材只有談到獨立樣本t檢定，各種教材使用的符號分歧，加上分母成分的選擇不只一種，造成許多學生不知該學那一套，加上每位統計教師為了解釋如何處理獨立樣本問題，產生多種計算$d$的公式。為了統整各家公式，建議讀者先多看看，也可以手寫一下代表理論母群效果量$\delta$的公式來加深印象：

$$\delta=\frac{\mu_1-\mu_2}{\sigma}$$

如同 @sec-Estimating-unknown-quantities-from-a-sample 提到的符號說明，$\mu_1$和$\mu_2$分別是指第1組與第2組的母群平均值，$\sigma$代表母群標準差，如果兩組都是來自同一個母群的話。所以$\delta$的估計值與t統計數的公式幾乎一致，也就是分子是樣本平均值，分母是合併的標準差估計值

$$d=\frac{\bar{X}_1-\bar{X}_2}{\hat{\sigma}_p}$$

$\hat{\sigma}_p$的估計值就是獨立樣本t檢定的[標準差的合併估計值]這一節所介紹的公式，這是搭配Student t檢定所使用的Cohen's d，也是jamovi報表的輸出結果。有時也被稱為Hedges' g [@Hedges1981]。

除此之外還有其他計算方法，這裡簡單介紹一下。若是只想用其中一組的樣本標準差做為計算基礎，也就是研究者有充分理由認定其中一組比另一組能更純粹地反映「自然變異」，就可以使用Glass' $\triangle$。像是其中一組是對照組時，有統計學者使用Glass' $\triangle$才是$\delta$的合理估計值。再者 ，獨立樣本的合併標準差計算公式裡，分母通常是$n - 2$以校正估計值。另一個Cohen's d的版本則沒有這樣的校正，分母就是$n$。這個版本適用於研究者只想計算以樣本為主的效果量，而非估計$\delta$。最後，還有 @Hedges1985 提出的Hedges' g也是不少研究者會採用的計算方法，這個方法是對Cohen's d的合併標準差做更進一步的校正。[^11-comparing-two-means-18]

[^11-comparing-two-means-18]: 將Cohen's $d$乘以$\frac{(N - 3)}{(N - 2.25)}$，就是Hedges' g。

<!--- The majority of discussions of Cohen's $d$ focus on a situation that is analogous to Student's independent samples t test, and it's in this context that the story becomes messier, since there are several different versions of $d$ that you might want to use in this situation. To understand why there are multiple versions of $d$, it helps to take the time to write down a formula that corresponds to the true population effect size $\delta$. It's pretty straightforward,

$$\delta=\frac{\mu_1-\mu_2}{\sigma}$$

where, as usual, $\mu_1$ and $\mu_2$ are the population means corresponding to group 1 and group 2 respectively, and $\sigma$ is the standard deviation (the same for both populations). The obvious way to estimate $\delta$ is to do exactly the same thing that we did in the t檢定 itself, i.e., use the sample means as the top line and a pooled standard deviation estimate for the bottom line

$$d=\frac{\bar{X}_1-\bar{X}_2}{\hat{\sigma}_p}$$

where $\hat{\sigma}_p$ is the exact same pooled standard deviation measure that appears in the t檢定. This is the most commonly used version of Cohen's d when applied to the outcome of a Student t檢定, and is the one provided in jamovi. It is sometimes referred to as Hedges' $g$ statistic [@Hedges1981].

However, there are other possibilities which I'll briefly describe. Firstly, you may have reason to want to use only one of the two groups as the basis for calculating the standard deviation. This approach (often called Glass' $\triangle$, pronounced delta) only makes most sense when you have good reason to treat one of the two groups as a purer reflection of "natural variation" than the other. This can happen if, for instance, one of the two groups is a control group. Secondly, recall that in the usual calculation of the pooled standard deviation we divide by $N - 2$ to correct for the bias in the sample variance. In one version of Cohen's d this correction is omitted, and instead we divide by $N$. This version makes sense primarily when you're trying to calculate the effect size in the sample rather than estimating an effect size in the population. Finally, there is a version called Hedge's g, based on @Hedges1985, who point out there is a small bias in the usual (pooled) estimation for Cohen's d.[^11-comparing-two-means-18]

[^11-comparing-two-means-18]: They introduce a small correction by multiplying the usual value of $d$ by $\frac{(N - 3)}{(N - 2.25)}$.

In any case, ignoring all those variations that you could make use of if you wanted, let's have a look at the default version in jamovi. In @fig-fig11-10 Cohen's $d = 0.74$, indicating that the grade scores for students in Anastasia's class are, on average, $0.74$ standard deviations higher than the grade scores for students in Bernadette's class. For a Welch test, the estimated effect size is the same (@fig-fig11-12). --->



### 相依樣本的Cohen's d

最後是相依樣本t檢定，要怎麼計算呢？這要取決於研究者的目標。jamovi的預設是根據差異分數的分佈來衡量效果量，計算公式是：

$$d=\frac{\bar{D}}{\hat{\sigma}_D}$$

分母的$\hat{\sigma}_D$是差異的標準差估計。 @fig-fig11-16 報表裡的Cohen's $d = 1.45$，表示第2次測驗的分數平均比第1次測驗的分數高$1.45$個標準差。

這就是jamovi「相依樣本t檢定」分析報告的Cohen's d的計算方法，寫正式報告前唯一的麻煩是要搞清楚這是不是真正的估計值。這要看研究者是想用*原始分數*，還是用*差異分數*衡量效果量，像是以Chico老師教的學生成績變異值來看，兩次測驗只有改進1%看起來不大明顯。這個狀況很像要選擇用Student's t 檢定還是Welch's t檢定 評估兩組之間的差異。想要以*原始分數*計算Cohen's d，就要從資料試算表更改資料結構，雖 在這裡不方便說明及示範[^11-comparing-two-means-19]，我們可以算出$0.22$，以原始分數來說是偏小的效果量。


[^11-comparing-two-means-19]: 有興趣的讀者可以自行查看*chico2.omv*的成果。(譯者註)現在有新模組`jReshape`及`jTransform`可讓使用者轉換資料結構。

<!--- Finally, what should we do for a paired samples t檢定? In this case, the answer depends on what it is you're trying to do. jamovi assumes that you want to measure your effect sizes relative to the distribution of difference scores, and the measure of d that you calculate is:

$$d=\frac{\bar{D}}{\hat{\sigma}_D}$$

where $\hat{\sigma}_D$ is the estimate of the standard deviation of the differences. In @fig-fig11-16 Cohen's $d = 1.45$, indicating that the time 2 grade scores are, on average, $1.45$ standard deviations higher than the time 1 grade scores.

This is the version of Cohen's $d$ that gets reported by the jamovi 'Paired Samples t檢定' analysis. The only wrinkle is figuring out whether this is the measure you want or not. To the extent that you care about the practical consequences of your research, you often want to measure the effect size relative to the *original* variables, not the *difference scores* (e.g., the 1% improvement in Dr Chico's class over time is pretty small when measured against the amount of between-student variation in grades), in which case you use the same versions of Cohen's d that you would use for a Student or Welch test. It's not so straightforward to do this in jamovi; essentially you have to change the structure of the data in the spreadsheet view so I won't go into that here[^11-comparing-two-means-19], but the Cohen's d for this perspective is quite different: it is $0.22$ which is quite small when assessed on the scale of the original variables.

[^11-comparing-two-means-19]: If you are interested, you can look at how this was done in the *chico2.omv* file --->


## 檢測樣本常態性 {#sec-Checking-the-normality-of-a-sample}

這個單元介紹所有檢定方法都需要的適用條件～樣本資料要符合常態性，根據中心極限定理（見 @sec-The-central-limit-theorem ），來自隨機取樣的樣本只要數量夠大，樣本分佈都會符合常態分佈，所以這個條件通常是合理的。研究者通常關心的變項*實際上*是由多項觀察的平均值構成樣本，累積的樣本很可能符合常態分佈，或者至少接近常態分佈，讓研究者能安心使用t檢定。但是現實世界不會給研究者保證，有許多偏差的研究方法會造成變項的樣本形成非常態的分佈。像是樣本資料都是研究變項尺度的最小值，可能造成偏斜的分佈。許多心理學實驗會測量的反應時間就是一個很好的例子。如果研究者認為許多條件都會觸發人類參與者的反應，最真實的反應只會出現在研究者感興趣的觸發事件第一次發生之後。[^11-comparing-two-means-20]如此，將導致反應時間資料分佈不符合常態性。那麼，如果常態性是所有檢定方法必須符合的條件，現實世界的多數樣本資料也能符合，那麼要如何檢查樣本的常態性呢？以下介紹兩種方法：分位數對分位數圖(Q-Q plot)和Shapiro-Wilk檢驗。



[^11-comparing-two-means-20]:這裡的描述其實過度簡化。

<!--- All of the tests that we have discussed so far in this chapter have assumed that the data are normally distributed. This assumption is often quite reasonable, because the Central Limit Theorem (see @sec-The-central-limit-theorem) does tend to ensure that many real world quantities are normally distributed. Any time that you suspect that your variable is *actually* an average of lots of different things, there's a pretty good chance that it will be normally distributed, or at least close enough to normal that you can get away with using t檢定s. However, life doesn't come with guarantees, and besides there are lots of ways in which you can end up with variables that are highly non-normal. For example, any time you think that your variable is actually the minimum of lots of different things, there's a very good chance it will end up quite skewed. In psychology, response time (RT) data is a good example of this. If you suppose that there are lots of things that could trigger a response from a human participant, then the actual response will occur the first time one of these trigger events occurs.[^11-comparing-two-means-20] This means that RT data are systematically non-normal. Okay, so if normality is assumed by all the tests, and is mostly but not always satisfied (at least approximately) by real world data, how can we check the normality of a sample? In this section I discuss two methods: QQ plots and the Shapiro-Wilk test.

[^11-comparing-two-means-20]: This is a massive oversimplification.--->

### 分位數對分位數圖


檢查樣本資料是否違反常態性條件的一種方法是繪製**“Q-Q圖”**（分位數對分位數圖，Quantile-Quantile plot），這種視覺化方法讓任何系統性非常態資料現形，讓研究者直接檢查。每個觀察值在Q-Q圖都是以一個單獨的點顯示，如同 @fig-fig11-20 是從理論的常態分佈生成的隨機數值做為資料，所繪製形成的Q-Q圖。x軸的數值是各觀察值的理論分位數，以樣本估計平均值和離均差計算的標準化殘差(Standardized Residuals)；y軸的數值是各觀察值的實際分位數。如果資料是常態的，所有點應該排列成一條直線。
x軸是觀察值在資料常態分佈（用樣本估計均值和方差）的情況下應該落入的理論分位數，y軸是資料在樣本中的實際分位數。如果資料是常態的，點應該形成一條直線。

<!--- One way to check whether a sample violates the normality assumption is to draw a **"Q-Q plot"** (
分位數對分位數圖, Quantile-Quantile plot). This allows you to visually check whether you're seeing any systematic violations. In a QQ plot, each observation is plotted as a single dot. The x coordinate is the theoretical quantile that the observation should fall in if the data were normally distributed (with mean and variance estimated from the sample), and on the y co-ordinate is the actual quantile of the data within the sample. If the data are normal, the dots should form a straight line. For instance, lets see what happens if we generate data by sampling from a normal distribution, and then drawing a QQ plot. The results are shown in @fig-fig11-20.--->

```{r}
#| label: fig-fig11-20
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 直方圖(a)和常態Q-Q圖(b)顯示有 100 個觀測值的常態分佈樣本。這些資料的 Shapiro-Wilk 統計值是 $W = .99$，表示這份資料未顯著偏離常態性（$p = .54$）。
#Histogram (panel (a)) and normal QQ plot (panel (b)) of normal.data, a normally distributed sample with $100$ observations. The Shapiro-Wilk statistic associated with these data is $W = .99$, indicating that no significant departures from normality were detected ($p = .54)$


df <- data.frame(y=rnorm(100))
shap_df <- shapiro.test(df$y)

p1 <- ggplot(df, aes(x=y)) +
  geom_histogram(bins=10, col="white", fill=blueshade, alpha=0.6) +
  xlab("\n資料觀察值") +
  ylab("累積次數\n") +
  ggtitle("常態分佈資料") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(df, aes(sample=y)) +
  stat_qq() +
  stat_qq_line() +
  xlab("\n樣本分位數") +
  ylab("標準化殘差\n") +
  ggtitle("常態 Q-Q 圖") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))


gridExtra::grid.arrange(p1,p2,ncol=2)

```


@fig-fig11-20 的資料點都貼合一條直線，這個結果並不奇怪，因為構成的資料是由理論常態分佈隨機生成的。對照 @fig-fig11-21 的另外兩筆資料，構成第一列的直方圖和Q-Q圖之多數資料點都是接近測量尺度的最小值或最大值，使得Q-Q圖向上彎曲；構成第二列的直方圖和Q-Q圖的資料有大量極端值，值得Q-Q圖的中間扁平化，但是兩端急劇彎曲。


<!--- As you can see, these data form a pretty straight line; which is no surprise given that we sampled them from a normal distribution! In contrast, have a look at the two data sets shown in @fig-fig11-21. The top panels show the histogram and a QQ plot for a data set that is highly skewed: the QQ plot curves upwards. The lower panels show the same plots for a heavy tailed (i.e., high kurtosis) data set: in this case the QQ plot flattens in the middle and curves sharply at either end. --->

```{r}
#| label: fig-fig11-21
#| fig-width: 10
#| fig-height: 10
#| fig-cap: 第一列顯示有偏態的 100 個觀測值的直方圖和常態Q-Q圖，這筆資料的偏度為 $1.88$，在向上彎曲的Q-Q圖中忠實反映。因此，Shapiro-Wilk統計量為 $W = .80$，明顯不符合常態性條件（$p < .001$）。第二列顯示的圖同樣來自100個觀測值，但是數值向平均值集中的資料集，告成了高峰度（$6.57$），使得Q-Q圖的中間部分扁平，兩側急劇彎曲。使得Shapiro-Wilk統計量為 $W = .75$，同樣明顯不符合常態性條件（$p < .001$）。
#In the top row, a histogram and a normal QQ plot of the $100$ observations in a skewed.data set. The skewness of the data here is $1.88$, and is reflected in a QQ plot that curves upwards. As a consequence, the Shapiro-Wilk statistic is $W = .80$, reflecting a significant departure from normality ($p< .001$). The bottom row shows the same plots for a heavy tailed data set, again consisting of 100 observations. In this case the heavy tails in the data produce a high kurtosis ($6.57$), and cause the QQ plot to flatten in the middle, and curve away sharply on either side. The resulting Shapiro-Wilk statistic is $W = .75$, again reflecting significant non-normality ($p<.001)$


df1 <- data.frame(y=rgamma( n = 100,1,2 ))
df2 <- data.frame(y=c(rnorm( n = 80 ), rnorm( 20, sd=5)))

skew_df1 <- psych::skew(df1$y)
kurt_df2 <- psych::kurtosi(df2$y)
shap_df1 <- shapiro.test(df1$y)
shap_df2 <- shapiro.test(df2$y)

p1 <- ggplot(df1, aes(x=y)) +
  geom_histogram(bins=10, col="white", fill=blueshade, alpha=0.6) +
  xlab("\n資料觀察值") +
  ylab("累積次數\n") +
  ggtitle("高偏態樣本資料分佈") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(df1, aes(sample=y)) +
  stat_qq() +
  stat_qq_line() +
  xlab("\n樣本分位數") +
  ylab("標準化殘差\n") +
  ggtitle("常態Q-Q圖") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))


p3 <- ggplot(df2, aes(x=y)) +
  geom_histogram(bins=10, col="white", fill=blueshade, alpha=0.6) +
  xlab("\n資料觀察值") +
  ylab("累積次數\n") +
  ggtitle("高峰度樣本資料分佈") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

p4 <- ggplot(df2, aes(sample=y)) +
  stat_qq() +
  stat_qq_line() +
  xlab("\n樣本分位數") +
  ylab("標準化殘差\n") +
  ggtitle("常態Q-Q圖") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,p3,p4, nrow=2, ncol=2)

```


<!--- working revise --->

### t檢定的分位數對分位數圖

至此為止的jamovi t檢定分析展示，包括 獨立樣本t檢定（@fig-fig11-10）和相依樣本 t 檢定（@fig-fig11-16）。jamovi的分析模組都有提供顯示標準化殘差(Standardiized Residuals)對應理論常態分佈分位數(Theoretical Quantiles)的 Q-Q 圖選項，這是檢查常態性條件的較佳方法。當我們選擇這個選項時，會得到 @fig-fig11-22 和 @fig-fig11-23 顯示的 Q-Q 圖。這裡的解釋是，兩張圖都顯示標準化殘差的分佈基本上符合常態性，我們可以放心繼續進行t檢定！


<!--- In our previous analyses we showed how to conduct in jamovi an independent t test (@fig-fig11-10) and a paired samples t test (@fig-fig11-16). And for these analyses jamovi provides an option to show a QQ plot for the difference scores (which jamovi calls the 'residuals'), which is a better way of checking the normality assumption. When we select this option for these analyses, we get the Q-Q plots shown in @fig-fig11-22 and @fig-fig11-23, respectively. My interpretation is that these plots both show that the difference scores are reasonably normally distributed, so we are good to go! --->

```{r}
#| label: fig-fig11-22
#| fig-cap: 獨立樣本t檢定分析的Q-Q圖。可參考 @fig-fig11-10
#QQ plot for the independent t test analysis shown in 
knitr::include_graphics("images/fig11-22.png")
```

```{r}
#| label: fig-fig11-23
#| fig-cap: 相依樣本t檢定分析的Q-Q圖。可參考 @fig-fig11-16
#QQ plot for the paired samples t test analysis shown in
knitr::include_graphics("images/fig11-23.png")
```

### Shapiro-Wilk檢定

Q-Q圖是一種非正式檢查資料常態性的好方法，若是需要做更正式的檢驗，**Shapiro-Wilk檢定**[@Shapiro1965]是較正式的檢驗工具。[^11-comparing-two-means-21]讀者如果已經了解假設檢定的思維，這裡的虛無假設設定一組$n$個觀測值分佈符合常態分佈。

[^11-comparing-two-means-21]: 另一種可用的方法是Kolmogorov-Smirnov檢驗，這種方法的判定水準應該比Shapiro-Wilk更嚴格。雖然大部分文獻似乎都主張Shapiro-Wilk是更好的常態性檢核工具，但是Kolomogorov Smirnov是一種通用的分佈性質檢核方法，可以應對其他類型的分佈性質檢驗。在jamovi所提供的選項，Shapiro-Wilk檢驗是首要選項。

[其他技術細節 [^11-comparing-two-means-22]]

[^11-comparing-two-means-22]: *Shapiro-Wilk檢定的統計量通常寫做$W$，計算步驟是。(1)按照數值大小的遞增順序，排序觀測值，使得$\bar{X_1}$成為樣本中最小的值，$X_2$成為第二小的值，依此類推。(2)用以下公式計算$W$<br>$$W=\frac{(\sum_{i=1}^N a_iX_i)^2}{\sum_{i=1}^N(X_i-\bar{X})^2}$$<br>$\bar{X}$是所有觀測值的平均值，$a_i$值是...由於超出了入門級教材的範圍，以下略。

<!--- QQ plots provide a nice way to informally check the normality of your data, but sometimes you'll want to do something a bit more formal and the **Shapiro-Wilk檢定(Shapiro-Wilk test)** [@Shapiro1965] is probably what you're looking for.[^11-comparing-two-means-21] As you'd expect, the null hypothesis being tested is that a set of $N$ observations is normally distributed.

[^11-comparing-two-means-21]: Either that, or the Kolmogorov-Smirnov test, which is probably more traditional than the Shapiro-Wilk. Although most things I've read seem to suggest Shapiro-Wilk is the better test of normality, the Kolomogorov Smirnov is a general purpose test of distributional equivalence that can be adapted to handle other kinds of distribution tests. In jamovi the Shapiro-Wilk test is preferred. 

[Additional technical detail [^11-comparing-two-means-22]]

[^11-comparing-two-means-22]: The test statistic that it calculates is conventionally denoted as $W$, and it's calculated as follows. First, we sort the observations in order of increasing size, and let $\bar{X_1}$ be the smallest value in the sample, $X_2$ be the second smallest and so on. Then the value of $W$ is given by $$W=\frac{(\sum_{i=1}^N a_iX_i)^2}{\sum_{i=1}^N(X_i-\bar{X})^2}$$ where $\bar{X}$ is the mean of the observations, and the $a_i$ values are ...mumble, mumble... something complicated that is a bit beyond the scope of an introductory text.--->

```{r}
#| label: fig-fig11-24
#| fig-width: 5
#| fig-height: 5
#| fig-cap: 樣本大小為10、20和50的資料，所生成的Shapiro-Wilk $W$統計量分佈，虛無假設通常是符合常態分佈。請注意，$W$值越小，表示資料樣本越偏離常態分佈。
#Sampling distribution of the Shapiro-Wilk $W$ statistic, under the null hypothesis that the data are normally distributed, for samples of size 10, 20 and 50. Note that small values of $W$ indicate departure from normality



W_sampdist <- lapply(c(10,20,50), function(i) {
  sapply(1:10000, function (x) {
    shapiro.test(rnorm(i, 0, 1))$statistic
  })
})
W_sampdist <- tibble(W_10=W_sampdist[[1]], W_20=W_sampdist[[2]], W_50=W_sampdist[[3]])

ggplot(W_sampdist) +
  geom_density(aes(x=W_10), adjust=3, col = blueshade, linetype = "solid", show.legend=FALSE) +
  stat_density(aes(x=W_10, linetype = "N = 10"), alpha = 0,
                  geom="line", position="identity") +
  geom_density(aes(x=W_20), adjust=3, col = blueshade, linetype = "dashed", show.legend=FALSE) +
  stat_density(aes(x=W_20, linetype = "N = 20"), alpha = 0,
                  geom="line", position="identity") +
  geom_density(aes(x=W_50), adjust=3, col = blueshade, linetype = "dotted", show.legend=FALSE)+
  stat_density(aes(x=W_50, linetype = "N = 50"), alpha = 0,
                  geom="line", position="identity") +
  scale_linetype_manual(values = c('solid', 'dashed', 'dotted')) +
  guides(linetype = guide_legend(override.aes = list(col = blueshade, alpha = 1) ) ) +
  xlab("\n樣本的W值") +
  ggtitle("W的樣本分佈\n(設定資料分佈符合常態)") +
  scale_x_continuous(limits=c(.75,1)) +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.y = element_blank(),
    plot.title = element_text(hjust = 0.5),
    legend.position = c(0.4,0.8),
    legend.title = element_blank(),
    legend.key.width =  unit(1.8, 'cm'),
    legend.text = element_text(size=12))

```

要在jamovi的t檢定報名獲得Shapiro-Wilk檢定的統計值，在模組視窗的次標題'Assumptions'之下，找到'Normality' 下的選項。以構成 @fig-fig11-20 的100筆隨機數值來說，Shapiro-Wilk檢定的$W = 0.99$，$p$值是0.54。所以，我們沒有證據主張這份資料不符合常態性。在一般報告呈現Shapiro-Wilk檢定的結果，研究者必須要用統計值符號$W$以及p值，儘管樣本量$n$會影響樣本分佈，這裡必不需要一起呈現(因為與t檢定報告的$n$是一樣的)。

<!--- To get the Shapiro-Wilk statistic in jamovi t-tests, check the option for 'Normality' listed under 'Assumptions'. In the randomly sampled data ($N = 100$) we used for the QQ plot, the value for the Shapiro-Wilk normality test statistic was $W = 0.99$ with a p-value of $0.54$. So, not surprisingly, we have no evidence that these data depart from normality. When reporting the results for a Shapiro-Wilk test, you should (as usual) make sure to include the test statistic $W$ and the p value, though given that the sampling distribution depends so heavily on $N$ it would probably be a politeness to include $N$ as well. --->

### 檢測樣本常態性的範例


> **譯者註** 本單元內容為AI初翻，請謹慎使用。


與此同時，當資料變得非常態時，展示一下 QQ 圖和 Shapiro-Wilk 檢定的變化可能是值得的。為此，讓我們看一下我們的澳式足球聯賽（AFL）勝利幅度資料的分佈，如果您還記得 @sec-Descriptive-statistics ，它看起來根本不是來自常態分佈。以下是 QQ 圖發生的情況（@fig-fig11-25）。


<!---In the meantime, it's probably worth showing you an example of what happens to the QQ plot and the Shapiro-Wilk test when the data turn out to be non-normal. For that, let's look at the distribution of our AFL winning margins data, which if you remember back to @sec-Descriptive-statistics it didn't look like they came from a normal distribution at all. Here's what happens to the QQ plot (@fig-fig11-25). --->

```{r}
#| label: fig-fig11-25
#| fig-cap: AFL 例行賽勝隊分數的 QQ 圖，很明顯不符合常態性。
#QQ plot showing non-normality from the AFL winning margins data
knitr::include_graphics("images/fig11-25.png")
```

而當我們對 *AFL margins* 資料執行 Shapiro-Wilk 檢定時，我們得到了 Shapiro-Wilk 常態檢定統計量的值 $W = 0.94$，p值 = $9.481$x$10^{-07}$。顯然是一個顯著的效應！


<!--- And when we run the Shapiro-Wilk test on the *AFL margins* data, we get a value for the Shapiro-Wilk normality test statistic of $W = 0.94$, and p-value = $9.481$x$10^{-07}$. Clearly a significant effect! --->

## 平均值的無母數統計檢定 {#sec-nonparameter-rank-test}

<!--- [^11-translation-01]: 這一節標題及小節順序，配合**線性模型的學習取向**稍做更改。--->

如果資料不符合常態性，運用Q-Q 圖和 Shapiro-Wilk 檢定做確認是建議的標準作業。這裡用澳洲足球聯賽（AFL）例行賽勝隊分數資料做示範，如果讀者還記得 @sec-Descriptive-statistics 的示範，這份資料看起來根本不像是自常態分佈， @fig-fig11-25 是這份資料的 Q-Q 圖。

如同t檢定，Wilcoxon檢定有單一樣本及獨立樣本兩種形式，都是用在無法精確地使用t檢定分析對應的兩種研究設計。另一方面，Wilcoxon檢定不像t檢定一定需要是符合常態性的資料分佈，才能進行分析。其實，Wilcoxon檢定完全沒有任何資料分佈的適用條件。這種特性，讓這類檢定方法在統計學界得到**無母數統計檢定**的通稱。雖然不必在意常態性很方便，使用這方法的研究者也要付出代價：就是Wilcoxon檢定的結果檢定力通常比t檢定低，也就是型二錯誤率會變高。以下不會介紹太多Wilcoxon檢定的細節，但會給讀者一些簡單說明。

<!--- Okay, suppose your data turn out to be pretty substantially non-normal, but you still want to run something like a t檢定? This situation occurs a lot in real life. For the AFL winning margins data, for instance, the Shapiro-Wilk test made it very clear that the normality assumption is violated. This is the situation where you want to use Wilcoxon tests.

Like the t檢定, the Wilcoxon test comes in two forms, one-sample and two-sample, and they're used in more or less the exact same situations as the corresponding t檢定s. Unlike the t檢定, the Wilcoxon test doesn't assume normality, which is nice. In fact, they don't make any assumptions about what kind of distribution is involved. In statistical jargon, this makes them **nonparametric tests**. While avoiding the normality assumption is nice, there's a drawback: the Wilcoxon test is usually less powerful than the t檢定 (i.e., higher Type II error rate). I won't discuss the Wilcoxon tests in as much detail as the t檢定s, but I'll give you a brief overview.--->


### 單一樣本的Wilcoxon檢定

要如何執行**單一樣本 Wilcoxon 檢定**或者**相依樣本 Wilcoxon 檢定**呢？這裡使用的範例資料集是*happiness*，收集修統計課程的學生幸福感。資料集的變項有每個學生在上課前和上課後測量的幸福感分數，以及兩次測量差距的變化分數。如同 t 檢定的示範，以上課前後的分數進行相依樣本檢定，和以變化分數進行單一樣本檢定的結果是一樣的。同t檢定的程序，最簡單的執行方式是先做標記，這次要將大於零的變化分數，與所有變化分數表列標記，得到的表格如  @tbl-tab11-5 。

<!--- What about the **one sample Wilcoxon檢定(Wilcoxon test)** (or equivalently, the paired samples Wilcoxon test)? Suppose I'm interested in finding out whether taking a statistics class has any effect on the happiness of students. My data is in the happiness.csv file. What I've measured here is the happiness of each student before taking the class and after taking the class, and the change score is the difference between the two. Just like we saw with the t檢定, there's no fundamental difference between doing a paired-samples test using before and after, versus doing a onesample test using the change scores. As before, the simplest way to think about the test is to construct a tabulation. The way to do it this time is to take those change scores that are positive differences, and tabulate them against all the complete sample. What you end up with is a table that looks like @tbl-tab11-5.--->


```{r}
#| label: tbl-tab11-5
#| tbl-cap: 觀察值比較差異的單一樣本 Wilcoxon 檢定
#Comparing observations by group for a one-sample Wilcoxon U test
huxtabs[[11]][[5]]  |>
  merge_cells(1:2, 1:2) |>
  merge_cells(1, 4:13) |>
  merge_cells(3:5, 1:2) |>
  set_bold(3:5, 1:2) |>
  set_right_border(3:5, 1:2)
```

> **譯者註** 以下段落為AI初翻，請謹慎使用。

這一次的探討，我們有關於Wilcoxon符號等級檢定的問題。Wilcoxon符號等級檢定是用於對兩個樣本進行比較的非參數檢定，而不需要對母群進行任何假設。本次的Wilcoxon符號等級檢定結果是$W=7$，我們有一個顯著的效果。顯然，修讀統計學對幸福感有影響。在 jamovi 中執行此測試，您可以在“一样本t檢定”分析窗口中的“Tests”下指定“Wilcoxon rank”选项，这将给出Wilcoxon $W=7$，p-value=$0.03711$的结果。轉換成相依樣本版本的測試當然不會給我們不同的答案；詳見 @fig-fig11-26 。

<!--- Counting up the tick marks this time we get a test statistic of $W = 7$. As before, if our test is two sided, then we reject the null hypothesis when W is very large or very small. As far as running it in jamovi goes, it's pretty much what you'd expect. For the one-sample version, you specify the 'Wilcoxon rank' option under 'Tests' in the 'One Sample t檢定' analysis window. This gives you Wilcoxon $W = 7$, p-value = $0.03711$. As this shows, we have a significant effect. Evidently, taking a statistics class does have an effect on your happiness. Switching to a paired samples version of the test won't give us a different answer, of course; see @fig-fig11-27. --->

```{r}
#| label: fig-fig11-26
#| classes: .enlarge-image
#| fig-cap: 單樣本和成對樣本 Wilcoxon 非參數檢驗結果的 jamovi 示範畫面
#jamovi screen showing results for one sample and paired sample Wilcoxon nonparametric tests
knitr::include_graphics("images/fig11-27.png")
```


### 獨立樣本的曼－惠特尼U檢定


最後來介紹**曼－惠特尼U檢定(Mann-Whitney U test)**，這裡介紹的程序比單一樣本Wilcoxon 檢定還要簡單。這裡用*awesome*資料集做示範，內容是10個人在某個測試的得分，因為原作者已經懶得掰下去，就假想這是一個"超讚指數測試"，要比較A與B兩組人那一組最厲害。除了代表每個人的ID之外，還有兩個變項：scores和group。


只要結果不是平手，也就是有兩組人得到的分數完全相同，測試程序就非常簡單。首先只需要建立一個如 @tbl-tab11-4 的表格，依編號順序比較A組和B組的每一對分數，只要看到A組某人的分數大於B組的某人，就打個勾。

<!--- I'll start by describing the **曼－惠特尼U檢定(Mann-Whitney U test)**, since it's actually simpler than the one sample version. Suppose we're looking at the scores of 10 people on some test. Since my imagination has now failed me completely, let's pretend it's a "test of awesomeness" and there are two groups of people, "A" and "B". I'm curious to know which group is more awesome. The data are included in the file awesome.csv, and there are two variables apart from the usual ID variable: scores and group.

As long as there are no ties (i.e., people with the exact same awesomeness score) then the test that we want to do is surprisingly simple. All we have to do is construct a table that compares every observation in group A against every observation in group B. Whenever the group A datum is larger, we place a check mark in the table (@tbl-tab11-4). --->

```{r}
#| label: tbl-tab11-4
#| tbl-cap: 對於雙樣本曼－惠特尼U檢定，比較各組觀測值
#Comparing observations by group for a two-sample Mann-Whitney U test
huxtabs[[11]][[4]] |>
  merge_cells(1, 3:7) |>
  merge_cells(3:7, 1) |>
  set_bold(3:7, 1) |>
  set_right_border(3:7, 1) |>
  merge_cells(1:2, 1:2)
```

然後計算出勾的數量，這得到檢定統計量 U[^11-comparing-two-means-23]。U的取樣分佈解釋起來有些複雜，在此略過不提。就這個範例的目的而言，關鍵是U的判讀方式與t檢定或z檢定完全一樣。換句話說，如果採用雙側檢定，當U值非常大或非常小時，就會拒絕虛無假設；如果採用單側檢定，只看U值是過大或過小。

[^11-comparing-two-means-23]: 實際上，有兩種不同的檢定統計量公式，它們之間相差一個常數。這裡所說的是jamovi演算的版本。

> **譯者註** 以下段落為AI初翻，請謹慎使用。

在jamovi中，如果我們將成績作為因變項，組別作為分組變項運行“獨立樣本t檢定”，然後在“測試”選項中勾選“曼-惠特尼U檢定”選項，我們將獲得顯示$U=3$（即上面顯示的檢查記號數）和p值= 0.05556的結果。參見 @fig-fig11-27 。

<!--- We then count up the number of checkmarks. This is our test statistic, W. [^11-comparing-two-means-23] The actual sampling distribution for W is somewhat complicated, and I'll skip the details. For our purposes, it's sufficient to note that the interpretation of W is qualitatively the same as the interpretation of $t$ or $z$. That is, if we want a two-sided test then we reject the null hypothesis when W is very large or very small, but if we have a directional (i.e., one-sided) hypothesis then we only use one or the other.

[^11-comparing-two-means-23]: Actually, there are two different versions of the test statistic that differ from each other by a constant value. The version that I've described is the one that jamovi calculates.

In jamovi, if we run an 'Independent Samples t檢定' with scores as the dependent variable. and group as the grouping variable, and then under the options for 'tests' check the option for 'Mann-Whitney $U$, we will get results showing that $U = 3$ (i.e., the same number of checkmarks as shown above), and a p-value = $0.05556$. See @fig-fig11-26. --->

```{r}
#| label: fig-fig11-27
#| classes: .enlarge-image
#| fig-cap: jamovi螢幕顯示曼-惠特尼$U$檢定的結果
#jamovi screen showing results for the Mann-Whitney $U$ test
knitr::include_graphics("images/fig11-26.png")
```

## 本章小結

- [單一樣本z檢定](11-Comparing-two-means.html#%E5%96%AE%E4%B8%80%E6%A8%A3%E6%9C%ACz%E6%AA%A2%E5%AE%9A) 用來比對樣本平均值是否不同於母群平均值(各位可考慮跳過)。
- 獨立樣本t檢定用於比較兩組平均值的差異，虛無假設設定兩組平均值相等。實務上會使用適用條件 是兩組變異相同的[獨立樣本t檢定](11-Comparing-two-means.html#sec-The-one-sample-t檢定)，或是兩組變異不同的[獨立樣本t檢定(Welch t檢定)](11-Comparing-two-means.html#sec-the-independent-samples-t檢定-welch-test)。
- [相依樣本t檢定](11-Comparing-two-means.html#%E7%9B%B8%E4%BE%9D%E6%A8%A3%E6%9C%ACt%E6%AA%A2%E5%AE%9A)用於比較的資料來自同一個樣本的測量，虛無假設設定兩次測量的平均值相等。分析方法與適用條件與單一樣本t檢定相同。
- 只有事前規劃差異比較方向，[單尾檢定](11-Comparing-two-means.html#%E5%96%AE%E5%B0%BE%E6%AA%A2%E5%AE%9A) 才有真正的意義。
- t檢定的[效果量](11-Comparing-two-means.html#t%E6%AA%A2%E5%AE%9A%E7%9A%84%E6%95%88%E6%9E%9C%E9%87%8F)以Cohen' d的公式計算。
- 我們能使用QQ圖及Shapiro-Wilk檢定[檢測樣本常態性](11-Comparing-two-means.html#sec-Checking-the-normality-of-a-sample)
- 如果資料真的違反常態性，你可以使用[等級資料的平均值檢定](11-Comparing-two-means.html#sec-nonparameter-rank-test)像是曼－惠特尼U檢定，以及Wilcoxon檢定。

<!---
- [The one-sample t檢定] is used to compare a single sample mean against a hypothesised value for the population mean.
- An independent samples t檢定 is used to compare the means of two groups, and tests the null hypothesis that they have the same mean. It comes in two forms: [The independent samples t檢定 (Student test)](#sec-the-independent-samples-t檢定-student檢定) assumes that the groups have the same standard deviation, [The independent samples t檢定 (Welch test)](#sec-the-independent-samples-t檢定-welch-test) does not.
- [The paired-samples t檢定] is used when you have two scores from each person, and you want to test the null hypothesis that the two scores have the same mean. It is equivalent to taking the difference between the two scores for each person, and then running a one sample t檢定 on the difference scores.
- [One-sided tests] are perfectly legitimate as long as they are pre-planned (like all tests!).
- [Effect size] calculations for the difference between means can be calculated via the Cohen's d statistic.
- [Checking the normality of a sample] using QQ plots and the Shapiro-Wilk test.
- If your data are non-normal, you can use Mann-Whitney or Wilcoxon tests instead of t檢定s for [Testing non-normal data]. --->
