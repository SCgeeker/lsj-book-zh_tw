# 比較單一與兩組平均值 {#sec-Comparing-two-means}

```{r}
#| include: FALSE
source("header.R")
```

> **譯者註** 20230415初步以ChatGPT-4完成翻譯，內容待編修。

@sec-Categorical-data-analysis 討論的是依變項是名義尺度，而且獨變項也是名目尺度的情況。許多現實的資料都有這種特點，因此卡方檢定的應用特別廣泛。[^11-translation-01]然而，統計實務更有可能遇到的情況是，依變項是間斷尺度或者層次更高的連續尺度，研究目標的是比較兩組群體的依變項平均值。例如，一位心理學家想知道有小孩的夫妻的焦慮水準是否比沒小孩的夫妻更高，或者聽音樂會不會降低工作記憶容量（相對於不聽音樂）。在醫學論文裡，我們會想知道一種新藥物是否會增加或降低血壓。一位農學科學家可能想知道是否對澳大利亞原生植物施磷肥會導致植物死亡。[^11-comparing-two-means-1]在這些情況，依變項都是一種連續、間斷或比例尺度變項，而獨變項是一個二元的「分組」變項。換句話說，我們想比較兩組的平均值。

[^11-translation-01]: 原書先介紹類別資料的統計方法，繁體中文版這一章往後挪動。

[^11-comparing-two-means-1]: 在我的私人花園中做的非正式實驗發現，相對於地球上其他地區，澳大利亞的本土植物只能適應低度磷肥，如果你買了一個有大量外來植物的房子，還想種植本土植物，請把兩種植物分開；對歐洲植物有營養的物質對澳大利亞本土植物來說是毒藥。

比較平均值的標準統計方法是使用 t 檢定，要使用那種t檢定取決於您想解決的問題。因此，本章主要內容都集中在不同類型的 t 檢定上：單樣本 t 檢定、獨立樣本 t 檢定和配對樣本 t 檢定。然後我們將談論單側檢定，之後我們將簡要討論 Cohen's d，這是 t 檢定的標準效應量。本章後面的部分集中討論 t 檢定的假設以及可能違反這些假設時的補救方法。<!---但是，在討論任何這些有用的事情之前，我們將從 z 檢定開始討論。--->

<!--- In @sec-Categorical-data-analysis we covered the situation when your outcome variable is nominal scale and your predictor variable is also nominal scale. Lots of real world situations have that character, and so you'll find that chi-square tests in particular are quite widely used. However, you're much more likely to find yourself in a situation where your outcome variable is interval scale or higher, and what you're interested in is whether the average value of the outcome variable is higher in one group or another. For instance, a psychologist might want to know if anxiety levels are higher among parents than non-parents, or if working memory capacity is reduced by listening to music (relative to not listening to music). In a medical context we might want to know if a new drug increases or decreases blood pressure. An agricultural scientist might want to know whether adding phosphorus to Australian native plants will kill them.[^11-comparing-two-means-1] In all these situations our outcome variable is a fairly continuous, interval or ratio scale variable, and our predictor is a binary "grouping" variable. In other words, we want to compare the means of the two groups.

[^11-comparing-two-means-1]: Informal experimentation in my garden suggests that yes, it does. Australian natives are adapted to low phosphorus levels relative to everywhere else on Earth, so if you've bought a house with a bunch of exotics and you want to plant natives, keep them separate; nutrients to European plants are poison to Australian ones.

The standard answer to the problem of comparing means is to use a t-test, of which there are several varieties depending on exactly what question you want to solve. As a consequence, the majority of this chapter focuses on different types of t-test: one sample t-tests, independent samples t-tests and paired samples t-tests. We'll then talk about one sided tests and, after that, we'll talk a bit about Cohen's d, which is the standard measure of effect size for a t-test. The later sections of the chapter focus on the assumptions of the t-tests, and possible remedies if they are violated. However, before discussing any of these useful things, we'll start with a discussion of the z-test. --->

## 單一樣本z檢定[^11-translatino-02]

[^11-translatino-02]: 譯註~這是傳統統計教科書必放的部分。因為本書中文版整合**線性模型的學習取向**，學生與教師可選擇跳過這一節。

在本節中，我將介紹統計學中最無用的測試之一：z 檢定。認真地說，這種測試在現實生活中幾乎從不使用。它唯一的真正用途是，在教授統計學時，它是通往 t 檢定的一個非常方便的墊腳石，而 t 檢定可能是統計學中最（過度）使用的工具。

<!---In this section I'll describe one of the most useless tests in all of statistics: the z-test. Seriously -- this test is almost never used in real life. Its only real purpose is that, when teaching statistics, it's a very convenient stepping stone along the way towards the t-test, which is probably the most (over)used tool in all statistics. --->

### 使用z檢定前的注意事項

為了介紹 z 檢定背後的概念，讓我們舉一個簡單的例子。我的一位朋友 Zeppo 老師按曲線給他的入門統計學班級打分。假設他班級的平均分數是 $67.5$，標準差是 $9.5$。他有很多學生，其中有 20 個學生還修了心理學課程。出於好奇心，我想知道這些心理學生的成績是否傾向於與其他人獲得相同的成績（即平均分數為 $67.5$），還是他們的成績往高或往低得分？他給我發了一個 *zeppo.csv* 文件，我用它來查看這些學生的成績，並在 jamovi 試算表視圖中計算了 "探索" - "描述性統計" 中的平均值。[^11-comparing-two-means-2]平均值為 $72.3$。

[^11-comparing-two-means-2]: 為了這樣做，我必須將 $X$ 的測量水平更改為「連續」，因為在打開 / 導入 csv 文件時，jamovi 使其成為一個名義水平變量，這對我的分析不正確。

50 60 60 64 66 66 67 69 70 74 76 76 77 79 79 79 81 82 82 89

嗯，也許心理學生的成績比正常情況高一些。樣本平均值 $\bar{X}=72.3$ 比假設的母群平均值 $\mu=67.5$ 要高得多，但是，另一方面，樣本大小 $N=20$ 並不是很大。也許這只是純粹的巧合。

為了回答這個問題，有助於能夠寫下我所知道的。首先，我知道樣本平均值為 $\bar{X}=72.3$。如果我願意假設心理學生的標準差與班上其他學生的標準差相同，那麼我可以說母群標準差為 $\sigma=9.5$。我還假設由於 Zeppo 博士是按曲線給分，心理學生的成績服從正態分布。

接下來，要明確我希望從資料中學到什麼。在這種情況下，我的研究假設與心理學生的成績母群平均值 $\mu$ 相關，而這個值是未知的。具體而言，我想知道 $\mu=67.5$ 是否成立。鑒於這是我所知道的，我們能否設計一個假設檢定來解決我們的問題？資料以及它們被認為來自的假設分佈顯示在 @fig-fig11-1 中。不是非常明顯什麼是正確的答案，對嗎？為此，我們需要一些統計學知識。

<!---To introduce the idea behind the z-test, let's use a simple example. A friend of mine, Dr Zeppo, grades his introductory statistics class on a curve. Let's suppose that the average grade in his class is $67.5$, and the standard deviation is $9.5$. Of his many hundreds of students, it turns out that 20 of them also take psychology classes. Out of curiosity, I find myself wondering if the psychology students tend to get the same grades as everyone else (i.e., mean $67.5$) or do they tend to score higher or lower? He emails me the *zeppo.csv* file, which I use to look at the grades of those students, in the jamovi spreadsheet view,and then calculate the mean in 'Exploration' - 'Descriptives' [^11-comparing-two-means-2]. The mean value is $72.3$.

[^11-comparing-two-means-2]: In order to do this I had to change the measurement level for $X$ to 'Continuous', as during the opening / import of the csv file jamovi made this a nominal level variable, which isn't right for my analysis

50 60 60 64 66 66 67 69 70 74 76 76 77 79 79 79 81 82 82 89

Hmm. It might be that the psychology students are scoring a bit higher than normal. That sample mean of $\bar{X} = 72.3$ is a fair bit higher than the hypothesised population mean of $\mu = 67.5$ but, on the other hand, a sample size of $N = 20$ isn't all that big. Maybe it's pure chance.

To answer the question, it helps to be able to write down what it is that I think I know. Firstly, I know that the sample mean is $\bar{X} = 72.3$. If I'm willing to assume that the psychology students have the same standard deviation as the rest of the class then I can say that the population standard deviation is $\sigma = 9.5$. I'll also assume that since Dr Zeppo is grading to a curve, the psychology student grades are normally distributed.

Next, it helps to be clear about what I want to learn from the data. In this case my research hypothesis relates to the population mean $\mu$ for the psychology student grades, which is unknown. Specifically, I want to know if $\mu = 67.5$ or not. Given that this is what I know, can we devise a hypothesis test to solve our problem? The data, along with the hypothesised distribution from which they are thought to arise, are shown in @fig-fig11-1 . Not entirely obvious what the right answer is, is it? For this, we are going to need some statistics. --->

```{r}
#| label: fig-fig11-1
#| out.width: 60%
#| fig-cap: 心理學生的成績（柱形圖）應該是由理論分佈（實線）生成的。
#The theoretical distribution (solid line) from which the psychology student grades (bars) are supposed to have been generated

load("data_and_tables/zeppo.Rdata") #grades
ggplot(as.data.frame(grades), aes(x=grades)) +
  geom_histogram(aes(y =after_stat(density)), binwidth=5, col=blueshade, fill=blueshade, alpha=0.4) +
  stat_function(fun = dnorm, args = list(mean = 67.7, sd = sd(grades)), col="black", linewidth=1) +
  xlab("\nGrades") +
  theme_classic() +
  theme(
    axis.line.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.title.y = element_blank())

```

### 建立z檢定的假設

構建假設檢定的第一步是明確虛無假設和對立假設是什麼。這不太難做到。我們的虛無假設 $H_0$ 是，心理學生的成績母群平均值 $\mu$ 為 $67.5\%$，而我們的對立假設是母群平均值不是 $67.5\%$。如果我們用數學符號表示，這些假設就變成了：

$$ H_0:\mu= 67.5 $$ $$ H_1:\mu \neq 67.5 $$

不過老實說，這種表示法對我們理解問題沒有太大幫助，它只是一種簡潔的寫下我們試圖從資料中學到什麼的方法。我們測試的虛無假設 $H_0$ 和對立假設 $H_1$ 都在 @fig-fig11-2 中有圖示。除了提供這些假設外，上面概述的情況還為我們提供了相當多的有用的背景知識。具體而言，有兩個特殊的信息可以添加：

1. 心理學成績服從正態分布。
2. 這些分數的真實標準差 $\sigma$ 已知為 9.5。

暫時，我們將表現得好像這些是絕對可信的事實。在現實生活中，這種絕對可信的背景知識是不存在的，因此，如果我們想依賴這些事實，我們只能假設這些東西是真實的。但是，由於這些假設可能成立或不成立，我們可能需要檢查它們。不過，現在我們還是保持簡單。

<!--- The first step in constructing a hypothesis test is to be clear about what the null and alternative hypotheses are. This isn't too hard to do. Our null hypothesis, $H_0$, is that the true population mean $\mu$ for psychology student grades is $67.5\%$, and our alternative hypothesis is that the population mean isn't $67.5\%$. If we write this in mathematical notation, these hypotheses become:

$$ H_0:\mu= 67.5 $$ $$ H_1:\mu \neq 67.5 $$

though to be honest this notation doesn't add much to our understanding of the problem, it's just a compact way of writing down what we're trying to learn from the data. The null hypotheses $H_0$ and the alternative hypothesis $H_1$ for our test are both illustrated in @fig-fig11-2. In addition to providing us with these hypotheses, the scenario outlined above provides us with a fair amount of background knowledge that might be useful. Specifically, there are two special pieces of information that we can add:

1.  The psychology grades are normally distributed.
2.  The true standard deviation of these scores $\sigma$ is known to be 9.5.

For the moment, we'll act as if these are absolutely trustworthy facts. In real life, this kind of absolutely trustworthy background knowledge doesn't exist, and so if we want to rely on these facts we'll just have make the *assumption* that these things are true. However, since these assumptions may or may not be warranted, we might need to check them. For now though, we'll keep things simple. --->

```{r}
#| label: fig-fig11-2
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 單一樣本 $z$ 檢定（雙側版本）所假設的虛無假設和對立假設的圖形說明。虛無假設和對立假設都假設母群分布是正態分布，並且進一步假設母群標準差已知（固定在某個值 $\sigma_0$）。虛無假設（左）是母群平均值 $\mu$ 等於某個指定值 $\mu_0$。對立假設（右）是母群平均值與此值不同，即 $\mu \neq \mu_0$。
#Graphical illustration of the null and alternate hypotheses assumed by the one sample $z$-test (the two sided version, that is). The null and alternate hypotheses both assume that the population distribution is normal, and additionally assumes that the population standard deviation is known (fixed at some value $\$sigma_0$). The null hypothesis (left) is that the population mean $\mu$ is equal to some specified value $\mu_0$. The alternative hypothesis (right) is that the population mean differs from this value, $\mu \neq \mu_0$

p1 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="black", linewidth=1) +
  geom_segment(x = 0, y = 0.25, xend = -1, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-2.2, y=.25, label=expression(~sigma~" = "~sigma[0]), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" = "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("null hypothesis") +
  xlab("\nValue of X") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = -.75, sd = 1), col="black", linewidth=1) +
  geom_segment(x = -.75, y = 0.25, xend = -1.75, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-3, y=.25, label=expression(~sigma~" = " ~sigma[0]), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" \U2260 "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("alternative hypothesis") +
  xlab("\nValue of X") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

下一步是找出一個好的診斷檢定統計量，這樣可以幫助我們區分 $H_0$ 和 $H_1$。考慮到這些假設都涉及母群平均值 $\mu$，你會相當有信心樣本平均值 $\bar{X}$ 是一個很有用的起點。我們可以計算樣本平均值 $\bar{X}$ 與虛無假設預測的母群平均值之間的差異。在我們的例子中，這意味著我們計算 $\bar{X} - 67.5$。更一般地，如果讓 $\mu_0$ 指虛無假設聲稱為我們的母群平均值的值，那麼我們想要計算

$$\bar{X}-\mu_0$$

如果這個量等於或非常接近於0，虛無假設看起來是可接受的。如果這個量遠離0，那麼虛無假設似乎不太可能是有價值的。但是，它離0有多遠才能拒絕 H0 呢？

為了弄清楚這一點，我們需要再狡猾一點，並且我們需要依賴我之前提到的那兩個背景知識，即原始資料服從正態分布，而且我們知道母群標準差 $\sigma$ 的值。如果虛無假設實際上是真的，真正的平均值是 $\mu_0$，那麼這些事實一起意味著我們知道資料的完整母群分布：平均值為 $\mu_0$，標準差為 $\sigma$ 的正態分布。[^11-comparing-two-means-3]

[^11-comparing-two-means-3]: 採用 @sec-The-normal-distribution 中的符號表示法，統計學家可以將其寫成：$$X \sim Normal(\mu_0,\sigma^2)$$

好的，如果這是真的，那麼我們可以關於 $\bar{X}$ 的分布說些什麼呢？嗯，正如我們之前討論過的（見 @sec-The-central-limit-theorem），平均數 $\bar{X}$ 的取樣分佈也是正態分布，並且具有平均值 $\mu$。但是這個取樣分佈的標準差 $\\{se(\bar{X})\\}$，也被稱為平均值的標準誤差，是[^11-comparing-two-means-4]

[^11-comparing-two-means-4]: 換句話說，如果虛無假設成立，那麼平均值的取樣分佈可以寫成：$$\bar{X} \sim Normal(\mu_0,SE(\bar{X})) $$


$$se(\bar{X}=\frac{\sigma}{\sqrt{N}})$$

現在來了解這個技巧。我們可以將樣本平均數 $\bar{X}$ 轉換成標準分數（參見 @sec-Standard-scores）。這通常被寫成 z，但現在我將其稱為 $z_{\bar{X}}$。使用這種擴展符號的原因是為了幫助您記住，我們正在計算樣本平均值的標準化版本，而不是單個觀察值的標準化版本，後者是通常指的 z 分數）。當我們這樣做時，樣本平均值的 z 分數為

$$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{SE(\bar{X})}$$ 

也可寫成

$$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{\frac{\sigma}{\sqrt{N}}}$$

這個 z 分數就是我們的檢定統計量。使用這個作為我們的檢定統計量的好處是，像所有 z 分數一樣，它具有標準正態分布：[^11-comparing-two-means-5]

[^11-comparing-two-means-5]: 如果您忘記了這是為什麼，可以參考 @sec-Standard-scores。

換句話說，無論原始資料所處的比例尺是什麼，z 統計量本身的解釋始終相同：它等於觀察到的樣本均值 $\bar{X}$ 與零假設所預測的母群均值 $\mu_0$ 相隔的標準誤數。更好的是，無論原始分數的母群參數是什麼，z 檢定的 5% 臨界區域始終相同，如 @fig-fig11-3 所示。而這意味著，在人們手動進行所有統計計算的時代，某人可以發表像 @tbl-tab11-1 這樣的表格。這反過來又意味著研究人員可以手動計算他們的 z 統計量，然後在教科書中查找臨界值。$$z_{\bar{X}} \sim Normal(0,1) $$

<!--- The next step is to figure out what we would be a good choice for a diagnostic test statistic, something that would help us discriminate between $H_0$ and $H_1$. Given that the hypotheses all refer to the population mean $\mu$, you'd feel pretty confident that the sample mean $\bar{X}$ would be a pretty useful place to start. What we could do is look at the difference between the sample mean $\bar{X}$ and the value that the null hypothesis predicts for the population mean. In our example that would mean we calculate $\bar{X} - 67.5$. More generally, if we let $\mu_0$ refer to the value that the null hypothesis claims is our population mean, then we'd want to calculate

$$\bar{X}-\mu_0$$

If this quantity equals or is very close to 0, things are looking good for the null hypothesis. If this quantity is a long way away from 0, then it's looking less likely that the null hypothesis is worth retaining. But how far away from zero should it be for us to reject H0?

To figure that out we need to be a bit more sneaky, and we'll need to rely on those two pieces of background knowledge that I wrote down previously; namely that the raw data are normally distributed and that we know the value of the population standard deviation $\sigma$. If the null hypothesis is actually true, and the true mean is $\mu_0$, then these facts together mean that we know the complete population distribution of the data: a normal distribution with mean $\mu_0$ and standard deviation $\sigma$.[^11-comparing-two-means-3]

[^11-comparing-two-means-3]: Adopting the notation from @sec-The-normal-distribution, a statistician might write this as: $$X \sim Normal(\mu_0,\sigma^2)$$

Okay, if that's true, then what can we say about the distribution of $\bar{X}$? Well, as we discussed earlier (see @sec-The-central-limit-theorem), the sampling distribution of the mean $\bar{X}$ is also normal, and has mean $\mu$. But the standard deviation of this sampling distribution $\\{se(\bar{X})\\}$, which is called the standard error of the mean, is [^11-comparing-two-means-4]

[^11-comparing-two-means-4]: In other words, if the null hypothesis is true then the sampling distribution of the mean can be written as follows: $$\bar{X} \sim Normal(\mu_0,SE(\bar{X})) $$

$$se(\bar{X}=\frac{\sigma}{\sqrt{N}})$$

Now comes the trick. What we can do is convert the sample mean $\bar{X}$ into a standard score (see @sec-Standard-scores). This is conventionally written as z, but for now I'm going to refer to it as $z_{\bar{X}}$. The reason for using this expanded notation is to help you remember that we're calculating a standardised version of a sample mean, not a standardised version of a single observation, which is what a z-score usually refers to). When we do so the z-score for our sample mean is

$$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{SE(\bar{X})}$$ or, equivalently $$z_{\bar{X}}=\frac{\bar{X}-\mu_0}{\frac{\sigma}{\sqrt{N}}}$$

This z-score is our test statistic. The nice thing about using this as our test statistic is that like all z-scores, it has a standard normal distribution:[^11-comparing-two-means-5]

[^11-comparing-two-means-5]: Again, see @sec-Standard-scores if you've forgotten why this is true.

In other words, regardless of what scale the original data are on, the z-statistic itself always has the same interpretation: it's equal to the number of standard errors that separate the observed sample mean $\bar{X}$ from the population mean $\mu_0$ predicted by the null hypothesis. Better yet, regardless of what the population parameters for the raw scores actually are, the 5% critical regions for the z-test are always the same, as illustrated in @fig-fig11-3. And what this meant, way back in the days where people did all their statistics by hand, is that someone could publish a table like @tbl-tab11-1. This, in turn, meant that researchers could calculate their z-statistic by hand and then look up the critical value in a text book.

$$z_{\bar{X}} \sim Normal(0,1) $$ --->

```{r}
#| label: tbl-tab11-1
#| tbl-cap: 各種顯著水準的臨界值
#Critical values for different alpha levels
huxtabs[[11]][[1]] |>
  merge_cells(1, 2:3)
```

### 手作z檢定

現在，正如我之前提到的，z-test在實際應用中幾乎從不使用。這個測試在實際生活中如此罕見，以至於jamovi的基本安裝不包含內置功能。然而，這個測試是如此地簡單，以至於手動進行這個測試非常容易。讓我們回到Dr Zeppo班級的資料。在載入成績資料後，我需要做的第一件事是計算樣本均值，我已經做到了($72.3$)。我們已經有了已知的母群標準差($\sigma = 9.5$)，零假設所指定的母群平均值($\mu_0 = 67.5$)的值，以及樣本大小($N=20$)。

<!--- Now, as I mentioned earlier, the z-test is almost never used in practice. It's so rarely used in real life that the basic installation of jamovi doesn't have a built in function for it. However, the test is so incredibly simple that it's really easy to do one manually. Let's go back to the data from Dr Zeppo's class. Having loaded the grades data, the first thing I need to do is calculate the sample mean, which I've already done ($72.3$). We already have the known population standard deviation ($\sigma = 9.5$), and the value of the population mean that the null hypothesis specifies ($\mu_0 = 67.5$), and we know the sample size ($N=20$). --->

```{r}
#| label: fig-fig11-3
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 雙尾 z-檢定 (面板(a)) 和單尾 z-檢定 (面板(b)) 的拒絕區域
#Rejection regions for the two-sided z-test (panel (a)) and the one-sided z-test (panel (b))

p1 <- ggplot(data = data.frame(x = seq(-3, 3, 0.1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), geom = "area",
                fill = blueshade, alpha=0.4, xlim = c(-3, -1.96))  +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), geom = "area",
                fill = blueshade, alpha=0.4, xlim = c(1.96, 3))  +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), col="black", linewidth=1) +
  xlab("\nValue of z Statistic") +
  ggtitle("(a) Two Sided Test") +
  scale_x_continuous(breaks=c(-1.96, 0, 1.96), labels=c("-1.96", "0", "1.96")) +
  theme_classic() +
  theme(
    axis.text.x = element_text(size=12),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(-3, 3, 0.1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), geom = "area",
                fill = blueshade, alpha=0.4, xlim = c(1.64, 3))  +
  stat_function(fun = dnorm, n = 1000, args = list(mean=0, sd=1), col="black", linewidth=1) +
  xlab("\nValue of z Statistic") +
  ggtitle("(b) One Sided Test") +
  scale_x_continuous(breaks=c(0, 1.64), labels=c("0", "1.64")) +
  theme_classic() +
  theme(
    axis.text.x = element_text(size=12),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,ncol=2)

```

接下來，讓我們計算（真實）標準誤（可輕鬆用計算機完成）：

<!---Next, let's calculate the (true) standard error of the mean (easily done with a calculator): --->

$$
\begin{split}
sem.true & = \frac{sd.true}{\sqrt{N}} \\\\
& = \frac{9.5}{\sqrt{20}} \\\\
& = 2.124265
\end{split}
$$

最後，我們計算我們的z分數：

<!---And finally, we calculate our z-score: --->

$$
\begin{split}
z.score & = \frac{sample.mean - mu.null}{sem.true} \\\\
& = \frac{ (72.3 - 67.5)}{ 2.124265} \\\\
& = 2.259606
\end{split}
$$

此時，我們會傳統地在臨界值表中查詢 $2.26$ 的值。我們原來的假設是雙邊的（我們對心理學生在統計學上表現得比其他學生好或差沒有任何理論基礎），因此我們的假設檢驗也是雙邊的（或者是兩尾的）。從我先前顯示的小表中，我們可以看到 $2.26$ 大於需要在 $\alpha = .05$ 的顯著性水平下具有顯著性的臨界值 $1.96$，但小於需要在 $\alpha = .01$ 的水平下具有顯著性的值 $2.58$。因此，我們可以得出結論，我們可以這樣寫：

> *在心理學學生的樣本中，平均成績為* $73.2$，假定真正的人口標準差為 $9.5$，我們可以得出結論，心理學學生在統計學上的得分與班級平均分有顯著差異（$z = 2.26, N = 20, p<.05$）。

<!---At this point, we would traditionally look up the value $2.26$ in our table of critical values. Our original hypothesis was two-sided (we didn't really have any theory about whether psych students would be better or worse at statistics than other students) so our hypothesis test is two-sided (or two-tailed) also. Looking at the little table that I showed earlier, we can see that $2.26$ is bigger than the critical value of $1.96$ that would be required to be significant at $\alpha = .05$, but smaller than the value of $2.58$ that would be required to be significant at a level of $\alpha = .01$. Therefore, we can conclude that we have a significant effect, which we might write up by saying something like this:

> *With a mean grade of* $73.2$ in the sample of psychology students, and assuming a true population standard deviation of $9.5$, we can conclude that the psychology students have significantly different statistics scores to the class average ($z = 2.26, N = 20, p<.05$). --->

### z檢定的適用條件

如前所述，所有統計檢驗都有其前提假設，有些假設是合理的，有些則不是。我剛剛介紹的「單樣本 z 檢定」也有三個基本的前提假設，分別為：

- *常態性*。通常所描述的z-test假設真正的母群分布是正態的。[^11-comparing-two-means-6]這通常是一個相當合理的假設，如果我們感到擔憂，也是我們可以檢查的假設（請參見[檢查樣本的正態性](11-Comparing-two-means.html#sec-Checking-the-normality-of-a-sample)一節）。
- *獨立性*。測試的第二個假設是資料集中的觀察結果彼此不相關或以某種有趣的方式相關。這在統計上不是那麼容易檢查，而是有賴於良好的實驗設計。違反此假設的一個明顯（且愚蠢）的例子是將同一個觀察結果在資料文件中“複製”多次，以便您最終獲得只有一個真正觀察結果的龐大“樣本大小”。更現實的是，您必須問自己，是否真的可以想像每個觀察結果都是從您感興趣的人口中完全隨機抽樣得到的。在實踐中，此假設永遠不會被滿足，但我們會盡力設計研究來最小化相關資料的問題。
- *已知標準差假設*。z檢驗的第三個假設是，研究人員知道母群的真實標準差。這簡直太傻了。在沒有真正的世界資料分析問題中，你知道母群的標準差$\sigma$，但對平均值$\mu$卻一無所知。換句話說，這個假設永遠是錯的。

[^11-comparing-two-means-6]: 事實上這個說法有些過分了。嚴格來說，z檢定只要求平均值的取樣分佈是正態分布即可。如果母群分布是正態分布，則平均值的取樣分佈必然也是正態分布。但是，就像我們在談論中心極限定理時所看到的那樣，即使母群分布本身不正常，取樣分佈仍然可能是正常的（甚至很常見）。然而，考慮到假設真實標準差已知的荒謬性，對於這個假設沒有必要進行詳細討論！

鑒於假設 $\alpha$ 已知的荒謬，我們試著不使用它。這將我們帶離了 z-test 這個枯燥領域，走進了有獨角獸、仙女和小矮人的神奇王國，那就是 t-test！


<!--- As I've said before, all statistical tests make assumptions. Some tests make reasonable assumptions, while other tests do not. The test I've just described, the one sample z-test, makes three basic assumptions. These are:

-   *Normality*. As usually described, the z-test assumes that the true population distribution is normal.[^11-comparing-two-means-6] This is often a pretty reasonable assumption, and it's also an assumption that we can check if we feel worried about it (see Section on [Checking the normality of a sample]).
-   *Independence*. The second assumption of the test is that the observations in your data set are not correlated with each other, or related to each other in some funny way. This isn't as easy to check statistically, it relies a bit on good experimental design. An obvious (and stupid) example of something that violates this assumption is a data set where you "copy" the same observation over and over again in your data file so that you end up with a massive "sample size", which consists of only one genuine observation. More realistically, you have to ask yourself if it's really plausible to imagine that each observation is a completely random sample from the population that you're interested in. In practice this assumption is never met, but we try our best to design studies that minimise the problems of correlated data.
-   *Known standard deviation*. The third assumption of the z-test is that the true standard deviation of the population is known to the researcher. This is just stupid. In no real world data analysis problem do you know the standard deviation σ of some population but are completely ignorant about the mean $\mu$. In other words, this assumption is always wrong.

[^11-comparing-two-means-6]: Actually this is too strong. Strictly speaking the z test only requires that the sampling distribution of the mean be normally distributed. If the population is normal then it necessarily follows that the sampling distribution of the mean is also normal. However, as we saw when talking about the central limit theorem, it's quite possible (even commonplace) for the sampling distribution to be normal even if the population distribution itself is nonnormal. However, in light of the sheer ridiculousness of the assumption that the true standard deviation is known, there really isn't much point in going into details on this front!

In view of the stupidity of assuming that $\alpha$ is known, let's see if we can live without it. This takes us out of the dreary domain of the z-test, and into the magical kingdom of the t-test, with unicorns and fairies and leprechauns! --->

## 單一樣本t檢定 {#sec-The-one-sample-t-test}

經過一番思考，我(原作者)認為不能安心地假設 Zeppo 老師班上的心理系學生的成績標準差與同班其他科系的學生一樣。若是我假設不同科系的平均值不同，那麼，為什麼我要相信不同科系的標準差是一樣的？基於這些理由，我不應該假設我知道 $\sigma$ 的真實值。如此就違反了 z檢定的適用條件。在這層意義來說，我們的分析習作回到了起點。但是，我們還有其他選擇。畢竟，原始資料還是一樣的，這些原始資料可以給我們一種母群標準差的估計，也就是 9.52。換句話說，雖然我不能說我知道 $\sigma = 9.5$，但是我可以說 $\hat{\sigma}$ = 9.52。

好的，這很不錯。你可能會想到的明顯做法是，使用 $9.52$ 的估計標準差來進行 z 檢定，而不是依賴於我對真實標準差為 $9.5$ 的假設。你可能不會感到意外，這種方法仍然會給我們一個顯著的結果。這種方法很接近，但不是完全正確的。因為現在我們依賴於對人群標準差的估計，所以我們需要對我們對真實人群標準差的不確定性進行一些調整。也許我們的資料只是一個偶然事件......也許真實人群標準差是 $11$。但如果這確實是真的，我們進行 z 檢定時假設 $\sigma=11$，那麼結果將變得不顯著。這是一個問題，我們需要解決。

<!--- After some thought, I decided that it might not be safe to assume that the psychology student grades necessarily have the same standard deviation as the other students in Dr Zeppo's class. After all, if I'm entertaining the hypothesis that they don't have the same mean, then why should I believe that they absolutely have the same standard deviation? In view of this, I should really stop assuming that I know the true value of $\sigma$. This violates the assumptions of my z-test, so in one sense I'm back to square one. However, it's not like I'm completely bereft of options. After all, I've still got my raw data, and those raw data give me an estimate of the population standard deviation, which is 9.52. In other words, while I can't say that I know that $\sigma = 9.5$, I can say that $\hat{\sigma}$ = 9.52.

Okay, cool. The obvious thing that you might think to do is run a z-test, but using the estimated standard deviation of $9.52$ instead of relying on my assumption that the true standard deviation is $9.5$. And you probably wouldn't be surprised to hear that this would still give us a significant result. This approach is close, but it's not quite correct. Because we are now relying on an estimate of the population standard deviation we need to make some adjustment for the fact that we have some uncertainty about what the true population standard deviation actually is. Maybe our data are just a fluke...maybe the true population standard deviation is $11$, for instance. But if that were actually true, and we ran the z-test assuming $\sigma=11$, then the result would end up being non-significant. That's a problem, and it's one we're going to have to address. --->

```{r}
#| label: fig-fig11-4
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 圖解單一樣本t檢定的虛無假設和對立假設（兩側）。請注意，t檢定和z檢定有相似之處（見 @fig-fig11-2 ）。虛無假設的母群平均值$\mu$等於某個特定值$\mu_0$，對立假設不等於$\mu_0$。與z檢定一樣，適用資料服從常態分佈，但是不適用母群標準差$\sigma$事先已知。
#Graphical illustration of the null and alternative hypotheses assumed by the (two sided) one sample t-test. Note the similarity to the z-test (@fig-fig11-2). The null hypothesis is that the population mean $\mu$ is equal to some specified value $\mu_0$, and the alternative hypothesis is that it is not. Like the z-test, we assume that the data are normally distributed, but we do not assume that the population standard deviation $\sigma$ is known in advance


p1 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="black", linewidth=1) +
  geom_segment(x = 0, y = 0.25, xend = -1, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-2.2, y=.25, label=expression(~sigma~" = ?"), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" = "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("虛無假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = -.75, sd = 1), col="black", linewidth=1) +
  geom_segment(x = -.75, y = 0.25, xend = -1.75, yend = 0.25) +
  geom_segment(x = 0, y = 0, xend = 0, yend = dnorm(0)) +
  geom_text(x=-3, y=.25, label=expression(~sigma~" = ??"), size=5) +
  geom_text(x= 0, y=.42, label=expression(~mu~" \U2260 "~mu[0]), size=5) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ylim(0,0.5) +
  ggtitle("對立假設") +
  xlab("\n依變項數值") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

### 深入認識單一樣本t檢定

這種模稜兩可的情況非常煩人，這個難題在 1908 年被 William Sealy Gosset 解決 [@Student1908]。當時他是吉尼斯啤酒廠聘雇的專職化學分析員（參見 @Box1987）。由於吉尼斯公司約束員工自行發表統計分析（顯然公司高層認為這是商業機密），所以他用化名“學生”發表了這項發現。直到今天，t 檢定的真正全名是 **Student's t-test**。Gosset 所發現的關鍵是，我們要如何讓不完全確定真實標準差的取樣分佈與真實資料相容。解法是只要稍微改變取樣分佈。[^11-comparing-two-means-7]在 t 檢定中，我們的檢定統計量，現在稱為 t 統計量，以我上面提到的方式計算。如果我們的虛無假設是真實均值為 $\mu$，但我們的樣本平均值是 $\bar{X}$，而我們對人口標準差的估計是 $\hat{\sigma}$，那麼我們的 t 統計量是：

[^11-comparing-two-means-7]: 嗯，其實這個問題不完全由一個人解決。據我所知，最早高斯有提出部分解決方法；最終解決方法由羅納德·費雪爵士提出。

<!--- This ambiguity is annoying, and it was resolved in 1908 by a guy called William Sealy Gosset [@Student1908], who was working as a chemist for the Guinness brewery at the time (see @Box1987). Because Guinness took a dim view of its employees publishing statistical analysis (apparently they felt it was a trade secret), he published the work under the pseudonym "A Student" and, to this day, the full name of the t-test is actually **Student's t-test**. The key thing that Gosset figured out is how we should accommodate the fact that we aren't completely sure what the true standard deviation is.[^11-comparing-two-means-7] The answer is that it subtly changes the sampling distribution. In the t-test our test statistic, now called a t-statistic, is calculated in exactly the same way I mentioned above. If our null hypothesis is that the true mean is $\mu$, but our sample has mean $\bar{X}$ and our estimate of the population standard deviation is $\hat{\sigma}$, then our t statistic is:

[^11-comparing-two-means-7]: Well, sort of. As I understand the history, Gosset only provided a partial solution; the general solution to the problem was provided by Sir Ronald Fisher. --->

$$
t=\frac{\bar{X}-\mu}{\frac{\hat{\sigma}}{\sqrt{N}}}
$$

```{r}
#| label: fig-fig11-5
#| fig-width:  10
#| fig-height: 5
#| fig-cap: 具有2個自由度（左）和10個自由度（右）的t分布，標準正態分布（即，均值為0，標準差為1）以虛線繪製，以進行比較。請注意，t分布的尾部比正態分布重（高峰度），當自由度非常小時，這種效應會被極大地夸大，但對於較大的值可以忽略不計。換句話說，對於大的自由度，t分布基本上與正態分布相同。
#The t distribution with 2 degrees of freedom (left) and 10 degrees of freedom (right), with a standard normal distribution (i.e., mean 0 and std dev 1) plotted as dotted lines for comparison purposes. Notice that the t distribution has heavier tails (leptokurtic, higher kurtosis) than the normal distribution; this effect is quite exaggerated when the degrees of freedom are very small, but negligible for larger values. In other words, for large $df$ the t distribution is essentially identical to a normal distribution

p1 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="grey", linetype=2, linewidth=1) +
  stat_function(fun = dt, n = 1000, args = list(df = 2), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ggtitle("df = 2") +
  xlab("\nValue of t-statistic") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))


p2 <- ggplot(data = data.frame(x = seq(-4, 4, 1)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 0, sd = 1), col="grey", linetype=2, linewidth=1) +
  stat_function(fun = dt, n = 1000, args = list(df = 20), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(-4, 4, 2)) +
  ggtitle("df = 10") +
  xlab("\nValue of t-statistic") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

等式中唯一變化的是我們使用估計值 $\hat{\sigma}$ 取代已知的真實值 $\sigma$。而如果這個估計值是由 N 個觀察值所構成，那麼樣本分布就會變成一個有 $N-1$ 個自由度的 t 分布。t 分布和正態分布非常相似，但有更重的尾部，正如 @sec-Other-useful-distributions 中討論的，也在 @fig-fig11-5 中呈現。然而，注意到當自由度變大時，t 分布開始看起來和標準正態分布相同。這就是我們期望的：如果樣本大小為 $N = 70,000,000$，那麼你對標準差的「估計」就幾乎完美了，對吧？因此，你應該期望在大樣本時，t 檢驗的表現會和 z 檢驗完全一致。而這也確實如此！

<!---The only thing that has changed in the equation is that instead of using the known true value $\sigma$, we use the estimate $\hat{\sigma}$. And if this estimate has been constructed from N observations, then the sampling distribution turns into a t-distribution with $N-1$ **degrees of freedom** (df). The t distribution is very similar to the normal distribution, but has "heavier" tails, as discussed earlier in @sec-Other-useful-distributions and illustrated in @fig-fig11-5. Notice, though, that as df gets larger, the t-distribution starts to look identical to the standard normal distribution. This is as it should be: if you have a sample size of $N = 70,000,000$ then your "estimate" of the standard deviation would be pretty much perfect, right? So, you should expect that for large $N$, the t-test would behave exactly the same way as a z-test. And that's exactly what happens! --->

### 實作單一樣本t檢定

正如你所預期的，t檢定的機制幾乎與z檢定的機制完全相同。因此，沒有必要繁瑣地展示如何使用低級命令進行計算。它與我們之前所做的計算幾乎相同，只是使用了估計的標準差，然後使用t分佈而不是常態分佈來測試假設。因此，我將直接跳到顯示如何實際進行t檢定。jamovi配備了一個專門用於t檢定的分析，非常靈活（它可以運行許多不同類型的t檢定）。它非常簡單易用；您需要做的只是指定“分析”-“T檢定”-“單樣本T檢定”，將您感興趣的變量（X）移動到“變量”框中，並在“假設”-“測試值”框中輸入零假設的平均值（'67.5'）。很容易。見@fig-fig11-6，除了我們稍後會提到的其他事項之外，它還提供了t檢定統計量=2.25，自由度為19，相關的p值為$0.036$。

<!---As you might expect, the mechanics of the t-test are almost identical to the mechanics of the z-test. So there's not much point in going through the tedious exercise of showing you how to do the calculations using low level commands. It's pretty much identical to the calculations that we did earlier, except that we use the estimated standard deviation and then we test our hypothesis using the t distribution rather than the normal distribution. And so instead of going through the calculations in tedious detail for a second time, I'll jump straight to showing you how t-tests are actually done. jamovi comes with a dedicated analysis for t-tests that is very flexible (it can run lots of different kinds of t-tests). It's pretty straightforward to use; all you need to do is specify 'Analyses' - 'T-Tests' - 'One Sample T-Test', move the variable you are interested in (X) across into the 'Variables' box, and type in the mean value for the null hypothesis ('67.5') in the 'Hypothesis' - 'Test value' box. Easy enough. See @fig-fig11-6, which, amongst other things that we will get to in a moment, gives you a t-test statistic = 2.25, with 19 degrees of freedom and an associated p-value of $0.036$. --->

```{r}
#| label: fig-fig11-6
#| classes: .enlarge-image
#| fig-cap: jamovi執行單一樣本t檢定示範
#jamovi does the one-sample t-test
knitr::include_graphics("images/fig11-6.png")
```

此外，報告了其他兩個可能會引起關注的指標：95％置信區間和效應大小的測量值（我們稍後會談論效應大小）。看起來相當簡單。現在我們該如何處理這個輸出呢？既然我們假裝真的在乎我們的例子，我們很高興地發現結果在統計上是顯著的（即p值低於0.05）。我們可以通過這樣的報告方式來表達結果：

> *心理學生的平均成績為* $72.3$，略高於平均成績$67.5$ ($t(19) = 2.25$，$p = .036$)。平均分差為$4.80$，$95\%$置信區間為$0.34$至$9.26$。

...其中 $t(19)$ 是一個簡寫符號，代表具有 $19$ 自由度的 t 統計量。話雖如此，人們通常不會報告信賴區間，或者使用比我在此展示的更簡短的形式進行報告。例如，看到信賴區間被包含在報告均值差之後的統計資訊中也不是很少見，就像這樣：

$$t(19)=2.25, p = .036, CI_{95} = [0.34, 9.26]$$

在這半行內塞這麼多專業術語，你就知道這必定是非常聰明的。[^11-comparing-two-means-8]

[^11-comparing-two-means-8]: 我覺得更嚴重的是，報告中只有數字而沒有任何解釋和詮釋。我對這樣的技術報告感到非常懷疑。這可能只是因為我自視甚高，但我經常覺得，如果一個作者沒有努力向讀者解釋和詮釋他們的分析，那麼他們自己可能不理解，或者有些懶惰。你的讀者是聰明的，但不是無限耐心的。如果你能幫助他們，就不要讓他們感到煩惱。



<!--- Also reported are two other things you might care about: the 95% confidence interval and a measure of effect size (we'll talk more about effect sizes later). So that seems straightforward enough. Now what do we do with this output? Well, since we're pretending that we actually care about my toy example, we're overjoyed to discover that the result is statistically significant (i.e. p value below .05). We could report the result by saying something like this:

> *With a mean grade of* $72.3$, the psychology students scored slightly higher than the average grade of $67.5$ ($t(19) = 2.25$, $p = .036$); the mean difference was $4.80$ and the $95\%$ confidence interval was from $0.34$ to $9.26$. 

...where $t(19)$ is shorthand notation for a t-statistic that has $19$ degrees of freedom. That said, it's often the case that people don't report the confidence interval, or do so using a much more compressed form than I've done here. For instance, it's not uncommon to see the confidence interval included as part of the stat block after reporting the mean difference, like this:

$$t(19)=2.25, p = .036, CI_{95} = [0.34, 9.26]$$ With that much jargon crammed into half a line, you know it must be really smart.[^11-comparing-two-means-8]

[^11-comparing-two-means-8]: More seriously, I tend to think the reverse is true. I get very suspicious of technical reports that fill their results sections with nothing except the numbers. It might just be that I'm an arrogant jerk, but I often feel like an author that makes no attempt to explain and interpret their analysis to the reader either doesn't understand it themselves, or is being a bit lazy. Your readers are smart, but not infinitely patient. Don't annoy them if you can help it.--->

### 單一樣本t檢定的適用條件 {#sec-one-sample-t-assumptions}

好的，那麼單樣本 t 檢驗有什麼假設呢？因為 t 檢驗基本上就是一個移除了已知標準差假設的 z 檢驗，你不應該感到意外，看到它做出了與 z 檢驗相同的假設，減去了已知標準差的假設，那就是：

- 正態性。我們仍然假設母群分布是正態的 [^11-comparing-two-means-9]，如前所述，有標準的工具可以用來檢查這種假設是否符合（[檢查樣本正態性](11-Comparing-two-means.html#sec-Checking-the-normality-of-a-sample)），如果這種假設被違反，還有其他的測試方法可以替代（[檢驗非正態資料](11-Comparing-two-means.html#testing-non-normal-data)）。
- 獨立性。再次，我們必須假設樣本中的觀察值是相互獨立的產生的。詳細討論請參見之前有關 z 檢驗的討論（[z 檢驗的假設](11-Comparing-two-means.html#assumptions-of-the-z-test)）。

[^11-comparing-two-means-9]: 技術性的註解：以與 z 檢定的假設一樣的方式，我們可以削弱 t 檢定的假設，以便只談論取樣分佈。但是，對於 t 檢定，這樣做比較困難。像以前一樣，我們可以將母群正態性的假設替換為樣本平均數的取樣分佈是正態分布的假設。然而，請記住我們還依賴於對標準差的樣本估計，因此我們還需要 $\hat{\sigma}$ 的取樣分佈是卡方分布的假設。這使得事情變得更加麻煩，這個版本很少在實踐中使用。幸運的是，如果母群分布是正態的，那麼這兩個假設都得到滿足。


總的來說，這兩個假設並不是非常不合理的，因此單樣本 t 檢定在實踐中被廣泛用於比較樣本平均數與假定的母群平均數。

<!--- Okay, so what assumptions does the one-sample t-test make? Well, since the t-test is basically a z-test with the assumption of known standard deviation removed, you shouldn't be surprised to see that it makes the same assumptions as the z-test, minus the one about the known standard deviation. That is

- Normality. We're still assuming that the population distribution is normal[^11-comparing-two-means-9], and as noted earlier, there are standard tools that you can use to check to see if this assumption is met ([Checking the normality of a sample]), and other tests you can do in it's place if this assumption is violated ([Testing non-normal data]).
- Independence. Once again, we have to assume that the observations in our sample are generated independently of one another. See the earlier discussion about the z-test for specifics ([Assumptions of the z-test]).

[^11-comparing-two-means-9]: A technical comment. In the same way that we can weaken the assumptions of the z-test so that we're only talking about the sampling distribution, we can weaken the t-test assumptions so that we don't have to assume normality of the population. However, for the t-test it's trickier to do this. As before, we can replace the assumption of population normality with an assumption that the sampling distribution of $\bar{X}$ is normal. However, remember that we're also relying on a sample estimate of the standard deviation, and so we also require the sampling distribution of $\hat{\sigma}$ to be chi-square. That makes things nastier, and this version is rarely used in practice. Fortunately, if the population distribution is normal, then both of these two assumptions are met.

Overall, these two assumptions aren't terribly unreasonable, and as a consequence the one sample t-test is pretty widely used in practice as a way of comparing a sample mean against a hypothesised population mean. --->

## 獨立樣本t檢定(學生t檢定) {#sec-the-independent-samples-t-test-student-test}

儘管單樣本 t 檢驗有其用處，但它並不是 t 檢驗的最典型範例。[^11-comparing-two-means-10]更常見的情況是當你有兩個不同的觀測組時。在心理學中，這往往對應於研究中的兩個不同條件，每個條件對應於一個不同的參與者組。對於研究中的每個人，您測量一些感興趣的結果變量，而您要問的研究問題是這兩組是否具有相同的母群平均值。這就是獨立樣本 t 檢驗所設計的情況。

[^11-comparing-two-means-10]: 正是因為這個例子很簡單，原作者才會用它帶各位同學入門。

<!--- Although the one sample t-test has its uses, it's not the most typical example of a t-test[^11-comparing-two-means-10]. A much more common situation arises when you've got two different groups of observations. In psychology, this tends to correspond to two different groups of participants, where each group corresponds to a different condition in your study. For each person in the study you measure some outcome variable of interest, and the research question that you're asking is whether or not the two groups have the same population mean. This is the situation that the independent samples t-test is designed for.

[^11-comparing-two-means-10]: Although it is the simplest, which is why I started with it. --->

### 使用獨立t檢定的狀況

假設我們有 33 名學生參加 Harpo 博士的統計學講座，而 Harpo 博士沒有按曲線分數。實際上，Harpo 博士的評分有點神秘，因此我們對整個課程的平均成績一無所知。該課程有兩名導師，Anastasia 和 Bernadette。Anastasia 的輔導課有 $N_1=15$ 名學生，Bernadette 的輔導課有 $N_2=18$ 名學生。我感興趣的研究問題是 Anastasia 和 Bernadette 誰是更好的導師，或者他們的教學效果沒有太大的差異。Harpo 博士將課程成績發送給我，存在 *harpo.csv* 文件中。像往常一樣，我會將文件加載到 jamovi 中，查看它包含哪些變量 - 有三個變量，ID、grade 和 tutor。grade 變量包含每個學生的成績，但它未按正確的測量層級屬性導入到 jamovi 中，因此我需要更改它以使其被視為連續變量（參見 @sec-Changing-data-from-one-level-to-another）。tutor 變量是一個因子，表示每個學生的導師是 Anastasia 還是 Bernadette。

我們可以使用 'Exploration' - 'descriptives' 分析計算平均值和標準差，這裡是一個不錯的摘要表格（@tbl-tab11-2）。

<!---Suppose we have 33 students taking Dr Harpo's statistics lectures, and Dr Harpo doesn't grade to a curve. Actually, Dr Harpo's grading is a bit of a mystery, so we don't really know anything about what the average grade is for the class as a whole. There are two tutors for the class, Anastasia and Bernadette. There are $N_1 = 15$ students in Anastasia's tutorials, and $N_2 = 18$ in Bernadette's tutorials. The research question I'm interested in is whether Anastasia or Bernadette is a better tutor, or if it doesn't make much of a difference. Dr Harpo emails me the course grades, in the *harpo.csv* file. As usual, I'll load the file into jamovi and have a look at what variables it contains - there are three variables, ID, grade and tutor. The grade variable contains each student's grade, but it is not imported into jamovi with the correct measurement level attribute, so I need to change this so it is regarded as a continuous variable (see @sec-Changing-data-from-one-level-to-another). The tutor variable is a factor that indicates who each student's tutor was - either Anastasia or Bernadette.

We can calculate means and standard deviations, using the 'Exploration' - 'descriptives' analysis, and here's a nice little summary table (@tbl-tab11-2). --->

```{r}
#| label: tbl-tab11-2
#| tbl-cap: 兩位統計助教帶的學生成績描述統計
huxtabs[[11]][[2]]
```

為了讓你更清楚知道正在發生什麼，我在 jamovi 中繪製了盒形圖和小提琴圖，並在圖表中添加了平均分數的小實心方塊。這些圖表顯示了兩位助教的學生成績分佈 (@fig-fig11-7)。

<!--- To give you a more detailed sense of what's going on here, I've plotted box and violin plots in jamovi, with mean scores added to the plot with a small solid square. These plots show the distribution of grades for both tutors (@fig-fig11-7), --->

### 深入認識獨立t檢定

獨立樣本 t 檢定有兩種不同的形式，學生 t 檢定和韋爾奇 t 檢定。原始的學生 t 檢定是兩者中比較簡單的一種，但比韋爾奇 t 檢定依賴更為嚴格的假設。假設你現在要進行雙側檢定，目標是確定兩個「獨立樣本」是否來自具有相同平均值（虛無假設）或不同平均值（對立假設）的母群。當我們說「獨立樣本」時，我們真正意思是這兩個樣本之間沒有特殊的關係。現在可能還不太明白，但等到我們談到成對樣本 t 檢定時，這一點就會更清楚了。現在，讓我們指出，如果我們有一個實驗設計，其中參與者是隨機分配到兩組中的一組，而我們想比較這兩組對某個結果度量的平均表現，那麼獨立樣本 t 檢定（而不是成對樣本 t 檢定）就是我們所需要的。

<!--- The **independent samples t-test** comes in two different forms, Student's and Welch's. The original Student t-test, which is the one I'll describe in this section, is the simpler of the two but relies on much more restrictive assumptions than the Welch t-test. Assuming for the moment that you want to run a two-sided test, the goal is to determine whether two "independent samples" of data are drawn from populations with the same mean (the null hypothesis) or different means (the alternative hypothesis). When we say "independent" samples, what we really mean here is that there's no special relationship between observations in the two samples. This probably doesn't make a lot of sense right now, but it will be clearer when we come to talk about the paired samples t-test later on. For now, let's just point out that if we have an experimental design where participants are randomly allocated to one of two groups, and we want to compare the two groups' mean performance on some outcome measure, then an independent samples t-test (rather than a paired samples t-test) is what we're after. --->

```{r}
#| label: fig-fig11-7
#| fig-cap: 盒形圖和小提琴圖顯示Anastasia和Bernadette的班級學生成績分布。從視覺上看，這些圖表暗示著Anastasia的學生平均成績可能會更好，但它們也似乎更加變化不定。
#Box and violin plots showing the distribution of grades for students in Anastasia's and Bernadette's classes. Visually, these suggest that students in Anastasia's class may be getting slightly better grades on average, though they also seem a bit more variable
knitr::include_graphics("images/fig11-7.png")
```

好的，讓我們讓 $\mu_1$ 代表第一組的真實母群平均值（例如 Anastasia 的學生），而 $\mu_2$ 則是第二組的真實母群平均值（例如 Bernadette 的學生）[^11-comparing-two-means-11]，通常我們讓 $\bar{X_1}$ 和 $\bar{X_2}$ 代表這兩個組別的觀察樣本平均值。我們的虛無假設是兩個母群平均值是相同的（$\mu_1 = \mu_2$），而對立假設則是它們不相同（$\mu_1 \neq \mu_2$）（@fig-fig11-8）。以數學術語來說，這是：

<!--- Okay, so let's let $\mu_1$ denote the true population mean for group 1 (e.g., Anastasia's students), and $\mu_2$ will be the true population mean for group 2 (e.g., Bernadette's students),[^11-comparing-two-means-11] and as usual we'll let $\bar{X_1}$ and $\bar{X_2}$ denote the observed sample means for both of these groups. Our null hypothesis states that the two population means are identical ($\mu_1 = \mu_2$) and the alternative to this is that they are not ($\mu_1 \neq \mu_2$) (@fig-fig11-8). Written in mathematical-ese, this is: --->

```{r}
#| label: fig-fig11-8
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 學生t檢定所假設的零假設和替代假設的圖形示意。零假設假設兩組的平均值 $\mu$ 相同，而替代假設則假設兩組的平均值 $\mu_1$ 和 $\mu_2$ 不同。請注意，假設母群分配為正態分配，且儘管替代假設允許兩組平均值不同，但假設它們具有相同的標準差。
#Graphical illustration of the null and alternative hypotheses assumed by the Student t-test. The null hypothesis assumes that both groups have the same mean $\mu$, whereas the alternative assumes that they have different means $\mu_1$ and $\mu_2$. Notice that it is assumed that the population distributions are normal, and that, although the alternative hypothesis allows the group to have different means, it assumes they have the same standard deviation

p1 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 70, sd = 9), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=70, y=.047, label=expression(~mu), size=5) +
  ylim(0,0.05) +
  ggtitle("null hypothesis") +
  xlab("\nValue of X") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 60, sd = 9), col="black", linewidth=1) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 75, sd = 9), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=60, y=.047, label=expression(~mu[1]), size=5) +
  geom_text(x=75, y=.047, label=expression(~mu[2]), size=5) +
  ylim(0,0.05) +
  ggtitle("alternative hypothesis") +
  xlab("\nValue of X") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

[^11-comparing-two-means-11]: 在這個時候，幾乎總是會有一個有趣的問題出現：在這種情況下，究竟是指哪個母群？是真正參加 Harpo 博士課程的學生集合（全部33人）嗎？可能會參加這門課程的人（數量未知）嗎？還是其他什麼？我們選擇哪個對象，會有影響嗎？在介紹行為統計學的課堂上，這時幾乎總是會混混噥噥，但是因為我的學生每年都會問我這個問題，所以我會給出簡短的答案。從技術上講，是有影響的。如果您改變了“真實世界”母群的定義，那麼觀察到的平均值 $\bar{X}$ 的抽樣分佈也會發生變化。t 檢驗依賴於一個假設，即觀察值是從一個無限大的母群中隨機抽樣的，實際情況很少符合這個假設，因此 t 檢驗可能是錯誤的。然而，在實踐中，這通常不是一個大問題。即使這個假設幾乎總是錯誤的，它也不會導致測試出現很多病態行為，因此我們往往會忽略它。

建立一個能夠處理這種情況的假設檢驗，我們開始注意到，如果零假設成立，那麼兩個母群平均數之間的差異就是 *正好* 為零，$\mu_1-\mu_2 = 0$。因此，診斷性的檢定統計量將基於兩個樣本平均數之間的差異。因為如果零假設成立，那麼我們預期 $\bar{X}_1 - \bar{X}_2$ 要非常接近於零。然而，就像我們在單樣本測試中看到的那樣（即單樣本 z 檢定和單樣本 t 檢定），我們必須精確地確定這種差異應該接近於零。解決問題的方法幾乎相同。我們計算一個標準誤差估計值（SE），然後將平均值之間的差異除以這個估計值。因此，我們的 **t 檢定統計量** 將具有以下形式：

$$t=\frac{\bar{X_1}-\bar{X_2}}{SE}$$

我們需要找出這個標準誤差估計值是什麼。這比我們之前介紹過的兩個檢定複雜得多，因此我們需要更仔細地研究它的運作方式。

<!--- A funny question almost always pops up at this point: what the heck is the population being referred to in this case? Is it the set of students actually taking Dr Harpo's class (all 33 of them)? The set of people who might take the class (an unknown number of them)? Or something else? Does it matter which of these we pick? It's traditional in an introductory behavioural stats class to mumble a lot at this point, but since I get asked this question every year by my students, I'll give a brief answer. Technically yes, it does matter. If you change your definition of what the "real world" population actually is, then the sampling distribution of your observed mean $\bar{X}$ changes too. The t-test relies on an assumption that the observations are sampled at random from an infinitely large population and, to the extent that real life isn't like that, then the t-test can be wrong. In practice, however, this isn't usually a big deal. Even though the assumption is almost always wrong, it doesn't lead to a lot of pathological behaviour from the test, so we tend to just ignore it. 

$$H_0: \mu_1=\mu_2 $$ $$H_0: \mu_1 \neq \mu_2 $$ To construct a hypothesis test that handles this scenario we start by noting that if the null hypothesis is true, then the difference between the population means is *exactly* zero, $\mu_1-\mu_2 = 0$. As a consequence, a diagnostic test statistic will be based on the difference between the two sample means. Because if the null hypothesis is true, then we'd expect $\bar{X}_1 - \bar{X}_2$ to be pretty close to zero. However, just like we saw with our one-sample tests (i.e., the one-sample z-test and the one-sample t-test) we have to be precise about exactly how close to zero this difference should be. And the solution to the problem is more or less the same one. We calculate a standard error estimate (SE), just like last time, and then divide the difference between means by this estimate. So our **t-statistic** will be of the form:

$$t=\frac{\bar{X_1}-\bar{X_2}}{SE}$$


We just need to figure out what this standard error estimate actually is. This is a bit trickier than was the case for either of the two tests we've looked at so far, so we need to go through it a lot more carefully to understand how it works.--->

### 標準差的合併估計

在原始的「Student t 檢定」中，我們假設兩個群體有相同的母群標準差。換句話說，無論母群平均數是否相同，我們假設母群標準差是相同的，$\sigma_1 = \sigma_2$。由於我們假設兩個標準差相同，因此我們省略下標，將它們都稱為 $\sigma$。我們該如何估計這個值？當我們有兩個樣本時，該如何建構標準差的單一估計值？答案是，基本上我們將它們加以平均。好吧，有點。實際上，我們取一個*加權平均*的*變異數*估計值，它被用作我們的**合併變異數的估計值**。分配給每個樣本的權重等於該樣本中的觀察數量減去 1。

[其他技術細節[^11-comparing-two-means-12]]

[^11-comparing-two-means-12]: 數學上，我們可以這樣寫：$$w_1=N_1-1$$ $$w_2=N_2-1$$ 現在我們已經對每個樣本分配了權重，我們通過取兩個變異數估計值的加權平均值，$\hat{sigma}_{1}^{2}$ 和 $\hat{sigma}_{2}^{2}$，計算變異數的集體估計值。$$\hat{\sigma}_p^2=\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}$$ 最後，我們通過取平均數的平方根，將集體變異數估計轉換為集體標準差估計。$$\hat{\sigma}_p=\sqrt{\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}}$$ 如果你在這個方程中心理上代入 $(w_1 = N_1 - 1)$ 和 $w_2 = N_2 - 1$，你會得到一個非常醜陋的公式。這個公式似乎是描述集體標準差估計的“標準”方式，但這不是我最喜歡思考集體標準差的方法。我更喜歡這樣思考。我們的資料集實際上對應於一組 N 個觀測值，這些觀測值被分成兩個組。因此，讓我們使用符號 $X_{ik}$ 來表示第 k 個教程組中第 i 個學生所獲得的成績。也就是說，$(X_{11}$ 是 Anastasia 班上第一個學生獲得的成績，$X_{21}$ 是她的第二個學生，以此類推。我們有兩個不同的群體平均值 $\bar{X}_1$ 和 $\bar{X}_2$，我們可以使用符號 $\bar{X}_k$ "一般化地"引用它們，即第 k 個教程組的平均成績。到目前為止，一切都很好。現在，由於每個學生都屬於兩個教程中的一個，我們可以將他們的偏差描述為差異$$X_{ik}-\bar{X}_k$$ 那為什麼不使用這些偏差（即每個學生的成績與他們的教程平均成績之間的差異）？請記住，方差只是一堆平方偏差的平均值，所以我們來這麼做。數學上，我們可以寫成以下式子：
$$\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N}$$
其中符號"$\sum_{ik}$"是一種懶惰的方式，意思是“通過查看所有教程中的所有學生來計算總和”，因為每個"$_{ik}$"對應一個學生。$^a$ 但是，正如我們在 @sec-Estimating-unknown-quantities-from-a-sample 中看到的，通過除以 N 計算變異數會產生一個偏差的樣本方差估計值。因此，以前我們需要除以 $N - 1$ 來修正這個偏差。然而，正如我當時提到的，這種偏差存在的原因是因為變異數估計依賴於樣本均值，並且如果樣本均值與母群均值不等，它可能會有系統地偏移我們對變異數的估計。但是這次，我們依賴於兩個樣本均值！這是否意味著我們有更多的偏差？是的，沒錯。這表示我們現在需要除以 $(N-2)$ 而不是 $(N-1)$，以計算我們的共變異數估計值。因此，我們的公式是：$$\hat{\sigma}_p^2=\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N-2}$$ 最後，如果你對它取平方根，就會得到 $\hat{\sigma}_p$，即共同標準差的估計值。換句話說，共同標準差的計算並不特別，與計算標準差的方式沒有太大的不同。 <br /> --- <br />$^a$ 更正式的符號將在 @sec-Comparing-several-means-one-way-ANOVA 介紹。


<!--- In the original "Student t-test", we make the assumption that the two groups have the same population standard deviation. That is, regardless of whether the population means are the same, we assume that the population standard deviations are identical, $\sigma_1 = \sigma_2$. Since we're assuming that the two standard deviations are the same, we drop the subscripts and refer to both of them as $\sigma$. How should we estimate this? How should we construct a single estimate of a standard deviation when we have two samples? The answer is, basically, we average them. Well, sort of. Actually, what we do is take a *weighted* average of the *variance* estimates, which we use as our **pooled estimate of the variance**. The weight assigned to each sample is equal to the number of observations in that sample, minus 1.

[Additional technical detail [^11-comparing-two-means-12]]

[^11-comparing-two-means-12]: Mathematically, we can write this as $$w_1=N_1-1$$ $$w_2=N_2-1$$ Now that we've assigned weights to each sample we calculate the pooled estimate of the variance by taking the weighted average of the two variance estimates, $\hat{sigma}_{1}^{2}$ and $\hat{sigma}_{2}^{2}$ $$\hat{\sigma}_p^2=\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}$$ Finally, we convert the pooled variance estimate to a pooled standard deviation estimate, by taking the square root. $$\hat{\sigma}_p=\sqrt{\frac{w_1\hat{\sigma}_1^2+w_2\hat{\sigma}_2^2}{w_1+w_2}}$$ And if you mentally substitute $(w_1 = N_1 - 1)$ and $w_2 = N_2 - 1$ into this equation you get a very ugly looking formula. A very ugly formula that actually seems to be the "standard" way of describing the pooled standard deviation estimate. It's not my favourite way of thinking about pooled standard deviations, however. I prefer to think about it like this. Our data set actually corresponds to a set of N observations which are sorted into two groups. So let's use the notation $X_{ik}$ to referto the grade received by the i-th student in the k-th tutorial group. That is, $(X_{11}$ is the grade received by the first student in Anastasia's class, $X_{21}$ is her second student, and so on. And we have two separate group means $\bar{X}_1$ and $\bar{X}_2$, which we could "generically" refer to using the notation $\bar{X}_k$, i.e., the mean grade for the k-th tutorial group. So far, so good. Now, since every single student falls into one of the two tutorials, we can describe their deviation from the group mean as the difference $$X_{ik}-\bar{X}_k$$ So why not just use these deviations (i.e., the extent to which each student's grade differs from the mean grade in their tutorial)? Remember, a variance is just the average of a bunch of squared deviations, so let's do that. Mathematically, we could write it like this $$\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N}$$ where the notation "$\sum_{ik}$" is a lazy way of saying "calculate a sum by looking at all students in all tutorials", since each "$_{ik}$" corresponds to one student.$^a$ But, as we saw in @sec-Estimating-unknown-quantities-from-a-sample, calculating the variance by dividing by N produces a biased estimate of the population variance. And previously we needed to divide by $(N - 1)$ to fix this. However, as I mentioned at the time, the reason why this bias exists is because the variance estimate relies on the sample mean, and to the extent that the sample mean isn't equal to the population mean it can systematically bias our estimate of the variance. But this time we're relying on two sample means! Does this mean that we've got more bias? Yes, yes it does. And does this mean we now need to divide by $(N - 2)$ instead of $(N - 1)$, in order to calculate our pooled variance estimate? Why, yes $$\hat {\sigma}_p^2=\frac{\sum_{ik}(X_{ik}-\bar{X}_k)^2}{N-2}$$  Oh, and if you take the square root of this then you get $\hat{\sigma}_p$, the pooled standard deviation estimate. In other words, the pooled standard deviation calculation is nothing special. It's not terribly different to the regular standard deviation calculation. <br /> --- <br />$^a$ A more correct notation will be introduced in @sec-Comparing-several-means-one-way-ANOVA. --->

## 平均數檢定的更多細節

無論你想以哪種方式思考，現在我們已經有了我們的樣本標準差的匯集估計值。從現在開始，我會忽略那個奇怪的p小標，只稱這個估計值為$\hat{\sigma}$。很好。現在讓我們回到考慮這個該死的假設檢驗，好嗎？我們計算這個匯集估計的整個原因是我們知道它將在計算標準誤時非常有用。但標準誤是什麼？在單樣本t檢驗中，它是樣本平均值的標準誤，$se(\bar{X})$，因為$se(\bar{X}) = \frac{\sigma}{\sqrt{N}}$，這就是我們的t統計量的分母。然而，這一次，我們有兩個樣本均值。而我們特別感興趣的是兩者之間的差異$\bar{X}_1-\bar{X}_2$，因此，我們需要除以的標準誤實際上是均值差的**標準誤**。

[其他技術細節[^11-comparing-two-means-13]]

[^11-comparing-two-means-13]: 只要這兩個變項真的具有相同的標準差，我們對標準誤的估計就是 $$SE(\bar{X}_1-\bar{X}_2)=\hat{\sigma}\sqrt{\frac{1}{N_1}+\frac{1}{N_2}}$$ 因此，我們的 t 統計量為 $$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

正如我們在單樣本檢定中所看到的那樣，只要虛無假設為真且測試的所有假設都符合，這個 t 統計量的取樣分佈就是一個 t 分佈。然而，自由度略有不同。通常，我們可以把自由度視為資料點數減去約束數。在這個情況下，我們有 N 個觀察值（$N_1$ 在樣本 1 中，$N_2$ 在樣本 2 中），和 2 個約束（樣本均值）。因此，這個檢定的總自由度為 $N-2$。

<!---Regardless of which way you want to think about it, we now have our pooled estimate of the standard deviation. From now on, I'll drop the silly p subscript, and just refer to this estimate as $\hat{\sigma}$. Great. Let's now go back to thinking about the bloody hypothesis test, shall we? Our whole reason for calculating this pooled estimate was that we knew it would be helpful when calculating our standard error estimate. But standard error of what? In the one-sample t-test it was the standard error of the sample mean, $se(\bar{X})$, and since $se(\bar{X}) = \frac{\sigma}{\sqrt{N}}$ that's what the denominator of our t-statistic looked like. This time around, however, we have two sample means. And what we're interested in, specifically, is the the difference between the two $\bar{X}_1-\bar{X}_2$ As a consequence, the standard error that we need to divide by is in fact the **standard error of the difference** between means.

[Additional technical detail [^11-comparing-two-means-13]]

[^11-comparing-two-means-13]: As long as the two variables really do have the same standard deviation, then our estimate for the standard error is $$SE(\bar{X}_1-\bar{X}_2)=\hat{\sigma}\sqrt{\frac{1}{N_1}+\frac{1}{N_2}}$$ and our t-statistic is therefore $$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

Just as we saw with our one-sample test, the sampling distribution of this t-statistic is a t-distribution (shocking, isn't it?) as long as the null hypothesis is true and all of the assumptions of the test are met. The degrees of freedom, however, is slightly different. As usual, we can think of the degrees of freedom to be equal to the number of data points minus the number of constraints. In this case, we have N observations ($N_1$ in sample 1, and $N_2$ in sample 2), and 2 constraints (the sample means). So the total degrees of freedom for this test are $N - 2$. --->

### jamovi實作

不出所料，您可以很容易地在 jamovi 中進行獨立樣本 t 檢定。我們測試的結果變量是學生成績，而組是根據每個班級的導師定義的。因此，您可能不會對 jamovi 中的相應分析（“分析”-“T 檢定”-“獨立樣本 T 檢定”）感到意外，只需將成績變量移動到“依變變量”框中，將導師變量移動到“分組變量”框中，如 @fig-fig11-9 所示。

<!---Not surprisingly, you can run an independent samples t-test easily in jamovi. The outcome variable for our test is the student grade, and the groups are defined in terms of the tutor for each class. So you probably won't be too surprised that all you have to do in jamovi is go to the relevant analysis ('Analyses' - 'T-Tests' - 'Independent Samples T-Test') and move the grade variable across to the 'Dependent Variables' box, and the tutor variable across into the 'Grouping Variable' box, as shown in @fig-fig11-9. --->

```{r}
#| label: fig-fig11-9
#| classes: .enlarge-image
#| fig-cap: jamovi執行獨立樣本t檢定示範，請留意圖中勾選的項目。
#Independent t-test in jamovi, with options checked for useful results
knitr::include_graphics("images/fig11-9.png")
```

這裡的輸出形式非常熟悉。首先，它告訴您運行的是什麼測試，以及使用的依變量的名稱。然後報告測試結果。與上次一樣，測試結果包括 t 統計量、自由度和 p 值。最後一部分報告了兩件事：它給出了置信區間和效應大小。我會稍後談論效應大小。然而，現在我應該談論置信區間。

很重要要清楚這個信賴區間到底是什麼意思，它是兩組平均數之間的差異的信賴區間。在這個例子中，Anastasia的學生平均分為74.53，而Bernadette的學生平均分為69.06，因此兩組平均數之間的差異是5.48。但是，兩個母群的平均數差異可能比這個還大或者還小。在@fig-fig11-10中報告的信賴區間告訴你，如果我們重複進行這個研究，那麼在95％的時間裡，真正的平均數差異會在0.20到10.76之間。回顧一下@sec-Estimating-a-confidence-interval了解信賴區間的意思。

在任何情況下，兩組之間的差異是顯著的（僅僅）。因此，我們可以使用以下文本編寫結果:

> Anastasia 班級的平均成績為 $74.5\%$（標準差為 $9.0$），而 Bernadette 班級的平均成績為 $69.1\%$（標準差為 $5.8$）。 學生的獨立樣本 t 檢驗顯示此 $5.4\%$ 差異是顯著的 $(t(31) = 2.1, p<.05, CI_{95} = [0.2, 10.8], d = .74)$，表明學習成果存在真正的差異。

注意到我在統計區塊中包含了信心區間和效應大小。人們並不總是這樣做。至少，您應該期望看到t統計量、自由度和p值。所以您應該至少包含像這樣的內容：$t(31) = 2.1, p< .05$。如果統計學家得到了他們想要的結果，那麼每個人都會報告信心區間，可能還有效應大小測量，因為它們是有用的知識。但現實並不總是按照統計學家的期望運作，所以您應該根據您認為會幫助讀者的情況進行判斷，如果您正在撰寫科學論文，那麼應根據期刊的編輯標準進行決策。有些期刊希望您報告效應大小，而有些則不是。在某些科學社區中，報告信心區間是標準做法，在其他社區中則不是。您需要找出您的觀眾期望什麼。但是，僅僅為了清晰起見，如果您正在上我的課，我的默認立場是通常值得包括效應大小和信心區間。

<!---The output has a very familiar form. First, it tells you what test was run, and it tells you the name of the dependent variable that you used. It then reports the test results. Just like last time the test results consist of a t-statistic, the degrees of freedom, and the *p-value*. The final section reports two things: it gives you a confidence interval and an effect size. I'll talk about effect sizes later. The confidence interval, however, I should talk about now.

It's pretty important to be clear on what this confidence interval actually refers to. It is a confidence interval for the *difference* between the group means. In our example, Anastasia's students had an average grade of $74.53$, and Bernadette's students had an average grade of $69.06$, so the difference between the two sample means is $5.48$. But of course the difference between population means might be bigger or smaller than this. The confidence interval reported in @fig-fig11-10 tells you that there's a if we replicated this study again and again, then $95\%$ of the time the true difference in means would lie between $0.20$ and $10.76$. Look back at @sec-Estimating-a-confidence-interval for a reminder about what confidence intervals mean.

In any case, the difference between the two groups is significant (just barely), so we might write up the result using text like this:

> The mean grade in Anastasia's class was $74.5\%$ (std dev = $9.0$), whereas the mean in Bernadette's class was $69.1\%$ (std dev = $5.8$). A Student's independent samples t-test showed that this $5.4\%$ difference was significant $(t(31) = 2.1, p<.05, CI_{95} = [0.2, 10.8], d = .74)$, suggesting that a genuine difference in learning outcomes has occurred.

Notice that I've included the confidence interval and the effect size in the stat block. People don't always do this. At a bare minimum, you'd expect to see the t-statistic, the degrees of freedom and the p value. So you should include something like this at a minimum: $t(31) = 2.1, p< .05$. If statisticians had their way, everyone would also report the confidence interval and probably the effect size measure too, because they are useful things to know. But real life doesn't always work the way statisticians want it to so you should make a judgement based on whether you think it will help your readers and, if you're writing a scientific paper, the editorial standard for the journal in question. Some journals expect you to report effect sizes, others don't. Within some scientific communities it is standard practice to report confidence intervals, in others it is not. You'll need to figure out what your audience expects. But, just for the sake of clarity, if you're taking my class, my default position is that it's usually worth including both the effect size and the confidence interval. --->

### t統計值正負的意義

在談到t-test的假設之前，我們先來討論t-test在實務上的使用上還有一個重要的觀點。第一個觀點是關於t統計量的符號（即它是正數還是負數）。當學生第一次進行t-test時，他們常常會擔心結果出現負值，不知道如何解釋。實際上，當兩個人獨立地進行實驗時，獲得的結果幾乎相同，但其中一個人的t值是負的，而另一個人的t值是正的，這種情況是很常見的。假設您正在進行雙側檢定，那麼p值是相同的。仔細檢查後，學生們會發現置信區間也是相反的。這是完全正常的。每當這種情況發生時，你會發現兩種不同的結果是由稍微不同的t-test方法引起的。這裡發生的事情非常簡單。我們在這裡計算的t統計量總是具有以下形式

$$t=\frac{\text{平均值1-平均值2}}{SE}$$

如果 "平均值 1" 大於 "平均值 2"，則 t 統計量將為正數，而如果 "平均值 2" 大於 "平均值 1"，則 t 統計量將為負數。同樣地，jamovi 報告的置信區間是 "(平均值 1) 減去 (平均值 2)" 差異的置信區間，這將是計算 "(平均值 2) 減去 (平均值 1)" 差異置信區間的相反。

好的，當你考慮這件事時，其實很簡單，但現在考慮比較阿納斯塔西亞班和伯納德班的 t 檢定。我們應該把哪一個稱為 "mean 1"，哪一個稱為 "mean 2"。這是任意的。然而，你真的需要將其中之一指定為 "mean 1"，另一個為 "mean 2"。不出所料，jamovi 處理這個的方式也相當任意。在本書早期的版本中，我試圖解釋這一點，但過了一段時間後，我放棄了，因為這並不是真正重要的事情，老實說我自己也記不清楚。每當我得到一個顯著的 t 檢定結果，並且我想找出哪個均值較大，我不會嘗試通過查看 t 統計量來找出答案。我為什麼要這麼做？這是愚蠢的。最簡單的方法就是查看實際的組均值，因為 jamovi 的輸出實際上就顯示了它們！

這是重要的一點。因為 jamovi 向您顯示的內容實際上並不重要，所以我通常會嘗試以使數字與文本相符的方式報告 t 統計量。假設我想在報告中寫道：「阿納斯塔西亞的班級的成績高於伯納德的班級。」這種措辭意味著阿納斯塔西亞的組排在第一位，因此把阿納斯塔西亞的班級對應到第一組是有道理的。如果是這樣，我會寫成 *阿納斯塔西亞的班级成绩比伯纳德的班级更*<u>高</u>$(t(31) = 2.1，p = .04)$。

（在現實中我不會真的用下劃線來強調 “higher”，我只是這樣做是為了強調 “higher” 與正的 t 值對應）。另一方面，假設我想使用的措辭是 Bernadette 的班級排在第一位，如果這樣的話，把她的班級作為第一組更有意義，這樣的話報告應該寫成：Bernadette 的班級的成績比 Anastasia 的班級更低 $(t(31) = -2.1, p = .04)$。

最後要注意的是，這種寫法只適用於t檢定，對於卡方檢定、F檢定或本書中提到的大多數檢定而言並無意義。因此不要過度將這個建議泛化！這裡我真的只是在談論t檢定，而不是其他任何東西！

<!--- Before moving on to talk about the assumptions of the t-test, there's one additional point I want to make about the use of t-tests in practice. The first one relates to the sign of the t-statistic (that is, whether it is a positive number or a negative one). One very common worry that students have when they start running their first t-test is that they often end up with negative values for the t-statistic and don't know how to interpret it. In fact, it's not at all uncommon for two people working independently to end up with results that are almost identical, except that one person has a negative t values and the other one has a positive t value. Assuming that you're running a two-sided test then the p-values will be identical. On closer inspection, the students will notice that the confidence intervals also have the opposite signs. This is perfectly okay. Whenever this happens, what you'll find is that the two versions of the results arise from slightly different ways of running the t-test. What's happening here is very simple. The t-statistic that we calculate here is always of the form

$$t=\frac{\text{mean 1-mean 2}}{SE}$$

If "mean 1" is larger than "mean 2" the t statistic will be positive, whereas if "mean 2" is larger then the t statistic will be negative. Similarly, the confidence interval that jamovi reports is the confidence interval for the difference "(mean 1) minus (mean 2)", which will be the reverse of what you'd get if you were calculating the confidence interval for the difference "(mean 2) minus (mean 1)".

Okay, that's pretty straightforward when you think about it, but now consider our t-test comparing Anastasia's class to Bernadette's class. Which one should we call "mean 1" and which one should we call "mean 2". It's arbitrary. However, you really do need to designate one of them as "mean 1" and the other one as "mean 2". Not surprisingly, the way that jamovi handles this is also pretty arbitrary. In earlier versions of the book I used to try to explain it, but after a while I gave up, because it's not really all that important and to be honest I can never remember myself. Whenever I get a significant t-test result, and I want to figure out which mean is the larger one, I don't try to figure it out by looking at the t-statistic. Why would I bother doing that? It's foolish. It's easier just to look at the actual group means since the jamovi output actually shows them!

Here's the important thing. Because it really doesn't matter what jamovi shows you, I usually try to report the t-statistic in such a way that the numbers match up with the text. Suppose that what I want to write in my report is: *Anastasia's class had higher grades than Bernadette's class*. The phrasing here implies that Anastasia's group comes first, so it makes sense to report the t-statistic as if Anastasia's class corresponded to group 1. If so, I would write *Anastasia's class had* <u>higher</u> grades than Bernadette's class $(t(31) = 2.1, p = .04)$.

(I wouldn't actually underline the word "higher" in real life, I'm just doing it to emphasise the point that "higher" corresponds to positive t values). On the other hand, suppose the phrasing I wanted to use has Bernadette's class listed first. If so, it makes more sense to treat her class as group 1, and if so, the write up looks like this: *Bernadette's class had* <u>lower</u> grades than Anastasia's class $(t(31) = -2.1, p = .04)$.

Because I'm talking about one group having "lower" scores this time around, it is more sensible to use the negative form of the t-statistic. It just makes it read more cleanly.

One last thing: please note that you can't do this for other types of test statistics. It works for t-tests, but it wouldn't be meaningful for chi-square tests, F-tests or indeed for most of the tests I talk about in this book. So don't over-generalise this advice! I'm really just talking about t-tests here and nothing else! --->

### 獨立樣本平均數檢定的適用條件 {#sec-independent-t-assumptions}

和單樣本t檢定一樣，學生t檢定也有三個假設，其中一些在[單一樣本t檢定的適用條件](11-Comparing-two-means.html#sec-one-sample-t-assumptions)已經提到：

- *常態性*。和單樣本t檢定一樣，需要假設資料是常態分佈。具體來說，需要假設兩組資料都符合常態分佈。[^11-comparing-two-means-14a]在[檢查樣本正態性]一節中，我們將討論如何檢查正態性，而在[檢驗非正態資料]一節中，我們將討論可能的解決方案。
- *獨立性*。再次需要假設觀測值是獨立抽樣的。在學生t檢定的情況下，有兩個方面需要考慮。首先，需要假設每個樣本內的觀測值是相互獨立的（和單樣本t檢定一樣）。但是，我們還需要假設兩個樣本之間沒有相互依賴關係。例如，如果實驗中同一個人被不小心分配到不同的條件下（例如，同一個人不小心被允許報名參加不同的條件下的實驗），那麼就存在一些跨樣本的依賴關係需要考慮。
- *方差的同質性*（也稱為“等變異性”）。第三個假設是，兩組的母群標準差是相同的。可以使用Levene檢定來測試這個假設，我們稍後會在[檢查同質變異性的假設]中談到。然而，如果您擔心這個假設，有一個非常簡單的解決方法，我們將在下一節中討論。

[^11-comparing-two-means-14a]: 嚴格來說，應該是「平均數的差異」應該是呈現常態分佈，但是如果兩個組別的資料都呈現常態分佈，那麼平均數的差異也會呈現常態分佈。實際上，中央極限定理告訴我們，通常，被測試的兩個樣本平均數的分佈，隨著樣本量的增大，將會接近常態分佈，而不論底層資料的分佈如何。

<!--- As always, our hypothesis test relies on some assumptions. So what are they? For the Student t-test there are three assumptions, some of which we saw previously in the context of the one sample t-test (see [Assumptions of the one sample t-test]):

- *Normality.* Like the one-sample t-test, it is assumed that the data are normally distributed. Specifically, we assume that both groups are normally distributed[^11-comparing-two-means-14a]. In the section on [Checking the normality of a sample] we'll discuss how to test for normality, and in [Testing non-normal data] we'll discuss possible solutions.
- *Independence.* Once again, it is assumed that the observations are independently sampled. In the context of the Student test this has two aspects to it. Firstly, we assume that the observations within each sample are independent of one another (exactly the same as for the one-sample test). However, we also assume that there are no cross-sample dependencies. If, for instance, it turns out that you included some participants in both experimental conditions of your study (e.g., by accidentally allowing the same person to sign up to different conditions), then there are some cross sample dependencies that you'd need to take into account.
- *Homogeneity of variance* (also called "homoscedasticity"). The third assumption is that the population standard deviation is the same in both groups. You can test this assumption using the Levene test, which I'll talk about later on in the book (in @sec-Checking-the-homogeneity-of-variance-assumption). However, there's a very simple remedy for this assumption if you are worried, which I'll talk about in the next section.

[^11-comparing-two-means-14a]: Strictly speaking, it is the **difference** in the means that should be normally distributed, but if both groups have normally distributed data then the difference in means will also be normally distributed. In practice, the Central Limit Theorem assures us that, generally, the distributions of the two sample means being tested will themselves approach normal distributions as the sample sizes get large, regardless of the distributions of the underlying data. --->

## 獨立樣本t檢定(Welch t檢定) {#sec-the-independent-samples-t-test-welch-test}

在實際應用中，使用學生 t 檢定的最大問題是前一節所列的第三個假設。它假設兩組具有相同的標準差，但在現實生活中，這種情況很少發生。如果兩個樣本的平均值不同，為什麼我們期望它們具有相同的標準差呢？實際上，我們沒有理由期望這個假設成立。我們稍後會談到如何檢查這個假設，因為它在幾個不同的地方會出現，不僅僅是 t 檢定。但現在我會談論一下不依賴這個假設的 t 檢定 [@Welch1947] 的不同形式。@fig-fig11-10 以圖形方式說明了 Welch t 檢定對資料的假設，以與 @fig-fig11-8 中的學生 t 檢定進行對比。我承認在談診斷之前談治療有點奇怪，但事實上 Welch 檢定可以在 jamovi 的「獨立樣本 t 檢定」選項中指定，所以這可能是談論它的最好地方。

<!--- The biggest problem with using the Student test in practice is the third assumption listed in the previous section. It assumes that both groups have the same standard deviation. This is rarely true in real life. If two samples don't have the same means, why should we expect them to have the same standard deviation? There's really no reason to expect this assumption to be true. We'll talk a little bit about how you can check this assumption later on because it does crop up in a few different places, not just the t-test. But right now I'll talk about a different form of the t-test [@Welch1947] that does not rely on this assumption. A graphical illustration of what the Welch t test assumes about the data is shown in @fig-fig11-10, to provide a contrast with the Student test version in @fig-fig11-8. I'll admit it's a bit odd to talk about the cure before talking about the diagnosis, but as it happens the Welch test can be specified as one of the 'Independent Samples T-Test' options in jamovi, so this is probably the best place to discuss it. --->

```{r}
#| label: fig-fig11-10
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 圖形說明了 Welch t 檢定所假設的虛無假說和替代假說。和 Student t-test（見圖@fig-fig11-9）一樣，我們假設兩個樣本都是從一個常態分佈的母群中抽取的; 但是，替代假說不再需要兩個母群具有相等的變異數。
#Graphical illustration of the null and alternative hypotheses assumed by the Welch t-test. Like the Student test (@fig-fig11-9) we assume that both samples are drawn from a normal population; but the alternative hypothesis no longer requires the two populations to have equal variance

p1 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 70, sd = 6.5), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=70, y=.066, label=expression(~mu), size=5) +
  ylim(0,0.07) +
  ggtitle("null hypothesis") +
  xlab("\nValue of X") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(data = data.frame(x = seq(30, 110, 10)), aes(x)) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 60, sd = 6.5), col="black", linewidth=1) +
  stat_function(fun = dnorm, n = 1000, args = list(mean = 75, sd = 7.95), col="black", linewidth=1) +
  scale_x_continuous(breaks = seq(40, 100, 20)) +
  geom_text(x=60, y=.066, label=expression(~mu[1]), size=5) +
  geom_text(x=75, y=.055, label=expression(~mu[2]), size=5) +
  ylim(0,0.07) +
  ggtitle("alternative hypothesis") +
  xlab("\nValue of X") +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2, ncol=2)

```

Welch 檢定與 Student 檢定非常相似。例如，在 Welch 檢定中，我們使用的 t 統計量的計算方式與 Student 檢定非常相似。也就是說，我們取樣本平均數之間的差異，然後除以其標準誤的估計：

$$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

主要的差異在於標準誤的計算方式不同。如果兩個母群具有不同的標準差，那麼嘗試計算合併的標準差估計是完全荒謬的，因為你正在平均蘋果和橘子。[^11-comparing-two-means-14]

[^11-comparing-two-means-14]: 嗯，我猜你可以平均蘋果和橙子，而最終得到的是美味的果汁。但是，沒有人真正認為果汁是描述原始水果的很好的方式，對吧？


[其他技術細節 [^11-comparing-two-means-15]]

[^11-comparing-two-means-15]: 但是你仍然可以估計樣本平均值之間的標準誤差，只是它看起來不同：

$$SE(\bar{X}_1-\bar{X}_2)=\sqrt{\frac{\hat{\sigma}_1^2}{N_1}+\frac{\hat{\sigma}_2^2}{N_2}}$$

為什麼是這樣計算的原因超出了本書的範圍。對我們而言重要的是，從 Welch t-test 得出的 t 統計量實際上與從 Student t-test 得出的 t 統計量略有不同。

Welch 與 Student 之間的第二個差異在於，計算自由度的方式非常不同。在 Welch 測試中，「自由度」不再必須是一個整數，並且它不太符合「資料點數量減去約束數量」的啟發式方法，這是我到目前為止一直在使用的。

<!--- The Welch test is very similar to the Student test. For example, the t-statistic that we use in the Welch test is calculated in much the same way as it is for the Student test. That is, we take the difference between the sample means and then divide it by some estimate of the standard error of that difference

$$t=\frac{\bar{X}_1-\bar{X}_2}{SE(\bar{X}_1-\bar{X}_2)}$$

The main difference is that the standard error calculations are different. If the two populations have different standard deviations, then it's a complete nonsense to try to calculate a pooled standard deviation estimate, because you're averaging apples and oranges.[^11-comparing-two-means-14]

[^11-comparing-two-means-14]: Well, I guess you can average apples and oranges, and what you end up with is a delicious fruit smoothie. But no one really thinks that a fruit smoothie is a very good way to describe the original fruits, do they?

[Additional technical detail [^11-comparing-two-means-15]]

[^11-comparing-two-means-15]: But you can still estimate the standard error of the difference between sample means, it just ends up looking different $$SE(\bar{X}_1-\bar{X}_2)=\sqrt{\frac{\hat{\sigma}_1^2}{N_1}+\frac{\hat{\sigma}_2^2}{N_2}}$$ The reason why it's calculated this way is beyond the scope of this book. What matters for our purposes is that the t-statistic  that comes out of the Welch t-test is actually somewhat different to the one that comes from the Student t-test.

The second difference between Welch and Student is that the degrees of freedom are calculated in a very different way. In the Welch test, the "degrees of freedom" doesn't have to be a whole number any more, and it doesn't correspond all that closely to the "number of data points minus the number of constraints" heuristic that I've been using up to this point. --->

### jamovi實作

如果你在上面的分析中勾選了 Welch test 的核取方塊，則會得到以下結果（見@fig-fig11-11）。

<!--- If you tick the check box for the Welch test in the analysis we did above, then this is what it gives you (@fig-fig11-11). --->

```{r}
#| label: fig-fig11-11
#| classes: .enlarge-image
#| fig-cap: jamovi並列學生t檢定與Welch t檢定結果。
#Results showing the Welch test alongside the default Student's t-test in jamovi
knitr::include_graphics("images/fig11-11.png")
```

這個輸出結果的解釋應該很明顯。您可以像讀取學生t檢驗的結果一樣讀取Welch檢驗的輸出。你有你的描述統計資料，測試結果和其他信息。所以這一切都相當容易。

除了，除了... 我們的結果不再顯著。 當我們執行Student t-test時，我們得到了一個顯著的效應，但在相同的資料集上進行的Welch測試並不顯著 $(t(23.02) = 2.03, p = .054)$。 這是什麼意思？ 我們應該恐慌嗎？ 天空是否燃燒？ 可能不是。 一個測試顯著，而另一個測試不顯著本身並沒有什麼意義，特別是因為我有點編造了這些資料。 通常，不要試圖解釋或解釋$.049$和$.051$之間的p值差異。 如果這種情況在現實生活中發生，這些p值之間的差異幾乎肯定是由於偶然性引起的。 重要的是，您在選擇使用哪種測試時要仔細思考。 Student測試和Welch測試各有優勢和劣勢。 如果兩個母群確實具有相等的變異數，則Student測試比Welch測試略具備更高的功效（較低的II型錯誤率）。 但是，如果它們的變異數不同，則Student測試的假設就會被違反，您可能無法信任它。 您可能會得到更高的I型錯誤率。 因此，這是一個權衡。 但是，在現實生活中，我通常更喜歡使用Welch測試，因為幾乎沒有人認為母群變異數是相同的。


<!--- The interpretation of this output should be fairly obvious. You read the output for the Welch's test in the same way that you would for the Student's test. You've got your descriptive statistics, the test results and some other information. So that's all pretty easy.

Except, except...our result isn't significant anymore. When we ran the Student test we did get a significant effect, but the Welch test on the same data set is not $(t(23.02) = 2.03, p = .054)$. What does this mean? Should we panic? Is the sky burning? Probably not. The fact that one test is significant and the other isn't doesn't itself mean very much, especially since I kind of rigged the data so that this would happen. As a general rule, it's not a good idea to go out of your way to try to interpret or explain the difference between a p-value of $.049$ and a p-value of $.051$. If this sort of thing happens in real life, the *difference* in these p-values is almost certainly due to chance. What does matter is that you take a little bit of care in thinking about what test you use. The Student test and the Welch test have different strengths and weaknesses. If the two populations really do have equal variances, then the Student test is slightly more powerful (lower Type II error rate) than the Welch test. However, if they *don't* have the same variances, then the assumptions of the Student test are violated and you may not be able to trust it; you might end up with a higher Type I error rate. So it's a trade off. However, in real life I tend to prefer the Welch test, because almost no-one actually believes that the population variances are identical. --->

### Welch檢定的適用條件

Welch檢定的假設與學生t檢定的假設非常相似（請參閱[獨立樣本平均數檢定的適用條件](11-Comparing-two-means.html#fig-fig11-9#sec-independent-t-assumptions)），唯一不同的是Welch檢定不需要假定變異數相同。這只剩下正態性和獨立性的假設，這些假設的細節對於Welch檢定和學生t檢定來說是相同的。

<!--- The assumptions of the Welch test are very similar to those made by the Student t-test (see [Assumptions of the test], except that the Welch test does not assume homogeneity of variance. This leaves only the assumption of normality and the assumption of independence. The specifics of these assumptions are the same for the Welch test as for the Student test. --->

## 相依樣本t檢定 {#sec-the-paired-t-test}

不論是談論學生 t 檢驗或韋爾奇 t 檢驗，獨立樣本 t 檢驗都適用於具有兩個互相獨立樣本的情況。當參與者被隨機分配到其中一個實驗條件時，自然會出現這種情況，但這對於其他類型的研究設計提供了一個非常差的近似。特別是，在重複測量設計中，每個參與者都在兩個實驗條件下測量（對於相同的結果變量），並不適合使用獨立樣本 t 檢驗進行分析。例如，我們可能會對聆聽音樂是否降低人們的工作記憶容量感興趣。為此，我們可以在兩種情況下測量每個人的工作記憶容量：有音樂和無音樂。在這樣的實驗設計中，[^11-comparing-two-means-16]每個參與者出現在 *兩個* 組中。這需要我們以不同的方式來解決問題，即使用**配對樣本 t 檢驗**。

[^11-comparing-two-means-16]: 這個設計非常類似於啟發麥克馬(McNemar)檢驗的設計。這一點不足為奇。兩者都是標準的重複測量設計，涉及兩次測量。唯一的區別是這次我們的結果變量是間隔尺度(工作記憶容量)，而不是二元名義尺度變量(是或否問題)。

<!--- Regardless of whether we're talking about the Student test or the Welch test, an independent samples t-test is intended to be used in a situation where you have two samples that are, well, independent of one another. This situation arises naturally when participants are assigned randomly to one of two experimental conditions, but it provides a very poor approximation to other sorts of research designs. In particular, a repeated measures design, in which each participant is measured (with respect to the same outcome variable) in both experimental conditions, is not suited for analysis using independent samples t-tests. For example, we might be interested in whether listening to music reduces people's working memory capacity. To that end, we could measure each person's working memory capacity in two conditions: with music, and without music. In an experimental design such as this one, [^11-comparing-two-means-16] each participant appears in *both* groups. This requires us to approach the problem in a different way, by using the **paired samples t-test**.

[^11-comparing-two-means-16]: This design is very similar to the one that motivated the McNemar test (@sec-The-McNemar-test). This should be no surprise. Both are standard repeated measures designs involving two measurements. The only difference is that this time our outcome variable is interval scale (working memory capacity) rather than a binary, nominal scale variable (a yes-or-no question). --->

### 示範資料

這次我們要使用的資料集來自Chico博士的班級。[^11-comparing-two-means-17] 在她的課堂上，學生要參加兩次主要考試，一次在學期初，一次在學期後。據她所說，她開的課很難，大多數學生都覺得很有挑戰性。但她認為，通過設置困難的評估，學生會被鼓勵更加努力地學習。她的理論是，第一次考試對學生來說是一個“提醒”，當他們意識到她的課有多難時，他們會為第二次考試更加努力，取得更好的成績。她的觀點正確嗎？為了測試這個問題，讓我們將*chico.csv*文件導入到jamovi中。這次，jamovi在導入期間做了一個好工作，正確地分類了變量的測量水平。*chico*資料集包含三個變量：一個id變量，用於識別班級中的每個學生，grade_test1變量記錄第一次考試的學生成績，grade_test2變量則是第二次考試的成績。

[^11-comparing-two-means-17]: 此時，我們有 Harpo 博士、Chico 博士和 Zeppo 博士。猜猜看誰是 Groucho 博士，不用給獎品。

如果我們看一下 jamovi 的試算表，似乎這個班級很難（大多數的成績都在50%到60%之間），但從第一次測驗到第二次測驗似乎有進步的趨勢。

如果我們快速查看一下描述性統計，在 @fig-fig11-12 中，我們可以看到這種印象似乎得到了支持。在所有20個學生中，第一次測驗的平均成績為57%，但第二次測驗的平均成績為58%。但是，考慮到標準差分別為6.6%和6.4%，這種進步感覺起來可能只是虛假的，也可能只是隨機變異。當你看到在@fig-fig11-13a中繪製的平均值和置信區間時，這種印象得到了加強。如果我們僅僅依靠這個圖表，看看這些置信區間有多寬，我們會認為學生表現的明顯改善純粹是偶然的。



<!--- The data set that we'll use this time comes from Dr Chico's class.[^11-comparing-two-means-17] In her class students take two major tests, one early in the semester and one later in the semester. To hear her tell it, she runs a very hard class, one that most students find very challenging. But she argues that by setting hard assessments students are encouraged to work harder. Her theory is that the first test is a bit of a "wake up call" for students. When they realise how hard her class really is, they'll work harder for the second test and get a better mark. Is she right? To test this, let's import the *chico.csv* file into jamovi. This time jamovi does a good job during the import of attributing measurement levels correctly. The *chico* data set contains three variables: an id variable that identifies each student in the class, the grade_test1 variable that records the student grade for the first test, and the grade_test2 variable that has the grades for the second test.

[^11-comparing-two-means-17]: At this point we have Drs Harpo, Chico and Zeppo. No prizes for guessing who Dr Groucho is.

If we look at the jamovi spreadsheet it does seem like the class is a hard one (most grades are between 50% and 60%), but it does look like there's an improvement from the first test to the second one.

If we take a quick look at the descriptive statistics, in @fig-fig11-12, we see that this impression seems to be supported. Across all 20 students the mean grade for the first test is 57%, but this rises to 58% for the second test. Although, given that the standard deviations are 6.6% and 6.4% respectively, it's starting to feel like maybe the improvement is just illusory; maybe just random variation. This impression is reinforced when you see the means and confidence intervals plotted in @fig-fig11-13a. If we were to rely on this plot alone, looking at how wide those confidence intervals are, we'd be tempted to think that the apparent improvement in student performance is pure chance. --->

```{r}
#| label: fig-fig11-12
#| classes: .enlarge-image
#| fig-cap: chico資料集中的兩次測驗成績資料及描述統計
#Descriptives for the two grade test variables in the *chico* data set
knitr::include_graphics("images/fig11-12.png")
```

然而，這種印象是錯的。要知道原因，請看  @fig-fig11-13b 中顯示的評分1和評分2的散佈圖。在這個圖中，每個點對應於一個給定學生的兩個成績。如果他們的評分1（x座標）等於他們的評分2（y座標），那麼該點就會落在直線上。在線上方的點是第二次測試表現更好的學生。重要的是，幾乎所有的資料點都在對角線以上：幾乎所有的學生似乎都有一些提高，即使只有一點點。這表明我們應該關注每個學生在一次測試和下一次測試中所取得的進步，並將其作為我們的原始資料。為此，我們需要創建一個新變量，用於表示每個學生所取得的進步，並將其添加到 *chico* 資料集中。最簡單的方法是計算一個新變量，使用表達式 grade test2 - grade test1。

<!--- Nevertheless, this impression is wrong. To see why, take a look at the scatterplot of the grades for test 1 against the grades for test 2, shown in @fig-fig11-13b. In this plot each dot corresponds to the two grades for a given student. If their grade for test 1 (x co-ordinate) equals their grade for test 2 (y co-ordinate), then the dot falls on the line. Points falling above the line are the students that performed better on the second test. Critically, almost all of the data points fall above the diagonal line: almost all of the students do seem to have improved their grade, if only by a small amount. This suggests that we should be looking at the improvement made by each student from one test to the next and treating that as our raw data. To do this, we'll need to create a new variable for the improvement that each student makes, and add it to the *chico* data set. The easiest way to do this is to compute a new variable, with the expression grade test2 - grade test1. --->

::: {#fig-fig11-13 layout-ncol=2 layout-valign="bottom" width=80%}

![](images/fig11-13a.png){#fig-fig11-13a fig-align="left" width=40%}

![](images/fig11-13b.png){#fig-fig11-13b fig-align="left" width=40%}

第一次測驗和第二次測驗的平均分數，以及相應的95％置信區間(a)。顯示第一次測驗和第二次測驗的個別分數的散點圖(b)。
<!---Mean grade for test 1 and test 2, with associated 95\% confidence intervals (a). Scatterplot showing the individual grades for test 1 and test 2 (b).--->
:::


我們一旦計算了這個新的改進變量，就可以繪製一個直方圖，顯示這些改進分數的分布，如@fig-fig11-14所示。當我們觀察這個直方圖時，很明顯這裡有真正的進步。絕大多數的學生在第二次測試中得分比第一次高，這反映在幾乎整個直方圖都在零以上。

<!---Once we have computed this new improvement variable we can draw a histogram showing the distribution of these improvement scores, shown in @fig-fig11-14. When we look at the histogram, it's very clear that there is a real improvement here. The vast majority of the students scored higher on test 2 than on test 1, reflected in the fact that almost the entire histogram is above zero.

Histogram showing the improvement made by each student in Dr Chico's class. Notice that almost the entire distribution is above zero - the vast majority of students did improve their performance from the first test to the second one
--->

![柱狀圖顯示了 Chico 博士班上每位學生的成績提升。注意到幾乎整個分布都在 0 的上方——大多數學生在第二次考試中的表現確實有所提升。](images/fig11-14.png){#fig-fig11-14 fig-align="left" width=60%}

### 深入認識相依樣本t檢定

根據先前的探索，讓我們思考如何建立一個適當的 t 檢定。一個可能的方法是嘗試使用grade_test1和grade_test2作為感興趣的變量進行獨立樣本 t 檢定。然而，這顯然是錯誤的，因為獨立樣本 t 檢定假定兩個樣本之間沒有特定的關係。然而，由於資料中的重複測量結構，這顯然是不正確的。使用我在上一節中介紹的語言，如果我們試圖進行獨立樣本 t 檢定，我們會混淆 **樣本內** 差異（這是我們想要測試的）和 **樣本間** 變異性（這是我們不想要的）。

解決這個問題的方法很明顯，我希望，因為我們已經在前一節中完成了所有的艱苦工作。我們不是對grade_test1和grade_test2進行獨立樣本t檢驗，而是對內部差異變量improvement進行單樣本t檢驗。稍微形式化一下，如果$X_{i1}$是第i個參與者在第一個變量上獲得的分數，$X_{i2}$是同一個人在第二個變量上獲得的分數，那麼差異分數是：

$$D_i=X_{i1}-X_{i2}$$

請注意，差異分數是變量1減去變量2，而不是反過來，因此如果我們希望改進對應到一個正值的差異，我們實際上需要將「測試2」作為「變量1」。同樣，我們會說 $\mu_D = \mu_1 - \mu_2$ 是此差異變量的母群平均值。因此，為了將其轉換為假設檢驗，我們的虛無假設是此平均差異為零，而對立假設是它不是

$$H_0:\mu_D=0$$ $$H_1:\mu_D \neq 0$$

這假設我們進行的是雙邊檢定。這與我們描述一樣，進行一樣的假設檢定。唯一的不同之處在於零假設所預測的特定值為0。因此，我們的 t 統計量可以用類似的方式來定義。如果我們讓 $\bar{D}$ 代表差異得分的平均值，那麼

$$t=\frac{\bar{D}}{SE(\bar{D})}$$

其中 $\hat{\sigma}_D$ 是差異得分的標準差。因為這只是一個普通的單樣本 t 檢定，沒有什麼特別的地方，所以自由度仍然是 $N - 1$。這就是全部。實際上，配對樣本 t 檢定並不是一個新的檢定，它是一個應用在兩個變項之間差異上的單樣本 t 檢定。它實際上非常簡單。它需要進行長時間的討論的唯一原因是，您需要能夠辨認何時適用配對樣本 t 檢定，以及為什麼它比獨立樣本 t 檢定更好。

<!---In light of the previous exploration, let's think about how to construct an appropriate t test. One possibility would be to try to run an independent samples t-test using grade_test1 and grade_test2 as the variables of interest. However, this is clearly the wrong thing to do as the independent samples t-test assumes that there is no particular relationship between the two samples. Yet clearly that's not true in this case because of the repeated measures structure in the data. To use the language that I introduced in the last section, if we were to try to do an independent samples t-test, we would be conflating the **within subject** differences (which is what we're interested in testing) with the **between subject** variability (which we are not).

The solution to the problem is obvious, I hope, since we already did all the hard work in the previous section. Instead of running an independent samples t-test on grade_test1 and grade_test2, we run a one-sample t-test on the within-subject difference variable, improvement. To formalise this slightly, if $X_{i1}$ is the score that the i-th participant obtained on the first variable, and $X_{i2}$ is the score that the same person obtained on the second one, then the difference score is:

$$D_i=X_{i1}-X_{i2}$$

Notice that the difference scores is variable 1 minus variable 2 and not the other way around, so if we want improvement to correspond to a positive valued difference, we actually want "test 2" to be our "variable 1". Equally, we would say that $\mu_D = \mu_1 - \mu_2$ is the population mean for this difference variable. So, to convert this to a hypothesis test, our null hypothesis is that this mean difference is zero and the alternative hypothesis is that it is not

$$H_0:\mu_D=0$$ $$H_1:\mu_D \neq 0$$

This is assuming we're talking about a two-sided test here. This is more or less identical to the way we described the hypotheses for the one-sample t-test. The only difference is that the specific value that the null hypothesis predicts is 0. And so our t-statistic is defined in more or less the same way too. If we let $\bar{D}$ denote the mean of the difference scores, then

$$t=\frac{\bar{D}}{SE(\bar{D})}$$ which is $$t=\frac{\bar{D}}{\frac{\hat{\sigma}_D}{\sqrt{N}}}$$

where $\hat{\sigma}_D$ is the standard deviation of the difference scores. Since this is just an ordinary, one-sample t-test, with nothing special about it, the degrees of freedom are still $N - 1$. And that's it. The paired samples t-test really isn't a new test at all. It's a one-sample t-test, but applied to the difference between two variables. It's actually very simple. The only reason it merits a discussion as long as the one we've just gone through is that you need to be able to recognise *when* a paired samples test is appropriate, and to understand *why* it's better than an independent samples t test.--->

### 實作相依樣本t檢定

如何在jamovi中執行配對樣本t檢定？一種可能的方法是按照我上面概述的過程進行。即，創建一個“差異”變量，然後對其進行單樣本t檢定。因為我們已經創建了一個名為improvement的變量，讓我們這麼做並看看我們得到什麼，如@fig-fig11-15所示。

<!--- How do you do a paired samples t-test in jamovi? One possibility is to follow the process I outlined above. That is, create a "difference" variable and then run a one sample t-test on that. Since we've already created a variable called improvement, let's do that and see what we get, @fig-fig11-15. --->

```{r}
#| label: fig-fig11-15
#| classes: .enlarge-image
#| fig-cap: 配對差異分數的單一樣本t檢定結果表。
#Results showing a one sample t-test on paired difference scores
knitr::include_graphics("images/fig11-15.png")
```

在@fig-fig11-15中顯示的輸出與上一次使用單樣本t檢定分析時（@sec-The-one-sample-t-test）完全相同的格式，並確認了我們的直覺。從第一次測試到第二次測試，平均改善了1.4％，並且這與0顯著不同$(t(19)=6.48,p<.001)$。

然而，假設您很懶，不想花費大量精力創建新變量。或者也許您只想保持單樣本和配對樣本測試之間的差異清晰。如果是這樣，您可以使用jamovi的“配對樣本t檢定”分析，獲得@fig-fig11-16中顯示的結果。

<!--- The output shown in @fig-fig11-15 is (obviously) formatted exactly the same was as it was the last time we used the one-sample t-Test analysis (@sec-The-one-sample-t-test), and it confirms our intuition. There's an average improvement of $1.4\%$ from test 1 to test 2, and this is significantly different from $0$ $(t(19) = 6.48, p< .001)$.

However, suppose you're lazy and you don't want to go to all the effort of creating a new variable. Or perhaps you just want to keep the difference between one-sample and paired samples tests clear in your head. If so, you can use the jamovi 'Paired Samples T-Test' analysis, getting the results shown in @fig-fig11-16. --->

```{r}
#| label: fig-fig11-16
#| classes: .enlarge-image
#| fig-cap: 相依樣本t檢定結果表。請與 @fig-fig11-15 比較看看。
#Results showing a paired sample t-test. Compare with @fig-fig11-15
knitr::include_graphics("images/fig11-16.png")
```

結果跟進行單樣本t檢定時的結果相同，這當然是因為成對樣本t檢定在實質上就是對差異變項執行單樣本t檢定。

<!--- The numbers are identical to those that come from the one sample test, which of course they have to be given that the paired samples t-test is just a one sample test under the hood. --->

## 單尾檢定 {#sec-the-one-tail-t-test}

當介紹零假設檢定理論時，我提到有一些情況適合指定單邊檢定（請參閱 @sec-The-difference-between-one-sided-and-two-sided-tests ）。到目前為止，所有的t檢定都是雙邊檢定。例如，當我們為Zeppo博士課堂上的成績指定單一樣本t檢定時，零假設是真實均值為$67.5\%$。對立假設是真實均值高於或低於$67.5\%$。假設我們只想知道真實均值是否高於$67.5\%$，並且完全沒有興趣測試真實均值是否低於$67.5\%$。如果是這樣，我們的零假設將是真實均值為$67.5\%$或更低，對立假設將是真實均值高於$67.5\%$。在jamovi中，對於“單一樣本t檢定”分析，您可以在“假設”下點擊“> Test Value”選項進行指定。這樣做後，您將得到@fig-fig11-17中顯示的結果。

<!--- When introducing the theory of null hypothesis tests, I mentioned that there are some situations when it's appropriate to specify a one-sided test (see @sec-The-difference-between-one-sided-and-two-sided-tests). So far all of the t-tests have been two-sided tests. For instance, when we specified a one sample t-test for the grades in Dr Zeppo's class the null hypothesis was that the true mean was $67.5\%$. The alternative hypothesis was that the true mean was greater than or less than $67.5\%$. Suppose we were only interested in finding out if the true mean is greater than $67.5\%$, and have no interest whatsoever in testing to find out if the true mean is lower than $67.5\%$. If so, our null hypothesis would be that the true mean is $67.5\%$ or less, and the alternative hypothesis would be that the true mean is greater than $67.5\%$. In jamovi, for the 'One Sample T-Test' analysis, you can specify this by clicking on the '$>$ Test Value' option, under 'Hypothesis'. When you have done this, you will get the results as shown in @fig-fig11-17.--->

```{r}
#| label: fig-fig11-17
#| classes: .enlarge-image
#| fig-cap: jamovi生成的「單一樣本t檢定」結果，其中實際假設是單側的，即真實平均數大於 $67.5%$
#jamovi results showing a 'One Sample T-Test' where the actual hypothesis is one sided, i.e. that the true mean is greater than $67.5\%$
knitr::include_graphics("images/fig11-17.png")
```

注意到輸出與上次看到的輸出有一些變化。最重要的是實際假設已更改，以反映不同的測試。第二件要注意的事情是儘管t統計量和自由度沒有改變，但p值已經改變。這是因為單側測試具有與雙側測試不同的拒絕區域。如果您忘記了這是為什麼以及它意味著什麼，您可以回顧一下@sec-Hypothesis-testing，特別是@sec-The-difference-between-one-sided-and-two-sided-tests。第三件要注意的是置信區間也不同：現在報告了一個“單側”的置信區間，而不是一個雙側的置信區間。在雙側置信區間中，我們試圖找到數字a和b，使得如果我們重複進行該研究多次，那麼有$95\%$的機會均值會落在a和b之間。在單側置信區間中，我們試圖找到一個數字a，使得我們有信心有$95\%$的機會真實均值會大於a（如果您在“假設”部分中選擇了測量1 < 測量2則為小於a）。

所有版本的t檢定都可以是單側的。對於獨立樣本t檢定，如果您只想測試A組的得分是否比B組高，但對於是否要找出B組的得分是否高於A組沒有興趣，那麼您可以進行單側檢定。假設對於Harpo博士的課程，您想知道Anastasia的學生是否比Bernadette的學生成績更好。對於此分析，在“假設”選項中指定“Group 1 \> Group2”。您應該可以得到如圖@fig-fig11-18所示的結果。

<!--- Notice that there are a few changes from the output that we saw last time. Most important is the fact that the actual hypothesis has changed, to reflect the different test. The second thing to note is that although the t-statistic and degrees of freedom have not changed, the p-value has. This is because the one-sided test has a different rejection region from the two-sided test. If you've forgotten why this is and what it means, you may find it helpful to read back over @sec-Hypothesis-testing, and @sec-The-difference-between-one-sided-and-two-sided-tests in particular. The third thing to note is that the confidence interval is different too: it now reports a "one-sided" confidence interval rather than a two-sided one. In a two-sided confidence interval we're trying to find numbers a and b such that we're confident that, if we were to repeat the study many times, then $95\%$ of the time the mean would lie between a and b. In a one-sided confidence interval, we're trying to find a single number a such that we're confident that $95\%$ of the time the true mean would be greater than a (or less than a if you selected Measure 1 < Measure 2 in the 'Hypothesis' section).

So that's how to do a one-sided one sample t-test. However, all versions of the t-test can be one-sided. For an independent samples t test, you could have a one-sided test if you're only interested in testing to see if group A has higher scores than group B, but have no interest in finding out if group B has higher scores than group A. Let's suppose that, for Dr Harpo's class, you wanted to see if Anastasia's students had higher grades than Bernadette's. For this analysis, in the 'Hypothesis' options, specify that 'Group 1 \> Group2'. You should get the results shown in @fig-fig11-18. --->

```{r}
#| label: fig-fig11-18
#| classes: .enlarge-image
#| fig-cap: jamovi生成的'獨立樣本t檢定'分析，實際假設為單尾檢定，即 Anastasia 的學生的成績高於 Bernadette 的學生
#jamovi results showing an 'Independent Samples t-Test' where the actual hypothesis is one sided, i.e. that Anastasia's students had higher grades than Bernadette's
knitr::include_graphics("images/fig11-18.png")
```

再次強調，輸出結果有可預測的變化。替代假設的定義已改變，p值已變化，現在報告的是單邊信賴區間，而不是雙邊信賴區間。

那麼，配對樣本t檢驗呢？假設我們想要測試 Dr Zeppo 課堂上考試成績是否從第一次測試到第二次測試有所提高，並且不考慮成績下降的可能性。在 jamovi 中，您可以通過在「假設」選項下指定 grade_test2 （在 jamovi 中為「測量1」，因為我們首先將其複製到了配對變量框中）\> grade_test1 （在 jamovi 中為「測量2」）來實現這一點。您應該可以看到 @fig-fig11-19 中的結果。

<!--- Again, the output changes in a predictable way. The definition of the alternative hypothesis has changed, the p-value has changed, and it now reports a one-sided confidence interval rather than a two-sided one.

What about the paired samples t-test? Suppose we wanted to test the hypothesis that grades go up from test 1 to test 2 in Dr Zeppo's class, and are not prepared to consider the idea that the grades go down. In jamovi you would do this by specifying, under the 'Hypotheses' option, that grade_test2 ('Measure 1' in jamovi, because we copied this first into the paired variables box) \> grade test1 ('Measure 2' in jamovi). You should get the results shown in @fig-fig11-19.--->

```{r}
#| label: fig-fig11-19
#| classes: .enlarge-image
#| fig-cap: jamovi生成的'相依樣本t檢定'分析，實際假設為單尾檢定，即測驗1成績 \> 測驗2成績。
#jamovi results showing a 'Paired Samples T-Test' where the actual hypothesis is one sided, i.e. that grade test2 ('Measure 1') $>$ grade test1 ('Measure 2')
knitr::include_graphics("images/fig11-19.png")
```

這次的輸出和之前一樣，以可預測的方式改變。假設已經改變，p值也改變，並且置信區間現在是單邊的。

<!--- Yet again, the output changes in a predictable way. The hypothesis has changed, the p-value has changed, and the confidence interval is now one-sided. --->

## t檢定的效果量 {#sec-t-test-effect-size}

以下是您將翻譯成繁體中文的部分。

對於t檢驗，最常用的效應量測量方法是**科恩的d** [@Cohen1988]。從原理上看，它是一個非常簡單的方法，但當您深入研究細節時，會有相當多的變化。科恩本人主要在獨立樣本t檢驗的上下文中對其進行了定義，特別是學生檢驗。在該背景下，定義效應量的自然方法是將均值之間的差除以標準差的估計。換句話說，我們要計算的是類似於以下公式的東西：

$$d=\frac{(\text{平均值1})-(\text{平均值2})}{\text{標準差}}$$

他在 @tbl-tab11-3中建議了一個解釋$d$的粗略指南。

<!--- The most commonly used measure of effect size for a t-test is **Cohen's d** [@Cohen1988]. It's a very simple measure in principle, with quite a few wrinkles when you start digging into the details. Cohen himself defined it primarily in the context of an independent samples t-test, specifically the Student test. In that context, a natural way of defining the effect size is to divide the difference between the means by an estimate of the standard deviation. In other words, we're looking to calculate something along the lines of this:

$$d=\frac{(\text{mean 1})-(\text{mean 2})}{\text{std dev}}$$

and he suggested a rough guide for interpreting $d$ in @tbl-tab11-3. --->

```{r}
#| label: tbl-tab11-3
#| tbl-cap: 解釋科恩的d的（非常）粗略指南。我的個人建議是不要盲目地使用這些。d統計量本身具有自然的解釋。它將均值之間的差重新描述為將這些均值分開的標準差數。因此，通常最好考慮一下這在實際條件下意味著什麼。在某些情境下，一個「小」的效應可能具有很大的實際重要性。在其他情況下，一個「大」的效應可能並不是那麼有趣。
#A (very) rough guide to interpreting Cohen's d. My personal recommendation is to not use these blindly. The d statistic has a natural interpretation in and of itself. It re-describes the difference in means as the number of standard deviations that separates those means. So it's generally a good idea to think about what that means in practical terms. In some contexts a 'small' effect could be of big practical importance. In other situations a 'large' effect may not be all that interesting
huxtabs[[11]][[3]] |>
  set_width(0.8) |>
  set_caption_width(1.2) |>
  set_caption_pos(value = "bottomleft")
```

以下是一些您將翻譯成繁體中文的單詞。

您可能會認為這應該是非常明確的，但事實並非如此。這主要是因為科恩對他認為應該用作標準差測量的方法並未過多具體（在他的辯護中，他在書中試圖闡述一個更廣泛的觀點，而不是對微小細節吹毛求疵）。如@McGrath2006所討論，常用的有幾個不同版本，每位作者都傾向於採用略有不同的表示法。為了簡單起見（而非準確性），我將使用d來指代您從樣本中計算出的任何統計量，並使用$\delta$來指代理論的群體效應。顯然，這確實意味著有幾個不同的東西都被稱為d。

我的懷疑是，您需要科恩的d的唯一時刻是當您運行t檢驗時，jamovi提供了一個選項可以計算它提供的所有不同類型t檢驗的效應量。

<!--- You'd think that this would be pretty unambiguous, but it's not. This is largely because Cohen wasn't too specific on what he thought should be used as the measure of the standard deviation (in his defence he was trying to make a broader point in his book, not nitpick about tiny details). As discussed by @McGrath2006, there are several different versions in common usage, and each author tends to adopt slightly different notation. For the sake of simplicity (as opposed to accuracy), I'll use d to refer to any statistic that you calculate from the sample, and use $\delta$ to refer to a theoretical population effect. Obviously, that does mean that there are several different things all called d.

My suspicion is that the only time that you would want Cohen's d is when you're running a t-test, and jamovi has an option to calculate the effect size for all the different flavours of t-test it provides. --->

### 單一樣本的Cohen's d


最簡單的情況是與單樣本t檢驗相對應的情況。在這種情況下，這是一個樣本均值$\bar{X}$和一個（假設的）群體均值$\mu_0$進行比較。不僅如此，真正只有一種合理的方法來估計群體標準差。我們只需使用我們通常的估計$\hat{\sigma}$。因此，我們最終得出以下計算$d$的唯一方法

$$d=\frac{\bar{X}-\mu_0}{\hat{\sigma}}$$

當我們回顧@fig-fig11-6中的結果時，效應量值是科恩的$d = 0.50$。因此，總的來說，Zeppo博士班上的心理學生取得的成績（$mean = 72.3\%$）比您預期的水平（$67.5\%$）高出約0.5個標準差，如果他們的表現與其他學生相同。根據科恩的粗略指南，這是一個中等效應量。


<!-- The simplest situation to consider is the one corresponding to a one-sample t-test. In this case, this is the one sample mean $\bar{X}$ and one (hypothesised) population mean $\mu_0$ to compare it to. Not only that, there's really only one sensible way to estimate the population standard deviation. We just use our usual estimate $\hat{\sigma}$. Therefore, we end up with the following as the only way to calculate $d$

$$d=\frac{\bar{X}-\mu_0}{\hat{\sigma}}$$

When we look back at the results in @fig-fig11-6, the effect size value is Cohen's $d = 0.50$. Overall, then, the psychology students in Dr Zeppo's class are achieving grades ($mean = 72.3\%$) that are about .5 standard deviations higher than the level that you'd expect ($67.5\%$) if they were performing at the same level as other students. Judged against Cohen's rough guide, this is a moderate effect size. --->

### 獨立樣本的Cohen's d

大多數關於科恩的$d$的討論都集中在與Student獨立樣本t檢驗相似的情況上，正是在這種情境下，故事變得更加混亂，因為在這種情況下，您可能想要使用幾個不同版本的$d$。為了理解為什麼$d$有多個版本，抽點時間寫下與真實群體效應大小$\delta$相對應的公式是有幫助的。這很簡單，

$$\delta=\frac{\mu_1-\mu_2}{\sigma}$$

其中，和往常一樣，$\mu_1$和$\mu_2$分別是與第1組和第2組相對應的群體均值，$\sigma$是標準差（兩個群體都相同）。顯然，估計$\delta$的方法是做我們在t檢驗本身中所做的完全相同的事情，即在分子使用樣本均值，並在分母使用池化標準差估計值

$$d=\frac{\bar{X}_1-\bar{X}_2}{\hat{\sigma}_p}$$

其中$\hat{\sigma}_p$是t檢驗中出現的完全相同的池化標準差度量。這是應用於Student t檢驗結果時最常用的科恩的d版本，也是jamovi中提供的版本。有時它被稱為Hedges的$g$統計量[@Hedges1981]。

然而，還有其他可能性，我將簡要描述。首先，您可能有理由只想用兩個組中的一個作為計算標準差的基礎。這種方法（通常稱為Glass的$\triangle$，讀作delta）在您有充分理由將兩個組中的一個視為比另一個更純粹地反映「自然變異」時，才最有意義。例如，如果兩個組中的一個是對照組，就可能發生這種情況。其次，回憶一下，在計算池化標準差的過程中，我們通常會除以$N - 2$以糾正樣本方差的偏差。在科恩的d的一個版本中，省略了這個糾正，而是除以$N$。當您試圖在樣本中計算效應量而不是估計群體中的效應量時，這個版本主要是有意義的。最後，有一個基於@Hedges1985的版本，叫做Hedge的g，他指出在科恩的d的常規（池化）估計中存在一個小的偏差。[^11-comparing-two-means-18]

[^11-comparing-two-means-18]: 他們通過將$d$的常數值乘以$\frac{(N - 3)}{(N - 2.25)}$引入一個小的糾正。

<!--- The majority of discussions of Cohen's $d$ focus on a situation that is analogous to Student's independent samples t test, and it's in this context that the story becomes messier, since there are several different versions of $d$ that you might want to use in this situation. To understand why there are multiple versions of $d$, it helps to take the time to write down a formula that corresponds to the true population effect size $\delta$. It's pretty straightforward,

$$\delta=\frac{\mu_1-\mu_2}{\sigma}$$

where, as usual, $\mu_1$ and $\mu_2$ are the population means corresponding to group 1 and group 2 respectively, and $\sigma$ is the standard deviation (the same for both populations). The obvious way to estimate $\delta$ is to do exactly the same thing that we did in the t-test itself, i.e., use the sample means as the top line and a pooled standard deviation estimate for the bottom line

$$d=\frac{\bar{X}_1-\bar{X}_2}{\hat{\sigma}_p}$$

where $\hat{\sigma}_p$ is the exact same pooled standard deviation measure that appears in the t-test. This is the most commonly used version of Cohen's d when applied to the outcome of a Student t-test, and is the one provided in jamovi. It is sometimes referred to as Hedges' $g$ statistic [@Hedges1981].

However, there are other possibilities which I'll briefly describe. Firstly, you may have reason to want to use only one of the two groups as the basis for calculating the standard deviation. This approach (often called Glass' $\triangle$, pronounced delta) only makes most sense when you have good reason to treat one of the two groups as a purer reflection of "natural variation" than the other. This can happen if, for instance, one of the two groups is a control group. Secondly, recall that in the usual calculation of the pooled standard deviation we divide by $N - 2$ to correct for the bias in the sample variance. In one version of Cohen's d this correction is omitted, and instead we divide by $N$. This version makes sense primarily when you're trying to calculate the effect size in the sample rather than estimating an effect size in the population. Finally, there is a version called Hedge's g, based on @Hedges1985, who point out there is a small bias in the usual (pooled) estimation for Cohen's d.[^11-comparing-two-means-18]

[^11-comparing-two-means-18]: They introduce a small correction by multiplying the usual value of $d$ by $\frac{(N - 3)}{(N - 2.25)}$.

In any case, ignoring all those variations that you could make use of if you wanted, let's have a look at the default version in jamovi. In @fig-fig11-10 Cohen's $d = 0.74$, indicating that the grade scores for students in Anastasia's class are, on average, $0.74$ standard deviations higher than the grade scores for students in Bernadette's class. For a Welch test, the estimated effect size is the same (@fig-fig11-12). --->

### 相依樣本的Cohen's d


最後，對於配對樣本t檢驗，我們應該怎麼做？在這種情況下，答案取決於您試圖做什麼。jamovi假設您希望根據差異分數的分佈來衡量效應量，您計算的d度量為：

$$d=\frac{\bar{D}}{\hat{\sigma}_D}$$

其中$\hat{\sigma}_D$是差異的標準差估計。在@fig-fig11-16中，科恩的$d = 1.45$，表示時間2的分數平均比時間1的分數高出$1.45$個標準差。

這是jamovi「配對樣本T檢驗」分析報告的科恩$d$版本。唯一的麻煩是弄清楚這是否是您想要的度量。在您關心研究的實際後果的程度上，您通常希望根據*原始*變量而不是*差異分數*（例如，與學生間的成績變異量相比，Chico博士班上隨著時間的1%改進相當小）來衡量效應量，在這種情況下，您使用的是與Student或Welch檢驗相同的科恩d版本。在jamovi中做到這一點並不那麼簡單；基本上您必須在試算表視圖中更改資料結構，所以我在這裡不會深入討論[^11-comparing-two-means-19]，但是從這個角度看，科恩的d相當不同：它是$0.22$，在原始變量的尺度上評估相當小。

[^11-comparing-two-means-19]: 如果您有興趣，可以查看在*chico2.omv*文件中是如何完成的

<!--- Finally, what should we do for a paired samples t-test? In this case, the answer depends on what it is you're trying to do. jamovi assumes that you want to measure your effect sizes relative to the distribution of difference scores, and the measure of d that you calculate is:

$$d=\frac{\bar{D}}{\hat{\sigma}_D}$$

where $\hat{\sigma}_D$ is the estimate of the standard deviation of the differences. In @fig-fig11-16 Cohen's $d = 1.45$, indicating that the time 2 grade scores are, on average, $1.45$ standard deviations higher than the time 1 grade scores.

This is the version of Cohen's $d$ that gets reported by the jamovi 'Paired Samples T-Test' analysis. The only wrinkle is figuring out whether this is the measure you want or not. To the extent that you care about the practical consequences of your research, you often want to measure the effect size relative to the *original* variables, not the *difference scores* (e.g., the 1% improvement in Dr Chico's class over time is pretty small when measured against the amount of between-student variation in grades), in which case you use the same versions of Cohen's d that you would use for a Student or Welch test. It's not so straightforward to do this in jamovi; essentially you have to change the structure of the data in the spreadsheet view so I won't go into that here[^11-comparing-two-means-19], but the Cohen's d for this perspective is quite different: it is $0.22$ which is quite small when assessed on the scale of the original variables.

[^11-comparing-two-means-19]: If you are interested, you can look at how this was done in the *chico2.omv* file --->

## 檢測樣本常態性 {#sec-Checking-the-normality-of-a-sample}



迄今為止，在本章中討論的所有檢驗都假定資料呈常態分佈。這個假設通常是相當合理的，因為中心極限定理（見 @sec-The-central-limit-theorem ）確實傾向於確保許多現實世界的數量呈常態分佈。任何時候你懷疑你的變量*實際上*是很多不同事物的平均值時，它很可能呈常態分佈，或者至少接近正態，以便你可以使用t檢驗。然而，生活中沒有保證，而且還有很多方法可以讓你得到非常非正態的變量。例如，任何時候你認為你的變量實際上是很多不同事物的最小值，它很可能會變得非常偏斜。在心理學中，反應時間（RT）資料就是一個很好的例子。如果你認為有很多事情可能觸發一個人類參與者的反應，那麼實際的反應將在這些觸發事件中的第一次發生時發生。[^11-comparing-two-means-20]這意味著RT資料是系統性地非正態的。好吧，那麼，如果正態性是所有檢驗的假設，並且在現實世界的資料中大多數（至少近似地）得到滿足，那麼我們如何檢查樣本的正態性呢？在本節中，我將討論兩種方法：分位數對分位數圖(Q-Q plot)和Shapiro-Wilk檢驗。

[^11-comparing-two-means-20]:這是一個極大的簡化。

<!--- All of the tests that we have discussed so far in this chapter have assumed that the data are normally distributed. This assumption is often quite reasonable, because the Central Limit Theorem (see @sec-The-central-limit-theorem) does tend to ensure that many real world quantities are normally distributed. Any time that you suspect that your variable is *actually* an average of lots of different things, there's a pretty good chance that it will be normally distributed, or at least close enough to normal that you can get away with using t-tests. However, life doesn't come with guarantees, and besides there are lots of ways in which you can end up with variables that are highly non-normal. For example, any time you think that your variable is actually the minimum of lots of different things, there's a very good chance it will end up quite skewed. In psychology, response time (RT) data is a good example of this. If you suppose that there are lots of things that could trigger a response from a human participant, then the actual response will occur the first time one of these trigger events occurs.[^11-comparing-two-means-20] This means that RT data are systematically non-normal. Okay, so if normality is assumed by all the tests, and is mostly but not always satisfied (at least approximately) by real world data, how can we check the normality of a sample? In this section I discuss two methods: QQ plots and the Shapiro-Wilk test.

[^11-comparing-two-means-20]: This is a massive oversimplification.--->

### 分位數對分位數圖


檢查樣本是否違反正態性假設的一種方法是繪製**“Q-Q圖”**（分位數對分位數圖，Quantile-Quantile plot）。這可以讓您直觀地檢查是否有任何系統性違規行為。在QQ圖中，每個觀察值都作為一個單獨的點繪製。x坐標是觀察值在資料常態分佈（用樣本估計均值和方差）的情況下應該落入的理論分位數，y坐標是資料在樣本中的實際分位數。如果資料是正態的，點應該形成一條直線。例如，讓我們看看如果我們通過從常態分佈中抽樣生成資料，然後繪製QQ圖會發生什麼。結果顯示在@fig-fig11-20。

<!--- One way to check whether a sample violates the normality assumption is to draw a **"Q-Q plot"** (
分位數對分位數圖, Quantile-Quantile plot). This allows you to visually check whether you're seeing any systematic violations. In a QQ plot, each observation is plotted as a single dot. The x coordinate is the theoretical quantile that the observation should fall in if the data were normally distributed (with mean and variance estimated from the sample), and on the y co-ordinate is the actual quantile of the data within the sample. If the data are normal, the dots should form a straight line. For instance, lets see what happens if we generate data by sampling from a normal distribution, and then drawing a QQ plot. The results are shown in @fig-fig11-20.--->

```{r}
#| label: fig-fig11-20
#| fig-width: 10
#| fig-height: 5
#| fig-cap: 直方圖（圖板(a)）和正態QQ圖（圖板(b)）顯示 normal.data 是具有 $100$ 個觀測值的常態分佈樣本。與這些資料相關的 Shapiro-Wilk 統計量是 $W = .99$，表示未檢測到顯著偏離正態性（$p = .54$）。
#Histogram (panel (a)) and normal QQ plot (panel (b)) of normal.data, a normally distributed sample with $100$ observations. The Shapiro-Wilk statistic associated with these data is $W = .99$, indicating that no significant departures from normality were detected ($p = .54)$


df <- data.frame(y=rnorm(100))
shap_df <- shapiro.test(df$y)

p1 <- ggplot(df, aes(x=y)) +
  geom_histogram(bins=10, col="white", fill=blueshade, alpha=0.6) +
  xlab("\nValue") +
  ylab("Frequency\n") +
  ggtitle("Normally Distributed Data") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(df, aes(sample=y)) +
  stat_qq() +
  stat_qq_line() +
  xlab("\nSample Quantiles") +
  ylab("Standardized Residuals\n") +
  ggtitle("Normal Q-Q Plot") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))


gridExtra::grid.arrange(p1,p2,ncol=2)

```


如您所見，這些資料形成了一條非常直線；這並不奇怪，因為我們從常態分佈中抽樣得到它們！相比之下，請看@fig-fig11-21中顯示的兩個資料集。上面的面板顯示了一個高度偏斜的資料集的直方圖和QQ圖：QQ圖向上彎曲。下面的面板顯示了同樣的圖，但對於一個尾部較重（即高峰度）的資料集：在這種情況下，QQ圖在中間變平並在兩端急劇彎曲。

<!--- As you can see, these data form a pretty straight line; which is no surprise given that we sampled them from a normal distribution! In contrast, have a look at the two data sets shown in @fig-fig11-21. The top panels show the histogram and a QQ plot for a data set that is highly skewed: the QQ plot curves upwards. The lower panels show the same plots for a heavy tailed (i.e., high kurtosis) data set: in this case the QQ plot flattens in the middle and curves sharply at either end. --->

```{r}
#| label: fig-fig11-21
#| fig-width: 10
#| fig-height: 10
#| fig-cap: 在第一行，顯示有偏的資料集的 $100$ 個觀測值的直方圖和正態QQ圖。這裡的資料偏度為 $1.88$，並在向上彎曲的QQ圖中反映出來。因此，Shapiro-Wilk統計量為 $W = .80$，反映了與正態性的顯著偏差（$p < .001$）。底部的行顯示了同樣的圖，但對於尾部較重的資料集，同樣包含100個觀測值。在這種情況下，資料中的重尾產生了高峰度（$6.57$），並使QQ圖在中間變平，在兩側急劇彎曲。由此產生的Shapiro-Wilk統計量為 $W = .75$，同樣反映了顯著的非正態性（$p < .001$）。
#In the top row, a histogram and a normal QQ plot of the $100$ observations in a skewed.data set. The skewness of the data here is $1.88$, and is reflected in a QQ plot that curves upwards. As a consequence, the Shapiro-Wilk statistic is $W = .80$, reflecting a significant departure from normality ($p< .001$). The bottom row shows the same plots for a heavy tailed data set, again consisting of 100 observations. In this case the heavy tails in the data produce a high kurtosis ($6.57$), and cause the QQ plot to flatten in the middle, and curve away sharply on either side. The resulting Shapiro-Wilk statistic is $W = .75$, again reflecting significant non-normality ($p<.001)$


df1 <- data.frame(y=rgamma( n = 100,1,2 ))
df2 <- data.frame(y=c(rnorm( n = 80 ), rnorm( 20, sd=5)))

skew_df1 <- psych::skew(df1$y)
kurt_df2 <- psych::kurtosi(df2$y)
shap_df1 <- shapiro.test(df1$y)
shap_df2 <- shapiro.test(df2$y)

p1 <- ggplot(df1, aes(x=y)) +
  geom_histogram(bins=10, col="white", fill=blueshade, alpha=0.6) +
  xlab("\nValue") +
  ylab("Frequency\n") +
  ggtitle("Skewed Distributed Data") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

p2 <- ggplot(df1, aes(sample=y)) +
  stat_qq() +
  stat_qq_line() +
  xlab("\nSample Quantiles") +
  ylab("Standardized Residuals\n") +
  ggtitle("Normal Q-Q Plot") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))


p3 <- ggplot(df2, aes(x=y)) +
  geom_histogram(bins=10, col="white", fill=blueshade, alpha=0.6) +
  xlab("\nValue") +
  ylab("Frequency\n") +
  ggtitle("Heavy-Tailed Distributed Data") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

p4 <- ggplot(df2, aes(sample=y)) +
  stat_qq() +
  stat_qq_line() +
  xlab("\nSample Quantiles") +
  ylab("Standardized Residuals\n") +
  ggtitle("Normal Q-Q Plot") +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,p3,p4, nrow=2, ncol=2)

```

### t檢定的分位數對分位數圖

在之前的分析中，我們展示了如何在 jamovi 中進行獨立 t 檢驗（@fig-fig11-10）和配對樣本 t 檢驗（@fig-fig11-16）。對於這些分析，jamovi 提供了顯示差異得分的 QQ 圖選項（jamovi 稱之為「殘差」），這是檢查正態性假設的更好方法。當我們選擇這些分析的此選項時，我們將分別獲得 @fig-fig11-22 和 @fig-fig11-23 中顯示的 QQ 圖。我的解釋是，這兩個圖都表明差異得分基本上呈常態分佈，所以我們可以繼續了！


<!--- In our previous analyses we showed how to conduct in jamovi an independent t test (@fig-fig11-10) and a paired samples t test (@fig-fig11-16). And for these analyses jamovi provides an option to show a QQ plot for the difference scores (which jamovi calls the 'residuals'), which is a better way of checking the normality assumption. When we select this option for these analyses, we get the Q-Q plots shown in @fig-fig11-22 and @fig-fig11-23, respectively. My interpretation is that these plots both show that the difference scores are reasonably normally distributed, so we are good to go! --->

```{r}
#| label: fig-fig11-22
#| fig-cap: 獨立t檢驗分析的QQ圖 參考 @fig-fig11-10
#QQ plot for the independent t test analysis shown in 
knitr::include_graphics("images/fig11-22.png")
```

```{r}
#| label: fig-fig11-23
#| fig-cap: 配對樣本t檢驗分析的QQ圖 參考 @fig-fig11-16
#QQ plot for the paired samples t test analysis shown in
knitr::include_graphics("images/fig11-23.png")
```

### Shapiro-Wilk檢定

QQ圖提供了一種非正式檢查資料正態性的好方法，但有時您可能需要做更正式的檢查，**Shapiro-Wilk檢定**[@Shapiro1965]可能正是您正在尋找的。[^11-comparing-two-means-21]如您所料，被檢驗的虛無假設是一組$N$個觀測值是常態分佈的。

[^11-comparing-two-means-21]: 要么是Kolmogorov-Smirnov檢驗，這可能比Shapiro-Wilk更具傳統性。雖然我讀到的大部分東西似乎都表明Shapiro-Wilk是更好的正態性檢驗，但Kolomogorov Smirnov是一種通用的分佈等價性檢驗，可以應對其他類型的分佈檢驗。在jamovi中，Shapiro-Wilk檢驗是首選。

[其他技術細節 [^11-comparing-two-means-22]]

[^11-comparing-two-means-22]: 該檢驗統計量通常表示為$W$，其計算方法如下。首先，我們按照大小遞增的順序對觀測值進行排序，讓$\bar{X_1}$成為樣本中最小的值，$X_2$成為第二小的值，依此類推。然後$W$的值由以下公式給出$$W=\frac{(\sum_{i=1}^N a_iX_i)^2}{\sum_{i=1}^N(X_i-\bar{X})^2}$$其中$\bar{X}$是觀測值的平均值，$a_i$值是...咕嚕咕嚕...比較複雜，超出了入門級教材的範疇。

<!--- QQ plots provide a nice way to informally check the normality of your data, but sometimes you'll want to do something a bit more formal and the **Shapiro-Wilk檢定(Shapiro-Wilk test)** [@Shapiro1965] is probably what you're looking for.[^11-comparing-two-means-21] As you'd expect, the null hypothesis being tested is that a set of $N$ observations is normally distributed.

[^11-comparing-two-means-21]: Either that, or the Kolmogorov-Smirnov test, which is probably more traditional than the Shapiro-Wilk. Although most things I've read seem to suggest Shapiro-Wilk is the better test of normality, the Kolomogorov Smirnov is a general purpose test of distributional equivalence that can be adapted to handle other kinds of distribution tests. In jamovi the Shapiro-Wilk test is preferred. 

[Additional technical detail [^11-comparing-two-means-22]]

[^11-comparing-two-means-22]: The test statistic that it calculates is conventionally denoted as $W$, and it's calculated as follows. First, we sort the observations in order of increasing size, and let $\bar{X_1}$ be the smallest value in the sample, $X_2$ be the second smallest and so on. Then the value of $W$ is given by $$W=\frac{(\sum_{i=1}^N a_iX_i)^2}{\sum_{i=1}^N(X_i-\bar{X})^2}$$ where $\bar{X}$ is the mean of the observations, and the $a_i$ values are ...mumble, mumble... something complicated that is a bit beyond the scope of an introductory text.--->

```{r}
#| label: fig-fig11-24
#| fig-width: 5
#| fig-height: 5
#| fig-cap: 在樣本大小為10、20和50的情況下，據擷取的Shapiro-Wilk $W$統計量分布，據此推出空假設是資料呈正態分布。注意，$W$值較小表示偏離正態分布。
#Sampling distribution of the Shapiro-Wilk $W$ statistic, under the null hypothesis that the data are normally distributed, for samples of size 10, 20 and 50. Note that small values of $W$ indicate departure from normality



W_sampdist <- lapply(c(10,20,50), function(i) {
  sapply(1:10000, function (x) {
    shapiro.test(rnorm(i, 0, 1))$statistic
  })
})
W_sampdist <- tibble(W_10=W_sampdist[[1]], W_20=W_sampdist[[2]], W_50=W_sampdist[[3]])

ggplot(W_sampdist) +
  geom_density(aes(x=W_10), adjust=3, col = blueshade, linetype = "solid", show.legend=FALSE) +
  stat_density(aes(x=W_10, linetype = "N = 10"), alpha = 0,
                  geom="line", position="identity") +
  geom_density(aes(x=W_20), adjust=3, col = blueshade, linetype = "dashed", show.legend=FALSE) +
  stat_density(aes(x=W_20, linetype = "N = 20"), alpha = 0,
                  geom="line", position="identity") +
  geom_density(aes(x=W_50), adjust=3, col = blueshade, linetype = "dotted", show.legend=FALSE)+
  stat_density(aes(x=W_50, linetype = "N = 50"), alpha = 0,
                  geom="line", position="identity") +
  scale_linetype_manual(values = c('solid', 'dashed', 'dotted')) +
  guides(linetype = guide_legend(override.aes = list(col = blueshade, alpha = 1) ) ) +
  xlab("\nValue of W") +
  ggtitle("Sampling distribution of W\n(for normally distributed data)") +
  scale_x_continuous(limits=c(.75,1)) +
  theme_classic() +
  theme(
    axis.title.y = element_blank(),
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.y = element_blank(),
    plot.title = element_text(hjust = 0.5),
    legend.position = c(0.4,0.8),
    legend.title = element_blank(),
    legend.key.width =  unit(1.8, 'cm'),
    legend.text = element_text(size=12))

```


該檢驗統計量通常表示為$W$，其計算方法如下。首先，我們按照大小遞增的順序對觀測值進行排序，讓$\bar{X_1}$成為樣本中最小的值，$X_2$成為第二小的值，依此類推。然後$W$的值由以下公式給出$$W=\frac{(\sum_{i=1}^N a_iX_i)^2}{\sum_{i=1}^N(X_i-\bar{X})^2}$$其中$\bar{X}$是觀測值的平均值，$a_i$值是...咕嚕咕嚕...比較複雜，超出了入門級教材的範疇。

<!--- To get the Shapiro-Wilk statistic in jamovi t-tests, check the option for 'Normality' listed under 'Assumptions'. In the randomly sampled data ($N = 100$) we used for the QQ plot, the value for the Shapiro-Wilk normality test statistic was $W = 0.99$ with a p-value of $0.54$. So, not surprisingly, we have no evidence that these data depart from normality. When reporting the results for a Shapiro-Wilk test, you should (as usual) make sure to include the test statistic $W$ and the p value, though given that the sampling distribution depends so heavily on $N$ it would probably be a politeness to include $N$ as well. --->

### 檢測樣本常態性的範例

與此同時，當資料變得非正態時，展示一下 QQ 圖和 Shapiro-Wilk 檢定的變化可能是值得的。為此，讓我們看一下我們的澳式足球聯賽（AFL）勝利幅度資料的分佈，如果您還記得@sec-描述性統計，它看起來根本不是來自常態分佈。以下是 QQ 圖發生的情況（@fig-fig11-25）。


<!---In the meantime, it's probably worth showing you an example of what happens to the QQ plot and the Shapiro-Wilk test when the data turn out to be non-normal. For that, let's look at the distribution of our AFL winning margins data, which if you remember back to @sec-Descriptive-statistics it didn't look like they came from a normal distribution at all. Here's what happens to the QQ plot (@fig-fig11-25). --->

```{r}
#| label: fig-fig11-25
#| fig-cap: 展示 AFL 勝利幅度資料非正態性的 QQ 圖
#QQ plot showing non-normality from the AFL winning margins data
knitr::include_graphics("images/fig11-25.png")
```

而當我們對 *AFL margins* 資料執行 Shapiro-Wilk 檢定時，我們得到了 Shapiro-Wilk 正態檢定統計量的值 $W = 0.94$，p值 = $9.481$x$10^{-07}$。顯然是一個顯著的效應！


<!--- And when we run the Shapiro-Wilk test on the *AFL margins* data, we get a value for the Shapiro-Wilk normality test statistic of $W = 0.94$, and p-value = $9.481$x$10^{-07}$. Clearly a significant effect! --->

## 平均值的無母數統計檢定 {#sec-nonparameter-rank-test}

<!--- [^11-translation-01]: 這一節標題及小節順序，配合**線性模型的學習取向**稍做更改。--->

與此同時，當資料變得非正態時，展示一下 QQ 圖和 Shapiro-Wilk 檢定的變化可能是值得的。為此，讓我們看一下我們的澳式足球聯賽（AFL）勝利幅度資料的分佈，如果您還記得@sec-描述性統計，它看起來根本不是來自常態分佈。以下是 QQ 圖發生的情況（@fig-fig11-25）。

而當我們對 *AFL margins* 資料執行 Shapiro-Wilk 檢定時，我們得到了 Shapiro-Wilk 正態檢定統計量的值 $W = 0.94$，p值 = $9.481$x$10^{-07}$。顯然是一個顯著的效應！

<!--- Okay, suppose your data turn out to be pretty substantially non-normal, but you still want to run something like a t-test? This situation occurs a lot in real life. For the AFL winning margins data, for instance, the Shapiro-Wilk test made it very clear that the normality assumption is violated. This is the situation where you want to use Wilcoxon tests.

Like the t-test, the Wilcoxon test comes in two forms, one-sample and two-sample, and they're used in more or less the exact same situations as the corresponding t-tests. Unlike the t-test, the Wilcoxon test doesn't assume normality, which is nice. In fact, they don't make any assumptions about what kind of distribution is involved. In statistical jargon, this makes them **nonparametric tests**. While avoiding the normality assumption is nice, there's a drawback: the Wilcoxon test is usually less powerful than the t-test (i.e., higher Type II error rate). I won't discuss the Wilcoxon tests in as much detail as the t-tests, but I'll give you a brief overview.--->


### 單一樣本的Wilcoxon檢定


那麼，**單樣本 Wilcoxon 檢定（Wilcoxon test）**（或等效地，成對樣本 Wilcoxon 檢定）呢？假設我有興趣了解上統計課對學生的幸福感有什麼影響。我的資料在 *happiness.csv* 文件中。這裡我測量的是每個學生在上課前和上課後的幸福感，變化分數是兩者之間的差距。就像我們在 t 檢驗中看到的那樣，在進行成對樣本檢定之前和之後，與使用變化分數進行單樣本檢定之間，沒有本質區別。與以前一樣，考慮該檢定的最簡單方法是進行標記。這次要做的是，對於正向變化的變化分數，將它們與所有完整樣本一起標記。最終，您得到的表格看起來像 @tbl-tab11-5。

<!--- What about the **one sample Wilcoxon檢定(Wilcoxon test)** (or equivalently, the paired samples Wilcoxon test)? Suppose I'm interested in finding out whether taking a statistics class has any effect on the happiness of students. My data is in the happiness.csv file. What I've measured here is the happiness of each student before taking the class and after taking the class, and the change score is the difference between the two. Just like we saw with the t-test, there's no fundamental difference between doing a paired-samples test using before and after, versus doing a onesample test using the change scores. As before, the simplest way to think about the test is to construct a tabulation. The way to do it this time is to take those change scores that are positive differences, and tabulate them against all the complete sample. What you end up with is a table that looks like @tbl-tab11-5.--->


```{r}
#| label: tbl-tab11-5
#| tbl-cap: 比較單樣本 Wilcoxon U 檢定中各組觀察值
#Comparing observations by group for a one-sample Wilcoxon U test
huxtabs[[11]][[5]]  |>
  merge_cells(1:2, 1:2) |>
  merge_cells(1, 4:13) |>
  merge_cells(3:5, 1:2) |>
  set_bold(3:5, 1:2) |>
  set_right_border(3:5, 1:2)
```

這一次的探討，我們有關於Wilcoxon符號等級檢定的問題。Wilcoxon符號等級檢定是用於對兩個樣本進行比較的非參數檢定，而不需要對母群進行任何假設。本次的Wilcoxon符號等級檢定結果是$W=7$，我們有一個顯著的效果。顯然，修讀統計學對幸福感有影響。在 jamovi 中執行此測試，您可以在“一样本t-Test”分析窗口中的“Tests”下指定“Wilcoxon rank”选项，这将给出Wilcoxon $W=7$，p-value=$0.03711$的结果。轉換成配對樣本版本的測試當然不會給我們不同的答案；詳見 @fig-fig11-26 。

<!--- Counting up the tick marks this time we get a test statistic of $W = 7$. As before, if our test is two sided, then we reject the null hypothesis when W is very large or very small. As far as running it in jamovi goes, it's pretty much what you'd expect. For the one-sample version, you specify the 'Wilcoxon rank' option under 'Tests' in the 'One Sample T-Test' analysis window. This gives you Wilcoxon $W = 7$, p-value = $0.03711$. As this shows, we have a significant effect. Evidently, taking a statistics class does have an effect on your happiness. Switching to a paired samples version of the test won't give us a different answer, of course; see @fig-fig11-27. --->

```{r}
#| label: fig-fig11-26
#| classes: .enlarge-image
#| fig-cap: 單樣本和成對樣本 Wilcoxon 非參數檢驗結果的 jamovi 示範畫面
#jamovi screen showing results for one sample and paired sample Wilcoxon nonparametric tests
knitr::include_graphics("images/fig11-27.png")
```


### 獨立樣本的曼－惠特尼U檢定

我們先從**曼－惠特尼U檢定(Mann-Whitney U test)** 開始講起，因為它比單一樣本版本還要簡單。假設我們正在研究一個包含10個人在某個測試中得分的資料集。由於我的想像力已經完全失靈，所以讓我們假裝這是一個"超讚指數測試"，而有兩個不同的組別，分別為"A"和"B"。我很好奇哪一個組別更厲害。這些資料包含在*awesome.csv*檔案中，除了通常的ID變項之外，還有兩個變項：scores和group。

只要沒有平手的情況發生（即，有人得到完全相同的超讚指數分數），那麼我們要進行的測試就非常簡單了。我們只需要建立一個表格，將組A中的每個觀察值與組B中的每個觀察值進行比較。當組A資料大於組B時，在表格中放置一個勾號(@tbl-tab11-4)。

<!--- I'll start by describing the **曼－惠特尼U檢定(Mann-Whitney U test)**, since it's actually simpler than the one sample version. Suppose we're looking at the scores of 10 people on some test. Since my imagination has now failed me completely, let's pretend it's a "test of awesomeness" and there are two groups of people, "A" and "B". I'm curious to know which group is more awesome. The data are included in the file awesome.csv, and there are two variables apart from the usual ID variable: scores and group.

As long as there are no ties (i.e., people with the exact same awesomeness score) then the test that we want to do is surprisingly simple. All we have to do is construct a table that compares every observation in group A against every observation in group B. Whenever the group A datum is larger, we place a check mark in the table (@tbl-tab11-4). --->

```{r}
#| label: tbl-tab11-4
#| tbl-cap: 對於雙樣本曼－惠特尼U檢定，比較各組觀測值
#Comparing observations by group for a two-sample Mann-Whitney U test
huxtabs[[11]][[4]] |>
  merge_cells(1, 3:7) |>
  merge_cells(3:7, 1) |>
  set_bold(3:7, 1) |>
  set_right_border(3:7, 1) |>
  merge_cells(1:2, 1:2)
```

我們然後計算出勾勾的數量，這就是我們的檢定統計量 W[^11-comparing-two-means-23]。W的抽樣分佈實際上有些複雜，我會略過細節。對於我們的目的而言，關鍵是W的解釋在質性上與t或z的解釋相同。也就是說，如果我們需要進行雙側檢定，則當W非常大或非常小時，我們會拒絕虛無假設，但如果我們有一個單向（即單側）假設，那麼我們只使用其中之一。

[^11-comparing-two-means-23]: 實際上，有兩種不同的檢定統計量版本，它們之間相差一個常數。我描述的是jamovi計算的版本。

在jamovi中，如果我們將成績作為因變量，組別作為分組變量運行“獨立樣本T檢驗”，然後在“測試”選項中勾選“曼-惠特尼U檢定”選項，我們將獲得顯示$U=3$（即上面顯示的檢查記號數）和p值= 0.05556的結果。參見 @fig-fig11-27 。

<!--- We then count up the number of checkmarks. This is our test statistic, W. [^11-comparing-two-means-23] The actual sampling distribution for W is somewhat complicated, and I'll skip the details. For our purposes, it's sufficient to note that the interpretation of W is qualitatively the same as the interpretation of $t$ or $z$. That is, if we want a two-sided test then we reject the null hypothesis when W is very large or very small, but if we have a directional (i.e., one-sided) hypothesis then we only use one or the other.

[^11-comparing-two-means-23]: Actually, there are two different versions of the test statistic that differ from each other by a constant value. The version that I've described is the one that jamovi calculates.

In jamovi, if we run an 'Independent Samples T-Test' with scores as the dependent variable. and group as the grouping variable, and then under the options for 'tests' check the option for 'Mann-Whitney $U$, we will get results showing that $U = 3$ (i.e., the same number of checkmarks as shown above), and a p-value = $0.05556$. See @fig-fig11-26. --->

```{r}
#| label: fig-fig11-27
#| classes: .enlarge-image
#| fig-cap: jamovi螢幕顯示曼-惠特尼$U$檢定的結果
#jamovi screen showing results for the Mann-Whitney $U$ test
knitr::include_graphics("images/fig11-26.png")
```

## 本章小結

- [單一樣本z檢定](11-Comparing-two-means.html#%E5%96%AE%E4%B8%80%E6%A8%A3%E6%9C%ACz%E6%AA%A2%E5%AE%9A) 用來比對樣本平均值是否不同於母群平均值(各位可考慮跳過)。
- 獨立樣本t檢定用於比較兩組平均值的差異，虛無假設設定兩組平均值相等。實務上會使用適用條件 是兩組變異相同的[獨立樣本t檢定](11-Comparing-two-means.html#sec-The-one-sample-t-test)，或是兩組變異不同的[獨立樣本t檢定(Welch t檢定)](11-Comparing-two-means.html#sec-the-independent-samples-t-test-welch-test)。
- [相依樣本t檢定](11-Comparing-two-means.html#%E7%9B%B8%E4%BE%9D%E6%A8%A3%E6%9C%ACt%E6%AA%A2%E5%AE%9A)用於比較的資料來自同一個樣本的測量，虛無假設設定兩次測量的平均值相等。分析方法與適用條件與單一樣本t檢定相同。
- 只有事前規劃差異比較方向，[單尾檢定](11-Comparing-two-means.html#%E5%96%AE%E5%B0%BE%E6%AA%A2%E5%AE%9A) 才有真正的意義。
- t檢定的[效果量](11-Comparing-two-means.html#t%E6%AA%A2%E5%AE%9A%E7%9A%84%E6%95%88%E6%9E%9C%E9%87%8F)以Cohen' d的公式計算。
- 我們能使用QQ圖及Shapiro-Wilk檢定[檢測樣本常態性](11-Comparing-two-means.html#sec-Checking-the-normality-of-a-sample)
- 如果資料真的違反常態性，你可以使用[等級資料的平均值檢定](11-Comparing-two-means.html#sec-nonparameter-rank-test)像是曼－惠特尼U檢定，以及Wilcoxon檢定。

<!---
- [The one-sample t-test] is used to compare a single sample mean against a hypothesised value for the population mean.
- An independent samples t-test is used to compare the means of two groups, and tests the null hypothesis that they have the same mean. It comes in two forms: [The independent samples t-test (Student test)](#sec-the-independent-samples-t-test-student-test) assumes that the groups have the same standard deviation, [The independent samples t-test (Welch test)](#sec-the-independent-samples-t-test-welch-test) does not.
- [The paired-samples t-test] is used when you have two scores from each person, and you want to test the null hypothesis that the two scores have the same mean. It is equivalent to taking the difference between the two scores for each person, and then running a one sample t-test on the difference scores.
- [One-sided tests] are perfectly legitimate as long as they are pre-planned (like all tests!).
- [Effect size] calculations for the difference between means can be calculated via the Cohen's d statistic.
- [Checking the normality of a sample] using QQ plots and the Shapiro-Wilk test.
- If your data are non-normal, you can use Mann-Whitney or Wilcoxon tests instead of t-tests for [Testing non-normal data]. --->
